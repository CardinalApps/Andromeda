/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={933:e=>{e.exports=require("electron")},747:e=>{e.exports=require("fs")}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,a),n.exports}a.amdO={},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={};a.r(e),a.d(e,{close:()=>j,closeAll:()=>q,show:()=>B});var t={};function i(e){return new s(e)}a.r(t),a.d(t,{addToPlaylist:()=>ae});class s{constructor(e){if(e)if(this.selector=e,"document"===e)this.els=[document];else if("window"===e)this.els=[window];else if(e instanceof Element)this.els=[e];else if(NodeList.prototype.isPrototypeOf(e))this.els=e;else if(e instanceof DocumentFragment)this.els=[e];else if(Array.isArray(e)&&e.length){let t=!0;for(let a of e)a instanceof Element||(t=!1);t&&(this.els=e)}else if(Array.isArray(e)&&!e.length)this.els=[];else{if(e instanceof s)throw new Error(`You cannot create new __Object's using exisitng __Object's. The given __Object has the selector: ${e.selector}`);this.els=Array.from(document.querySelectorAll(e))}}each(e){if(void 0===this.els||null===this.els)throw new Error(`Cannot loop elements within __Object. The invalid selector is: ${this.selector}`);if(!e||"function"!=typeof e)throw new Error("Cannot loop elements within __Object. Check your callback function.");for(let t=0;t<this.els.length;t++)e(this.els[t],t);return this}el(){if(this.els.length)return 1!==this.els.length&&console.warn(".el() was called on an __Object that has more than 1 item"),this.els[0]instanceof Element||console.warn(".el() returned an item that was not an Element"),this.els[0];console.warn(".el() was called on an __Object that has no items")}on(e,t,a){let i;"object"!=typeof window.__delegations&&(window.__delegations={}),"object"!=typeof window.__delegationForwarders&&(window.__delegationForwarders={}),"function"==typeof t?(i=t,t=!1):("boolean"==typeof t||t instanceof Element)&&"function"==typeof a&&(i=a);let s=[],n=!1;if(t instanceof Element||!0===t?(n=!0,s=t instanceof Element?[t]:[document]):this.els.length?1===this.els.length&&this.els[0]instanceof Element?s=[this.els[0]]:this.els instanceof NodeList?s=Array.from(this.els):Array.isArray(this.els)&&(s=this.els):(n=!0,s=[document]),n)for(let t of s)t.addEventListener(e,(e=>{if(e.target.matches(this.selector))i.call(e.target,e);else{let t=e.target.closest(this.selector);t&&i.call(t,e)}}));else for(let t of s)t.addEventListener(e,(e=>{i.call(t,e)}))}off(e,t){if(!(e in window.__delegations))throw new Error(`Trying to remove delegated event handler that doesn't exist: ${e}`);for(let a in window.__delegations[e]){let i=window.__delegations[e][a];i.selector===this.selector&&t===i.cb&&window.__delegations[e].splice(a,1)}window.__delegations[e].length||(delete window.__delegations[e],document.removeEventListener(e,window.__delegationForwarders[e]))}addClass(...e){for(let t of e)this.each((e=>{e.classList.add(t)}));return this}removeClass(...e){for(let t of e)this.each((e=>{e.classList.remove(t)}));return this}toggleClass(...e){for(let t of e)this.each((e=>{e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)}))}hasClass(e){let t=!1;return this.each((a=>{a.classList.contains(e)&&(t=!0)})),t}attr(e,t){if(void 0===t){if(1===this.els.length){if(this.els[0].hasAttribute(e)){let t=this.els[0].getAttribute(e);return"string"==typeof t&&""===t?null:this._readAttrValue(t)}return}{let t=[];return this.each((a=>{a.hasAttribute(e)&&""!==a.getAttribute(e)&&t.push(this._readAttrValue(a.getAttribute(e)))})),t}}return this.each((a=>{a.setAttribute(e,this._prepareForAttr(t))})),this}hasAttr(e){let t=!0;return this.each((a=>{a.hasAttribute(e)||(t=!1)})),t}removeAttr(e){return this.each((t=>{t.removeAttribute(e)})),this}watchAttrs(e,t){this.each((a=>{new MutationObserver((e=>{t(e,a)})).observe(a,{attributes:!0,attributeOldValue:!0,attributeFilter:e})}))}value(e){if(void 0===e){let e=[];if(this.each((t=>{if(t.matches('input[type="file"]'))t.files instanceof FileList&&t.files.length?e.push(t.files):t.hasAttribute("data-value")?e.push(t.getAttribute("data-value")):e.push("");else if(t.matches('input[type="checkbox"]'))e.push(t.checked);else if(t.matches("select[multiple]")){let a=t.querySelectorAll("option:checked");for(let t of Array.from(a))e.push(t.value)}else e.push(t.value)})),!e.length)return;return 1===e.length&&(e=e[0]),e}return this.each((t=>{t.value=e})),this}_prepareForAttr(e){return"object"==typeof e?JSON.stringify(e):e}_readAttrValue(e){if(null==e)return e;if(!isNaN(e))return Number(e);let t;try{t=JSON.parse(e)}catch(t){return e}return t}css(e){if("string"==typeof e){let t=[];return this.each((a=>{let i=window.getComputedStyle(a)[e];"string"==typeof i&&i.includes("px")&&(i=Number(i.replace("px",""))),t.push(i)})),1===t.length?t[0]:t}if("object"==typeof e){let t="";for(let a in e){let i=e[a];"number"==typeof i&&(i=`${i}px`),t+=`${a}:${i};`}return this.each((e=>{e.setAttribute("style",t)})),this}}find(e){let t=[];return this.each((a=>{let i=a.querySelectorAll(e);i.length&&(t=[...t,...i])})),i(t)}firstChild(){let e=[];return this.each((t=>{let a=t.firstElementChild;null!==a&&e.push(a)})),e.length?i(e):null}lastChild(){let e=[];return this.each((t=>{let a=t.lastElementChild;null!==a&&e.push(a)})),e.length?i(e):null}parents(e){let t=[];return this.each((a=>{if(a===document)return this;let i=a.parentElement;for(;null!==i;)void 0!==e?i.matches(e)&&t.push(i):t.push(i),i=i.parentElement})),i(t)}hasParent(e){if(!this.els.length)throw new Error("Cannot call __().hasParent() on __Object without matched elements.");let t=!1;return this.each((a=>{if(t)return;let s=i(a).parents();s.els.length&&s.each((a=>{(e instanceof Element&&e===a||"string"==typeof e&&a.matches(e))&&(t=!0)}))})),t}closest(e){let t=[];return this.each((a=>{let i=a.closest(e);i&&t.push(i)})),i(t)}siblings(e,t){let a=[];return this.each((i=>{a="prev"===e?[...a,...this._getPrevSiblings(i,t)]:"next"===e?[...a,...this._getNextSiblings(i,t)]:"all"===e?[...a,...this._getAllSiblings(i,t)]:[...a,...this._getAllSiblings(i)]})),i(a)}_getAllSiblings(e,t){return[...this._getPrevSiblings(e,t).reverse(),e,...this._getNextSiblings(e,t)]}_getPrevSiblings(e,t){let a=[],i=e.previousElementSibling;for(;i;)void 0!==t?i.matches(t)&&a.push(i):a.push(i),i=i.previousElementSibling;return a}_getNextSiblings(e,t){let a=[],i=e.nextElementSibling;for(;i;)void 0!==t?i.matches(t)&&a.push(i):a.push(i),i=i.nextElementSibling;return a}remove(){this.each((e=>{e.remove()}))}removeChildren(){return this.each((e=>{e.innerHTML=""})),this}html(e){return this.each((t=>{t.innerHTML=e})),this}text(e){return this.each((t=>{t.innerText=e})),this}prependHtml(e){return this._insertHtml(e,"prepend")}appendHtml(e){return this._insertHtml(e,"append")}before(e){if(e)return this._insertHtml(e,"before");let t=[];return this.each((e=>{t.push(e.previousElementSibling)})),i(t)}after(e){if(e)return this._insertHtml(e,"after");let t=[];return this.each((e=>{t.push(e.nextElementSibling)})),i(t)}moveTo(e,t="afterbegin"){return this.each((a=>{e.insertAdjacentElement(t,a)})),this}_insertHtml(e,t="prepend"){let a=[];return this.each((i=>{"prepend"===t?e instanceof DocumentFragment||e instanceof Element?a.push(i.insertBefore(e,i.firstChild)):"string"==typeof e&&(i.insertAdjacentHTML("afterbegin",e),a.push(i.firstElementChild)):"append"===t?e instanceof DocumentFragment||e instanceof Element?a.push(i.appendChild(e)):"string"==typeof e&&(i.insertAdjacentHTML("beforeend",e),a.push(i.lastElementChild)):"before"===t?"string"==typeof e&&(i.insertAdjacentHTML("beforebegin",e),a.push(i.previousElementSibling)):"after"===t&&"string"==typeof e&&(i.insertAdjacentHTML("afterend",e),a.push(i.nextElementSibling))})),i(a)}wrapInto(e){return this.each((t=>{let a=document.createElement("template");a.innerHTML=e,t.parentNode.insertBefore(a.content,t),t.previousSibling.appendChild(t)})),this}unwrap(){this.each((e=>{let t=document.createDocumentFragment();for(;e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e)}))}randomStr(e=5,t="abcdefghijklmnopqrstuvwxyz1234567890"){let a=t.split(""),i=[];for(let t=1;t<=e;t++)i.push(a[Math.floor(Math.random()*a.length)]);return i.join("")}randomNumberBetween(e,t){return Math.round(Math.random()*(t-e)+e)}randomFromArray(e){let t=e[Math.floor(Math.random()*e.length)];return"object"==typeof t&&null!==t?{...t}:Array.isArray(t)?[...t]:t}odds(e,t=!1){let a=[],i=Object.values(e)[0].split("/").pop();for(let e=0;e<=i-1;e++)a.push("__UNFILLED__");if(t)return a;let s=0;for(let[t,i]of Object.entries(e)){let e=i.split("/")[0];for(let i=1;i<=e;i++)a[s]=t,s++}return this.randomFromArray(a)}shuffle(e){let t=e.length;for(;t>0;){let a=Math.floor(Math.random()*t);t--;let i=e[t];e[t]=e[a],e[a]=i}return e}getHtmlFromFile(e,t={},a=!1){return new Promise((async(e,t)=>(console.warn("Deprecated function. Switch to html.js."),"DEPRACATED")))}getJSONFromFile(e,t=!1,a=!1,i=!1){return new Promise((async(e,t)=>(console.warn("Deprecated function. Switch to html.js."),"DEPRACATED")))}getFileContents(e,t=!1){return new Promise(((i,s)=>{const n=a(747);if("object"!=typeof n)throw new Error("__ does not have access to the file system");if("__fileCache"in window||(window.__fileCache={}),!(e in window.__fileCache)||t)try{let t=n.readFileSync(__dirname+e,"utf8");window.__fileCache[e]=t,i(t)}catch(e){console.warn(e),s()}else i(window.__fileCache[e])}))}getTemplate(e){if(!this.els.length)return null;let t="";if(this.els[0].matches("template"))t=this.els[0].innerHTML;else for(let a of this.els){let i=a.querySelector(`template${e}`);i&&(t=i.innerHTML)}return""===t?(console.warn(`Could not find <template> for given selector: ${e}`),null):document.createRange().createContextualFragment(t)}width(){if(1!==this.els.length)throw new Error("__().width() expects exacly 1 item in the set of matches elements");return this.el().offsetWidth}height(){if(1!==this.els.length)throw new Error("__().height() expects exacly 1 item in the set of matches elements");return this.el().offsetHeight}position(){if(0===this.els.length)return[];let e=[];return this.each((t=>{let a=t.getBoundingClientRect();e.push({x:a.left,y:a.top})})),1===e.length?e[0]:e}animate(e,t,a){return new Promise(((i,s)=>{this.each((s=>{s.getAttribute("data-animation")&&s.classList.remove("animated",s.getAttribute("data-animation"));let n="string"==typeof t?t:void 0,r="string"==typeof a?a:void 0;n&&s.classList.add(n),r&&s.classList.add(r),s.setAttribute("data-animation",e),s.classList.add("animated",e),s.addEventListener("animationend",(()=>{s.classList.remove("animated",e,n,r),i(this)}))}))}))}show(e="block"){return this.each((t=>{t.style.display=e})),this}hide(){return this.each((e=>{e.style.display="none"})),this}enforceSingleton(e,t){return 2===i(e).els.length&&(i(t).remove(),console.error(`${e} is a singleton custom element; an extra copy was blocked from being created.`),!0)}trigger(e){let t=new MouseEvent(e,{view:window,bubbles:!0,cancelable:!0});this.each((e=>{e.dispatchEvent(t)}))}__doubleSlashesOnWindowsOnly(e){return"win32"===i("#app").attr("os")?e.replace(/\\/g,"\\\\"):e}convertSecondsToHHMMSS(e,t=!0,a=!0){let i=new Date(null);i.setSeconds(e);let s=i.toISOString().substr(11,8);return t&&"00:"===s.substr(0,3)&&(s=s.slice(3)),a&&"0"===s[0]&&(s=s.slice(1)),s}getArrayIntersection(e,t){return e.filter((e=>t.includes(e)))}infiniteScroll(e,t=".view-content"){if(1!==this.els.length)throw new Error("__().infiniteScroll() expects exactly 1 Element in the set of matched Elements");const a=this.els[0],i=document.querySelector(t),s=t=>{a.getBoundingClientRect().bottom<=i.getBoundingClientRect().bottom+600&&e()};return i.addEventListener("scroll",s),s}itemsPerRow(e){if(1!==this.els.length)throw new Error("__().itemsPerRow() expects exactly 1 Element in the set of matched Elements");let t=this.find(e);if(!t.els.length)return{0:0};let a=[];t.each((e=>{a.push(i(e).position().y)}));let s={};for(let e of a)s[e]=(s[e]||0)+1;return Object.values(s)}getShortest(){if(!this.els.length)throw new Error("__().getShortest() expects at least one Element in the set of matched Elements");let e=null,t=null;for(let a in this.els){let i=this.els[a].offsetHeight;(i<e||null===e)&&(e=i,t=a)}return i(this.els[t])}keepFocusWithin(e){if(!e)throw new Error("__().keepFocusWithin() expects a CSS selector");window.__focusTrap=t=>{if("Tab"!==t.code)return;let a=i(e).find(["a","button","select","input","textarea"].join(",")),s=[];a.each((e=>{let t=e.getBoundingClientRect();0!==t.width&&0!==t.height&&s.push(e)}));let n=s[0],r=s[s.length-1];if(null===t.target.closest(e))return t.preventDefault(),void n.focus();t.shiftKey||t.target!==r||(t.preventDefault(),n.focus()),t.shiftKey&&t.target===n&&(t.preventDefault(),r.focus())},document.addEventListener("keydown",window.__focusTrap)}releaseFocus(){document.removeEventListener("keydown",window.__focusTrap)}debouncer(e,t,a){let i;return function(){const s=arguments;let n=function(){console.log("later"),i=null,a||e.apply(null,s)},r=a&&!i;clearTimeout(i),i=setTimeout(n,t),r&&e.apply(null,s)}}throttler(e,t){let a=!1;return function(){a||(e.apply(null,arguments),a=!0,setTimeout((()=>{a=!1}),t))}}numberIsBetween(e,t,a,i=!0){let s=t,n=a;return i||(s=t+1),i||(n=a-1),e>=s&&e<=n}chunk(e,t=10){return e.reduce(((e,a,i)=>{let s=Math.floor(i/t);return e[s]||(e[s]=[]),e[s].push(a),e}),[])}}const n=i;class r{constructor(){this.appDebug=1,this.consoleColor="#1ba801",this.ipcListeners={},this._listenerForwarders={},this.wsListeners={},this._wsListenerForwarders={},this.ipcConnectionEstablished=!1,this.httpConnectionEstablished=!1,this.wsConnectionEstablished=!1}async init(e,t){if("ipc"===e)return await this._initIpc();if("http"===e)return await this._initHttp(t);if("ws"===e)return await this._initWs(t);throw new Error(`Unrecognized connection type "${e}"`)}async _initIpc(){try{this.electronIpc=a(933).ipcRenderer}catch(e){throw new Error("Cannot load Electron's ipcRenderer module")}return 200===await this.ipcAsk("status")?(this.ipcConnectionEstablished=!0,console.log("%cEstablished connection to Electron via IPC",`color:${this.consoleColor};`),!0):(console.error("Could not communicate with the Electron main process over IPC"),!1)}async _initHttp(e){if(!("scheme"in e))throw new Error("HTTP Bridge connection requires options.scheme");if(!("host"in e))throw new Error("HTTP Bridge connection requires options.host");if(!("port"in e))throw new Error("HTTP Bridge connection requires options.port");return this.httpServer=e,200===(await this.httpApi("/status")).status?(this.httpConnectionEstablished=!0,console.log("%cEstablished connection to HTTP server",`color:${this.consoleColor};`),!0):(console.error("Server did not return status 200"),!1)}async _initWs(e){if(!("scheme"in e))throw new Error("WebSocket Bridge connection requires options.scheme");if(!("host"in e))throw new Error("WebSocket Bridge connection requires options.host");if(!("port"in e))throw new Error("WebSocket Bridge connection requires options.port");this.wsServer=e;const t=`${this.wsServer.scheme}${this.wsServer.host}:${this.wsServer.port}`,a=e=>{this.BridgeWebSocket=new WebSocket(`${t}/bridge`),this.BridgeWebSocket.addEventListener("open",(t=>{e()})),this.BridgeWebSocket.addEventListener("message",(e=>{let t=JSON.parse(e.data),a=t.channel,i=t.message;if("connection-id"===a&&("connectionId"in this.wsServer?console.warn("Why is this connection receiving another connectionId?"):this.wsServer.connectionId=i),console.log(`Bridge received WebSocket message on channel ${a}`,i),a in this.wsListeners&&Array.isArray(this.wsListeners[a]))for(let e of this.wsListeners[a])e(i)})),this.BridgeWebSocket.addEventListener("error",(t=>{console.error("WebSocket error event",t),e(!0)})),this.BridgeWebSocket.addEventListener("close",(e=>{console.log("%cWebSocket connection closed",`color:${this.consoleColor};`)}))};return new Promise(((e,t)=>{let i=!1,s=!1,n=!1;setTimeout((()=>{s||i||(console.warn("WebSocket connection timed out while trying to establish initial connection"),n=!0,e(!1))}),2e3),a((t=>{if(!n){if(t)return i=!0,e(!1);s=!0,this.wsConnectionEstablished=!0,console.log("%cEstablished connection to WebSocket server",`color:${this.consoleColor};`),e(!0)}}))}))}ipcSay(e,t){this.electronIpc.send(e,t)}ipcAsk(e,t){return new Promise(((a,i)=>{this.electronIpc.invoke(e,t).then((e=>{a(e)}))}))}ipcListen(e,t){e in this.ipcListeners||(this.ipcListeners[e]=[]),this.ipcListeners[e].push(t),this.electronIpc.rawListeners(e).length||(this._listenerForwarders[e]=function(a,i){if(Array.isArray(this.ipcListeners[e]))for(let t of this.ipcListeners[e])t(i,a);else console.warn(`Tried to trigger callbacks for ipc channel '${e}' but no callbacks were registered. Should there still be an ipc forwarder for this event?`),console.log(e),console.log(t)}.bind(this),this.electronIpc.on(e,this._listenerForwarders[e]))}httpApi(e,t="GET",a=null){return new Promise(((i,s)=>{let n=`${this.httpApiUrl()}${e}`;var r=new XMLHttpRequest;r.addEventListener("error",(()=>{s()})),r.addEventListener("load",(function(e){let t={status:this.status,statusRange:Number(this.status.toString()[0]),response:"(Unparsed)",event:this};try{t.response=JSON.parse(this.response)}catch(e){t.response=this.response}i(t)})),"object"==typeof a&&null!==a&&(a=JSON.stringify(a)),r.open(t,n),r.send(a)}))}httpApiUrl(){return`${this.httpServer.scheme}${this.httpServer.host}:${this.httpServer.port}/api`}wsSay(e,t){if(!this.wsConnectionEstablished)return console.error("No WebSocket Connection"),!1;let a=JSON.stringify({channel:e,message:t});try{this.BridgeWebSocket.send(a)}catch(e){throw console.error("Error sending WebSocket message"),e}return!0}async wsListen(e,t){e in this.wsListeners||(this.wsListeners[e]=[]),await this.wsSay("add-channel",e),this.wsListeners[e].push(t)}removeListener(e,t,a=!1){return a?this.removeWsListener(e,t):this.removeIpcListener(e,t),!0}removeIpcListener(e,t){if(e in this.ipcListeners){for(let a in this.ipcListeners[e])this.ipcListeners[e][a]===t&&this.ipcListeners[e].splice(a,1);this.ipcListeners[e].length||(delete this.ipcListeners[e],this.electronIpc.removeListener(e,this._listenerForwarders[e]))}else console.trace(`Trying to remove IPC listener that does not exist: ${e}. This can happen if a custom element did not fully execute its connectedCallback() before its disconnectedCallback() was invoked. If it happens regularily, it's probably an extra Bridge.removeListener().`)}removeWsListener(e,t){if(e in this.wsListeners){for(let a in this.wsListeners[e])this.wsListeners[e][a]===t&&this.wsListeners[e].splice(a,1);this.wsListeners[e].length||delete this.wsListeners[e]}else console.warn(`Trying to remove WS listener that does not exist: ${e}. This can happen if a custom element did not fully execute its connectedCallback() before its disconnectedCallback() was invoked. If it happens regularily, it's probably an extra Bridge.removeListener().`)}__showListeners(e){console.log(this.electronIpc.rawListeners(e))}cleanup(){this.electronIpc.removeAllListeners(),this.ipcListeners={},this._listenerForwarders={},this.wsListeners={},this._wsListenerForwarders={}}}var o=/[\-\[\]{}()+?.,\\\^$|#\s]/g,l=/([:*])(\w+)/g;function d(e,t){var a=exports.toString.call(e).charAt(8);return"R"===a?e.test(t):"F"===a?e(t):e==t}function c(e,t){var a={},i=[],s=e;return"string"==typeof e?(s=(s=s.replace(o,"\\$&")).replace(l,(function(e,t,a){return i.push(a),":"===t?"([^/]*)":"(.*)"})),s=new RegExp("^"+s+"$"),a.parse=function(e){var a,n,r=0,o={},l=e.match(s);if(!l)return null;for(;r<i.length;){if(a=i[r++],n=l[r],t&&a in t&&!d(t[a],n))return null;o[a]=n}return o},a.stringify=function(t){var a,i,s=e;for(a in t)i=new RegExp("[:*]"+a+"\\b"),s=s.replace(i,t[a]);return s.replace(l,"")}):(a.parse=function(e){var t=e.match(s);return t&&{captures:t.slice(1)}},a.stringify=function(){return""}),a}const u={};function h(e,t={},a=Router.currentLang||"en"){return new Promise((async(i,s)=>{if(e instanceof DocumentFragment){let t=document.createElement("div");t.appendChild(e),e=t.innerHTML,t.remove()}if("string"!=typeof e||!e.length)return console.warn("html() was given an empty string, or something other than a string"),void i(e);"/"!==e[0]&&"\\"!==e[0]||(e=await m(e)),e=await function(e,t){return new Promise((async(a,i)=>{let s=p("inc",e);if(s.length){for(let a of s)await new Promise((async(i,s)=>{let n;try{n=".json"===a.slice(-5)?await f(a,"string"):await h(await m(a),t),e=e.replace(`{inc{${a}}}`,n),i()}catch(e){console.log(e),s()}}));a(e)}else a(e)}))}(e,t),i(e=function(e,t){if(!("i18n"in window))return;if(!(t in window.i18n))return;let a=p("i18n",e);if(!a.length)return e;for(let i of a)e=e.replace(`{i18n{${i}}}`,window.i18n[t][i]||i);return e}(e=function(e,t){if(!Object.keys(t).length)return e;let a=p("",e);if(!a.length)return e;for(let i of a)if(i in t){let a=t[i];null==a&&(a=""),e=e.replace(`{{${i}}}`,a)}return e}(e=function(e){return e.replace(/<!--[\s\S]*?-->/g,"")}(e),t),a))}))}function p(e,t){let a=[];if(!t.includes(`{${e}{`))return a;let i=t.split(`{${e}{`);for(let e=0;e<=i.length-1;e++)0!==e&&a.push(i[e].split("}}")[0]);return a}function m(e,t=!1){return new Promise(((i,s)=>{const n=a(747);if("object"!=typeof n)throw new Error("html.js does not have access to the file system");if(!(e in u)||t)try{let t=n.readFileSync(__dirname+e,"utf8");u[e]=t,i(t)}catch(e){console.warn(e),s()}else i(u[e])}))}function f(e,t="object",a=!1){return new Promise((async(i,s)=>{try{let s=await m(e,a),n=JSON.parse(s.trim());"string"===t?i(JSON.stringify(n)):"object"===t&&i(n)}catch(t){throw console.log(t),new Error("JSON file contained invalid JSON: "+e)}}))}class g{constructor(e){["mode","root","routes","langs","defaultLang"].forEach((t=>{if(!e.hasOwnProperty(t))throw new Error(`Router requires ${t} on init`)})),this.mode=e.mode,this.root=e.root,this.buttonSelector=".router-link",this.viewContentSelector=".view-content",this.cacheViews=e.cacheViews||!1,this.givenRoutes=e.routes,this.currentRoute=null,this.currentHref=null,this.models="models"in e?e.models:{},this.langs=e.langs,this.defaultLang=e.defaultLang,this.currentLang=e.currentLang||e.defaultLang,this._viewCache={},this._history=[],this._maxHistoryEntries=50,this._scrollTopDelay=0,this.currentViewWasLoadedFromCache=null,this._currentIndexInHistory=0,this.currentViewParams={},this._dontCacheCurrentViewOnNavAway=!1,this.consoleColor="#47aac9",this._registerEventHandlers(),this._buildRoutesReference(),this._buildModelsObject(),this._buildViewsObject()}go(e,t=!1){return new Promise((async(a,i)=>{if(void 0===e)throw new Error("Router.go() requires a URL");let s=this._isValidHref(e);if(!1===s)throw new Error("Route is invalid");(t||e!==this.currentHref)&&(this._saveScrollTopBeforeNavAway(),await this._loadRoute(s.route,e,s.params,t),this._currentIndexInHistory<this._history.length-1&&(this._history=this._history.slice(0,this._currentIndexInHistory+1)),this._addToHistory(e),this._currentIndexInHistory=this._history.length-1)}))}refresh(e=!0){this.go(this.currentHref,e)}async back(e=1){let t=this._currentIndexInHistory-e;if(t<0)return;let a=this._history[t].href,i=this._isValidHref(a);this._saveScrollTopBeforeNavAway(),await this._loadRoute(i.route,a,i.params),this._currentIndexInHistory=t,this._setScrollTop()}async forward(e=1){let t=this._currentIndexInHistory+e;if(t>this._history.length-1)return;let a=this._history[t].href,i=this._isValidHref(a);this._saveScrollTopBeforeNavAway(),await this._loadRoute(i.route,a,i.params),this._currentIndexInHistory=t,this._setScrollTop()}_setScrollTop(e=null){null===e&&(e=this._currentIndexInHistory),setTimeout((()=>{document.querySelector(this.viewContentSelector).scrollTop=this._history[e].scrollTop}),this._scrollTopDelay)}_buildRoutesReference(){let e=[];for(let t of this.givenRoutes)for(let a of this.langs)e.push({route:`/${a}${t.route}`,view:t.view,parent:t.parent||null});this.routes=e}_buildViewsObject(){let e={};for(let t of this.givenRoutes)for(let a of this.langs)e[`/${a}${t.route}`]=t.view;this.viewsObject=e}_buildModelsObject(){let e={};for(let t of this.givenRoutes)for(let a of this.langs)void 0!==t.model&&(e[`/${a}${t.route}`]=t.model);this.modelsObject=e}_isValidHref(e){if(void 0===e||""===e||"string"!=typeof e)return!1;this.langs.includes(e.split("/")[1])||(e="/"+this.currentLang+e);for(let t of this.routes){let a=c(t.route).parse(e);if(null!==a){for(let e in a)"id"===e&&(a[e]=parseInt(a[e]));return{href:e,route:t.route,params:a}}}return console.warn("Invalid href:",e),!1}async _loadRoute(e,t,a,i=!1){return new Promise((async(s,r)=>{Bridge.appDebug&&console.log(`%cLoading route: ${e}, hardRefresh: ${i}`,`color:${this.consoleColor};`),this.cacheViews&&null!==this.currentHref&&(this._dontCacheCurrentViewOnNavAway?this._dontCacheCurrentViewOnNavAway=!1:this._viewCache[this.currentHref]=n(this.root).el().innerHTML),n(this.root).removeChildren(),"ContextMenu"in window&&ContextMenu.closeAllContextMenus(),n("html").attr("lang",e.split("/")[1]),this.currentViewParams=a;let o=this.viewsObject[e],l="";if(this.cacheViews&&t in this._viewCache&&!i)l=this._viewCache[t],this.currentViewWasLoadedFromCache=!0;else{l=await m(`/views/${o}`);let t=null;if(this.modelsObject[e]){let a=this.modelsObject[e];t=await this.models[a]()}l=t?await h(l,t):await h(l),this.currentViewWasLoadedFromCache=!1}n(this.root).html(l),this.currentRoute=e,this.currentHref=t,this._setRouterLinkActiveStates(),n(this.root).attr("data-current-route",e),s()}))}_setRouterLinkActiveStates(){n(this.buttonSelector).removeClass("active"),n(`${this.buttonSelector}[href="${this.currentHref}"]`).addClass("active");let e={};for(let t of this.routes)e[t.route]=t.parent;let t=[];const a=i=>{let s=e[i];s&&(t.push(s),a("/"+this.currentLang+s))};if(a(this.currentRoute),t.length)for(let e of t)n(`${this.buttonSelector}[href="${e}"]`).addClass("active")}_addToHistory(e){let t={href:e,scrollTop:0};this._history.push(t),this._history.length+1>this._maxHistoryEntries&&(this._history=this._history.slice(-Math.abs(this._maxHistoryEntries)))}_saveScrollTopBeforeNavAway(){let e=document.querySelector(this.viewContentSelector);e&&(this._history[this._currentIndexInHistory].scrollTop=e.scrollTop)}_registerEventHandlers(){let e=this;document.addEventListener("mousedown",(e=>{4===e.which?this.back():5===e.which&&this.forward()}));let t,a=!1;document.addEventListener("mousewheel",(e=>{if(e.wheelDeltaX<-200||e.wheelDeltaX>200){if(a)return;a=!0;let i=e.wheelDeltaX>0?"back":"forward";"back"===i?this.back():"forward"===i&&this.forward(),t=setTimeout((()=>{console.log("%cunlocking swipe",`color:${this.consoleColor};`),a=!1}),750)}})),n(this.buttonSelector).on("click",!0,(function(t){if(t.preventDefault(),0===t.button){let a=!1;a="darwin"===n("#app").attr("os")?t.metaKey:t.ctrlKey,e.go(n(this).attr("href"),a)}})),n(this.buttonSelector).on("keyup",(function(e){"Space"===e.code&&n(this).trigger("click")}))}setLang(e){this.deleteViewCache(),this.deleteHistory(),n("html").attr("lang",e),this.currentLang=e}deleteHistory(){this._history=[]}deleteViewCache(){this._viewCache={},this._dontCacheCurrentViewOnNavAway=!0}}const v=class{constructor(e){return(async()=>{if("object"!=typeof e)throw new Error("Query requires a query object");if(!("table"in e))throw new Error("Query queryObj requires a table key");return this.mode="mode"in e?e.mode:"http",this.serverEndpoint="/query",this.serverMethod="POST",this.queryObj=Object.assign({page:1,itemsPerPage:100,columnCompare:"AND",equalityOperator:"=",prefix:"server_"},e),this.buildSql(),await this.execute(),await this.calculateTotals(),this.page=this.queryObj.page,this})()}buildSql(){let e="";e+=this._buildSelectClause(),e+=this._buildFromClause(),e+=this._buildJoinClause(),e+=this._buildWhereClause(),e+=this._buildOrderByClause(),e+=this._buildLimitClause(),e+=this._buildOffsetClause(),this.sql=e}async execute(){return this.results=await this._send(this.sql),this.afterExecute(),this}async _send(e){return"http"===this.mode?(await Bridge.httpApi(this.serverEndpoint,this.serverMethod,e)).response:"ipc"===this.mode?await Bridge.ipcAsk("sql",e):void 0}afterExecute(){if("join"in this.queryObj&&this.results.length)for(let e of this.results)"_primaryTableRowId"in e&&(e.id=e._primaryTableRowId,delete e._primaryTableRowId)}_buildSelectClause(){let e="";return"join"in this.queryObj&&(e=`\n\t${this.queryObj.prefix}${this.queryObj.table}.id AS _primaryTableRowId,`),`SELECT${e}\n\t*`}_buildFromClause(){return`\nFROM\n\t${this.queryObj.prefix}${this.queryObj.table}`}_buildJoinClause(){if(!("join"in this.queryObj)||"object"!=typeof this.queryObj.join||!Object.keys(this.queryObj.join).length)return"";let e;e=Array.isArray(this.queryObj.join)||"object"!=typeof this.queryObj.join||null===this.queryObj.join?this.queryObj.join:[this.queryObj.join];let t="";for(let a of e){if(!("table"in a))throw new Error('JOIN was given without the "table" key');if(!("on"in a))throw new Error('queryObj.join was given without the "on" key');let e="type"in a?a.type:"LEFT JOIN",i="equalityOperator"in a?a.equalityOperator:"=";t+=`\n${e}\n\t${this.queryObj.prefix}${a.table}`;for(let[e,s]of Object.entries(a.on))t+=`\n\tON ${this.queryObj.prefix}${this.queryObj.table}.${e} ${i} ${this.queryObj.prefix}${a.table}.${s}`}return t}_buildWhereClause(){if(!("columns"in this.queryObj)||"object"!=typeof this.queryObj.columns||!Object.keys(this.queryObj.columns).length)return"";let e="\nWHERE\n",t=this.queryObj.columns;Array.isArray(t)||(t=[{...t}]);for(let a of t){let t=this.queryObj.equalityOperator;"equalityOperator"in a&&(t=a.equalityOperator,delete a.equalityOperator);for(let[i,s]of Object.entries(a)){if(i.includes(".")&&(i=this.queryObj.prefix+i),"string"==typeof s)e+=`\t${i} ${t} '${s}'`;else if("number"==typeof s)e+=`\t${i} ${t} ${s}`;else if(Array.isArray(s)){let a="";for(let e of s)"string"==typeof e?a+=`"${e}",`:"number"==typeof e&&(a+=`${e},`);a=a.substr(0,a.length-1),e+=`\t${i} ${t} (${a})`}e+="\n"+this.queryObj.columnCompare+"\n"}}return e=e.slice(0,e.length-(this.queryObj.columnCompare.length+2)),e}_buildOrderByClause(){if(!("orderBy"in this.queryObj))return"";if("rand"===this.queryObj.orderBy)return"\nORDER BY RANDOM()";if("object"!=typeof this.queryObj.orderBy||!Object.keys(this.queryObj.orderBy).length)return"";let e="\nORDER BY";for(let[t,a]of Object.entries(this.queryObj.orderBy))e+=`\n\t${t} COLLATE NOCASE ${a},`;return e=e.slice(0,e.length-1),e}_buildLimitClause(){return-1===this.queryObj.itemsPerPage?"":`\nLIMIT\n\t${this.queryObj.itemsPerPage}`}_buildOffsetClause(){return-1===this.queryObj.itemsPerPage||1===this.queryObj.page?"":`\nOFFSET\n\t${this._calculateOffset()}`}_calculateOffset(){return this.queryObj.page*this.queryObj.itemsPerPage-this.queryObj.itemsPerPage}async goToPage(e){return e===this.page||(e>this.pages&&(e=this.pages),this.queryObj.page=e,this.page=e,this.buildSql(),await this.execute()),this}async calculateTotals(){if(-1===this.queryObj.itemsPerPage)return this.pages=1,this.totalResults=this.results.length,this;let e=this.sql;e=e.replace(/[^*]*/,""),e=e.replace("*","SELECT COUNT(*) AS numItems"),e=e.replace(`OFFSET\n\t${this._calculateOffset()}`,"");let t=await this._send(e);return this.totalResults=t[0].numItems,this.pages=Math.ceil(Number(t[0].numItems)/Number(this.queryObj.itemsPerPage)),this}};function y(e,t="en"){return!t&&"Router"in window&&"currentLang"in window.Router&&(t=Router.currentLang),"i18n"in window?window.i18n.hasOwnProperty(t)?window.i18n[t].hasOwnProperty(e)?window.i18n[t][e]:e:(console.error(`Language ${t} does not exist in i18n.`),e):(console.error("Missing key-value i18n store"),e)}var b=function(){this.init()};b.prototype={init:function(){var e=this||w;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||w;if(e=parseFloat(e),t.ctx||A(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,w.ctx.currentTime);for(var a=0;a<t._howls.length;a++)if(!t._howls[a]._webAudio)for(var i=t._howls[a]._getSoundIds(),s=0;s<i.length;s++){var n=t._howls[a]._soundById(i[s]);n&&n._node&&(n._node.volume=n._volume*e)}return t}return t._volume},mute:function(e){var t=this||w;t.ctx||A(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,w.ctx.currentTime);for(var a=0;a<t._howls.length;a++)if(!t._howls[a]._webAudio)for(var i=t._howls[a]._getSoundIds(),s=0;s<i.length;s++){var n=t._howls[a]._soundById(i[s]);n&&n._node&&(n._node.muted=!!e||n._muted)}return t},stop:function(){for(var e=this||w,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||w,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,A()),e},codecs:function(e){return(this||w)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||w;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||w,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var a=t.canPlayType("audio/mpeg;").replace(/^no$/,""),i=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),s=i&&parseInt(i[0].split("/")[1],10)<33;return e._codecs={mp3:!(s||!a&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!a,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||w;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(a){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var i=new Audio;i._unlocked=!0,e._releaseHtml5Audio(i)}catch(a){e.noAudio=!0;break}for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var n=e._howls[s]._getSoundIds(),r=0;r<n.length;r++){var o=e._howls[s]._soundById(n[r]);o&&o._node&&!o._node._unlocked&&(o._node._unlocked=!0,o._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0);for(var a=0;a<e._howls.length;a++)e._howls[a]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),e}},_obtainHtml5Audio:function(){var e=this||w;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||w;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&w.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var a=0;a<e._howls[t]._sounds.length;a++)if(!e._howls[t]._sounds[a]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&w.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var w=new b,_=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};_.prototype={init:function(e){var t=this;return w.ctx||A(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=w.usingWebAudio&&!t._html5,void 0!==w.ctx&&w.ctx&&w.autoUnlock&&w._unlockAudio(),w._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(w.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var a=0;a<e._src.length;a++){var i,s;if(e._format&&e._format[a])i=e._format[a];else{if("string"!=typeof(s=e._src[a])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(s))||(i=/\.([^.]+)$/.exec(s.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&w.codecs(i)){t=e._src[a];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new k(e),e._webAudio&&S(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var a=this,i=null;if("number"==typeof e)i=e,e=null;else{if("string"==typeof e&&"loaded"===a._state&&!a._sprite[e])return null;if(void 0===e&&(e="__default",!a._playLock)){for(var s=0,n=0;n<a._sounds.length;n++)a._sounds[n]._paused&&!a._sounds[n]._ended&&(s++,i=a._sounds[n]._id);1===s?e=null:i=null}}var r=i?a._soundById(i):a._inactiveSound();if(!r)return null;if(i&&!e&&(e=r._sprite||"__default"),"loaded"!==a._state){r._sprite=e,r._ended=!1;var o=r._id;return a._queue.push({event:"play",action:function(){a.play(o)}}),o}if(i&&!r._paused)return t||a._loadQueue("play"),r._id;a._webAudio&&w._autoResume();var l=Math.max(0,r._seek>0?r._seek:a._sprite[e][0]/1e3),d=Math.max(0,(a._sprite[e][0]+a._sprite[e][1])/1e3-l),c=1e3*d/Math.abs(r._rate),u=a._sprite[e][0]/1e3,h=(a._sprite[e][0]+a._sprite[e][1])/1e3;r._sprite=e,r._ended=!1;var p=function(){r._paused=!1,r._seek=l,r._start=u,r._stop=h,r._loop=!(!r._loop&&!a._sprite[e][2])};if(!(l>=h)){var m=r._node;if(a._webAudio){var f=function(){a._playLock=!1,p(),a._refreshBuffer(r);var e=r._muted||a._muted?0:r._volume;m.gain.setValueAtTime(e,w.ctx.currentTime),r._playStart=w.ctx.currentTime,void 0===m.bufferSource.start?r._loop?m.bufferSource.noteGrainOn(0,l,86400):m.bufferSource.noteGrainOn(0,l,d):r._loop?m.bufferSource.start(0,l,86400):m.bufferSource.start(0,l,d),c!==1/0&&(a._endTimers[r._id]=setTimeout(a._ended.bind(a,r),c)),t||setTimeout((function(){a._emit("play",r._id),a._loadQueue()}),0)};"running"===w.state&&"interrupted"!==w.ctx.state?f():(a._playLock=!0,a.once("resume",f),a._clearTimer(r._id))}else{var g=function(){m.currentTime=l,m.muted=r._muted||a._muted||w._muted||m.muted,m.volume=r._volume*w.volume(),m.playbackRate=r._rate;try{var i=m.play();if(i&&"undefined"!=typeof Promise&&(i instanceof Promise||"function"==typeof i.then)?(a._playLock=!0,p(),i.then((function(){a._playLock=!1,m._unlocked=!0,t||(a._emit("play",r._id),a._loadQueue())})).catch((function(){a._playLock=!1,a._emit("playerror",r._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),r._ended=!0,r._paused=!0}))):t||(a._playLock=!1,p(),a._emit("play",r._id),a._loadQueue()),m.playbackRate=r._rate,m.paused)return void a._emit("playerror",r._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||r._loop?a._endTimers[r._id]=setTimeout(a._ended.bind(a,r),c):(a._endTimers[r._id]=function(){a._ended(r),m.removeEventListener("ended",a._endTimers[r._id],!1)},m.addEventListener("ended",a._endTimers[r._id],!1))}catch(e){a._emit("playerror",r._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=a._src,m.load());var v=window&&window.ejecta||!m.readyState&&w._navigator.isCocoonJS;if(m.readyState>=3||v)g();else{a._playLock=!0;var y=function(){g(),m.removeEventListener(w._canPlayEvent,y,!1)};m.addEventListener(w._canPlayEvent,y,!1),a._clearTimer(r._id)}}return r._id}a._ended(r)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var a=t._getSoundIds(e),i=0;i<a.length;i++){t._clearTimer(a[i]);var s=t._soundById(a[i]);if(s&&!s._paused&&(s._seek=t.seek(a[i]),s._rateSeek=0,s._paused=!0,t._stopFade(a[i]),s._node))if(t._webAudio){if(!s._node.bufferSource)continue;void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),t._cleanBuffer(s._node)}else isNaN(s._node.duration)&&s._node.duration!==1/0||s._node.pause();arguments[1]||t._emit("pause",s?s._id:null)}return t},stop:function(e,t){var a=this;if("loaded"!==a._state||a._playLock)return a._queue.push({event:"stop",action:function(){a.stop(e)}}),a;for(var i=a._getSoundIds(e),s=0;s<i.length;s++){a._clearTimer(i[s]);var n=a._soundById(i[s]);n&&(n._seek=n._start||0,n._rateSeek=0,n._paused=!0,n._ended=!0,a._stopFade(i[s]),n._node&&(a._webAudio?n._node.bufferSource&&(void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),a._cleanBuffer(n._node)):isNaN(n._node.duration)&&n._node.duration!==1/0||(n._node.currentTime=n._start||0,n._node.pause(),n._node.duration===1/0&&a._clearSound(n._node))),t||a._emit("stop",n._id))}return a},mute:function(e,t){var a=this;if("loaded"!==a._state||a._playLock)return a._queue.push({event:"mute",action:function(){a.mute(e,t)}}),a;if(void 0===t){if("boolean"!=typeof e)return a._muted;a._muted=e}for(var i=a._getSoundIds(t),s=0;s<i.length;s++){var n=a._soundById(i[s]);n&&(n._muted=e,n._interval&&a._stopFade(n._id),a._webAudio&&n._node?n._node.gain.setValueAtTime(e?0:n._volume,w.ctx.currentTime):n._node&&(n._node.muted=!!w._muted||e),a._emit("mute",n._id))}return a},volume:function(){var e,t,a,i=this,s=arguments;if(0===s.length)return i._volume;if(1===s.length||2===s.length&&void 0===s[1]){var n=i._getSoundIds(),r=n.indexOf(s[0]);r>=0?t=parseInt(s[0],10):e=parseFloat(s[0])}else s.length>=2&&(e=parseFloat(s[0]),t=parseInt(s[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(a=t?i._soundById(t):i._sounds[0])?a._volume:0;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,s)}}),i;void 0===t&&(i._volume=e),t=i._getSoundIds(t);for(var o=0;o<t.length;o++)(a=i._soundById(t[o]))&&(a._volume=e,s[2]||i._stopFade(t[o]),i._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(e,w.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=e*w.volume()),i._emit("volume",a._id));return i},fade:function(e,t,a,i){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(e,t,a,i)}}),s;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),a=parseFloat(a),s.volume(e,i);for(var n=s._getSoundIds(i),r=0;r<n.length;r++){var o=s._soundById(n[r]);if(o){if(i||s._stopFade(n[r]),s._webAudio&&!o._muted){var l=w.ctx.currentTime,d=l+a/1e3;o._volume=e,o._node.gain.setValueAtTime(e,l),o._node.gain.linearRampToValueAtTime(t,d)}s._startFadeInterval(o,e,t,a,n[r],void 0===i)}}return s},_startFadeInterval:function(e,t,a,i,s,n){var r=this,o=t,l=a-t,d=Math.abs(l/.01),c=Math.max(4,d>0?i/d:i),u=Date.now();e._fadeTo=a,e._interval=setInterval((function(){var s=(Date.now()-u)/i;u=Date.now(),o+=l*s,o=Math.round(100*o)/100,o=l<0?Math.max(a,o):Math.min(a,o),r._webAudio?e._volume=o:r.volume(o,e._id,!0),n&&(r._volume=o),(a<t&&o<=a||a>t&&o>=a)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,r.volume(a,e._id),r._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,a=t._soundById(e);return a&&a._interval&&(t._webAudio&&a._node.gain.cancelScheduledValues(w.ctx.currentTime),clearInterval(a._interval),a._interval=null,t.volume(a._fadeTo,e),a._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,a,i=this,s=arguments;if(0===s.length)return i._loop;if(1===s.length){if("boolean"!=typeof s[0])return!!(a=i._soundById(parseInt(s[0],10)))&&a._loop;e=s[0],i._loop=e}else 2===s.length&&(e=s[0],t=parseInt(s[1],10));for(var n=i._getSoundIds(t),r=0;r<n.length;r++)(a=i._soundById(n[r]))&&(a._loop=e,i._webAudio&&a._node&&a._node.bufferSource&&(a._node.bufferSource.loop=e,e&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop)));return i},rate:function(){var e,t,a,i=this,s=arguments;if(0===s.length)t=i._sounds[0]._id;else if(1===s.length){var n=i._getSoundIds(),r=n.indexOf(s[0]);r>=0?t=parseInt(s[0],10):e=parseFloat(s[0])}else 2===s.length&&(e=parseFloat(s[0]),t=parseInt(s[1],10));if("number"!=typeof e)return(a=i._soundById(t))?a._rate:i._rate;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,s)}}),i;void 0===t&&(i._rate=e),t=i._getSoundIds(t);for(var o=0;o<t.length;o++)if(a=i._soundById(t[o])){i.playing(t[o])&&(a._rateSeek=i.seek(t[o]),a._playStart=i._webAudio?w.ctx.currentTime:a._playStart),a._rate=e,i._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.setValueAtTime(e,w.ctx.currentTime):a._node&&(a._node.playbackRate=e);var l=i.seek(t[o]),d=(i._sprite[a._sprite][0]+i._sprite[a._sprite][1])/1e3-l,c=1e3*d/Math.abs(a._rate);!i._endTimers[t[o]]&&a._paused||(i._clearTimer(t[o]),i._endTimers[t[o]]=setTimeout(i._ended.bind(i,a),c)),i._emit("rate",a._id)}return i},seek:function(){var e,t,a=this,i=arguments;if(0===i.length)t=a._sounds[0]._id;else if(1===i.length){var s=a._getSoundIds(),n=s.indexOf(i[0]);n>=0?t=parseInt(i[0],10):a._sounds.length&&(t=a._sounds[0]._id,e=parseFloat(i[0]))}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(void 0===t)return a;if("number"==typeof e&&("loaded"!==a._state||a._playLock))return a._queue.push({event:"seek",action:function(){a.seek.apply(a,i)}}),a;var r=a._soundById(t);if(r){if(!("number"==typeof e&&e>=0)){if(a._webAudio){var o=a.playing(t)?w.ctx.currentTime-r._playStart:0,l=r._rateSeek?r._rateSeek-r._seek:0;return r._seek+(l+o*Math.abs(r._rate))}return r._node.currentTime}var d=a.playing(t);d&&a.pause(t,!0),r._seek=e,r._ended=!1,a._clearTimer(t),a._webAudio||!r._node||isNaN(r._node.duration)||(r._node.currentTime=e);var c=function(){a._emit("seek",t),d&&a.play(t,!0)};if(d&&!a._webAudio){var u=function(){a._playLock?setTimeout(u,0):c()};setTimeout(u,0)}else c()}return a},playing:function(e){var t=this;if("number"==typeof e){var a=t._soundById(e);return!!a&&!a._paused}for(var i=0;i<t._sounds.length;i++)if(!t._sounds[i]._paused)return!0;return!1},duration:function(e){var t=this,a=t._duration,i=t._soundById(e);return i&&(a=t._sprite[i._sprite][1]/1e3),a},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,a=0;a<t.length;a++)t[a]._paused||e.stop(t[a]._id),e._webAudio||(e._clearSound(t[a]._node),t[a]._node.removeEventListener("error",t[a]._errorFn,!1),t[a]._node.removeEventListener(w._canPlayEvent,t[a]._loadFn,!1),t[a]._node.removeEventListener("ended",t[a]._endFn,!1),w._releaseHtml5Audio(t[a]._node)),delete t[a]._node,e._clearTimer(t[a]._id);var i=w._howls.indexOf(e);i>=0&&w._howls.splice(i,1);var s=!0;for(a=0;a<w._howls.length;a++)if(w._howls[a]._src===e._src||e._src.indexOf(w._howls[a]._src)>=0){s=!1;break}return x&&s&&delete x[e._src],w.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,a,i){var s=this["_on"+e];return"function"==typeof t&&s.push(i?{id:a,fn:t,once:i}:{id:a,fn:t}),this},off:function(e,t,a){var i=this,s=i["_on"+e],n=0;if("number"==typeof t&&(a=t,t=null),t||a)for(n=0;n<s.length;n++){var r=a===s[n].id;if(t===s[n].fn&&r||!t&&r){s.splice(n,1);break}}else if(e)i["_on"+e]=[];else{var o=Object.keys(i);for(n=0;n<o.length;n++)0===o[n].indexOf("_on")&&Array.isArray(i[o[n]])&&(i[o[n]]=[])}return i},once:function(e,t,a){return this.on(e,t,a,1),this},_emit:function(e,t,a){for(var i=this,s=i["_on"+e],n=s.length-1;n>=0;n--)s[n].id&&s[n].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,a)}.bind(i,s[n].fn),0),s[n].once&&i.off(e,s[n].fn,s[n].id));return i._loadQueue(e),i},_loadQueue:function(e){var t=this;if(t._queue.length>0){var a=t._queue[0];a.event===e&&(t._queue.shift(),t._loadQueue()),e||a.action()}return t},_ended:function(e){var t=this,a=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var i=!(!e._loop&&!t._sprite[a][2]);if(t._emit("end",e._id),!t._webAudio&&i&&t.stop(e._id,!0).play(e._id),t._webAudio&&i){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=w.ctx.currentTime;var s=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),s)}return t._webAudio&&!i&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),w._autoSuspend()),t._webAudio||i||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var a=t._soundById(e);a&&a._node&&a._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,a=0;a<t._sounds.length;a++)if(e===t._sounds[a]._id)return t._sounds[a];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new k(e)},_drain:function(){var e=this,t=e._pool,a=0,i=0;if(!(e._sounds.length<t)){for(i=0;i<e._sounds.length;i++)e._sounds[i]._ended&&a++;for(i=e._sounds.length-1;i>=0;i--){if(a<=t)return;e._sounds[i]._ended&&(e._webAudio&&e._sounds[i]._node&&e._sounds[i]._node.disconnect(0),e._sounds.splice(i,1),a--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],a=0;a<this._sounds.length;a++)t.push(this._sounds[a]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=w.ctx.createBufferSource(),e._node.bufferSource.buffer=x[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,w.ctx.currentTime),this},_cleanBuffer:function(e){var t=w._navigator&&w._navigator.vendor.indexOf("Apple")>=0;if(w._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=w._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(w._navigator&&w._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var k=function(e){this._parent=e,this.init()};k.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++w._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,a=w._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===w.ctx.createGain?w.ctx.createGainNode():w.ctx.createGain(),e._node.gain.setValueAtTime(a,w.ctx.currentTime),e._node.paused=!0,e._node.connect(w.masterGain)):w.noAudio||(e._node=w._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(w._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=a*w.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++w._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(w._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var C,x={},S=function(e){var t=e._src;if(x[t])return e._duration=x[t].duration,void P(e);if(/^data:[^;]+;base64,/.test(t)){for(var a=atob(t.split(",")[1]),i=new Uint8Array(a.length),s=0;s<a.length;++s)i[s]=a.charCodeAt(s);E(i.buffer,e)}else{var n=new XMLHttpRequest;n.open(e._xhr.method,t,!0),n.withCredentials=e._xhr.withCredentials,n.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){n.setRequestHeader(t,e._xhr.headers[t])})),n.onload=function(){var t=(n.status+"")[0];"0"===t||"2"===t||"3"===t?E(n.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+n.status+".")},n.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete x[t],e.load())},T(n)}},T=function(e){try{e.send()}catch(t){e.onerror()}},E=function(e,t){var a=function(){t._emit("loaderror",null,"Decoding audio data failed.")},i=function(e){e&&t._sounds.length>0?(x[t._src]=e,P(t,e)):a()};"undefined"!=typeof Promise&&1===w.ctx.decodeAudioData.length?w.ctx.decodeAudioData(e).then(i).catch(a):w.ctx.decodeAudioData(e,i,a)},P=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},A=function(){if(w.usingWebAudio){try{"undefined"!=typeof AudioContext?w.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?w.ctx=new webkitAudioContext:w.usingWebAudio=!1}catch(e){w.usingWebAudio=!1}w.ctx||(w.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(w._navigator&&w._navigator.platform),t=w._navigator&&w._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),a=t?parseInt(t[1],10):null;if(e&&a&&a<9){var i=/safari/.test(w._navigator&&w._navigator.userAgent.toLowerCase());w._navigator&&!i&&(w.usingWebAudio=!1)}w.usingWebAudio&&(w.masterGain=void 0===w.ctx.createGain?w.ctx.createGainNode():w.ctx.createGain(),w.masterGain.gain.setValueAtTime(w._muted?0:w._volume,w.ctx.currentTime),w.masterGain.connect(w.ctx.destination)),w._setup()}};"function"==typeof define&&a.amdO&&define([],(function(){return{Howler:w,Howl:_}})),"undefined"!=typeof exports&&(exports.Howler=w,exports.Howl=_),"undefined"!=typeof global?(global.HowlerGlobal=b,global.Howler=w,global.Howl=_,global.Sound=k):"undefined"!=typeof window&&(window.HowlerGlobal=b,window.Howler=w,window.Howl=_,window.Sound=k),b.prototype._pos=[0,0,0],b.prototype._orientation=[0,0,-1,0,1,0],b.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var a=t._howls.length-1;a>=0;a--)t._howls[a].stereo(e);return t},b.prototype.pos=function(e,t,a){var i=this;return i.ctx&&i.ctx.listener?(t="number"!=typeof t?i._pos[1]:t,a="number"!=typeof a?i._pos[2]:a,"number"!=typeof e?i._pos:(i._pos=[e,t,a],void 0!==i.ctx.listener.positionX?(i.ctx.listener.positionX.setTargetAtTime(i._pos[0],w.ctx.currentTime,.1),i.ctx.listener.positionY.setTargetAtTime(i._pos[1],w.ctx.currentTime,.1),i.ctx.listener.positionZ.setTargetAtTime(i._pos[2],w.ctx.currentTime,.1)):i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},b.prototype.orientation=function(e,t,a,i,s,n){var r=this;if(!r.ctx||!r.ctx.listener)return r;var o=r._orientation;return t="number"!=typeof t?o[1]:t,a="number"!=typeof a?o[2]:a,i="number"!=typeof i?o[3]:i,s="number"!=typeof s?o[4]:s,n="number"!=typeof n?o[5]:n,"number"!=typeof e?o:(r._orientation=[e,t,a,i,s,n],void 0!==r.ctx.listener.forwardX?(r.ctx.listener.forwardX.setTargetAtTime(e,w.ctx.currentTime,.1),r.ctx.listener.forwardY.setTargetAtTime(t,w.ctx.currentTime,.1),r.ctx.listener.forwardZ.setTargetAtTime(a,w.ctx.currentTime,.1),r.ctx.listener.upX.setTargetAtTime(i,w.ctx.currentTime,.1),r.ctx.listener.upY.setTargetAtTime(s,w.ctx.currentTime,.1),r.ctx.listener.upZ.setTargetAtTime(n,w.ctx.currentTime,.1)):r.ctx.listener.setOrientation(e,t,a,i,s,n),r)},_.prototype.init=(C=_.prototype.init,function(e){var t=this;return t._orientation=e.orientation||[1,0,0],t._stereo=e.stereo||null,t._pos=e.pos||null,t._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},t._onstereo=e.onstereo?[{fn:e.onstereo}]:[],t._onpos=e.onpos?[{fn:e.onpos}]:[],t._onorientation=e.onorientation?[{fn:e.onorientation}]:[],C.call(this,e)}),_.prototype.stereo=function(e,t){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"stereo",action:function(){a.stereo(e,t)}}),a;var i=void 0===w.ctx.createStereoPanner?"spatial":"stereo";if(void 0===t){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0]}for(var s=a._getSoundIds(t),n=0;n<s.length;n++){var r=a._soundById(s[n]);if(r){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0],r._node&&(r._pannerAttr.panningModel="equalpower",r._panner&&r._panner.pan||L(r,i),"spatial"===i?void 0!==r._panner.positionX?(r._panner.positionX.setValueAtTime(e,w.ctx.currentTime),r._panner.positionY.setValueAtTime(0,w.ctx.currentTime),r._panner.positionZ.setValueAtTime(0,w.ctx.currentTime)):r._panner.setPosition(e,0,0):r._panner.pan.setValueAtTime(e,w.ctx.currentTime)),a._emit("stereo",r._id)}}return a},_.prototype.pos=function(e,t,a,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(e,t,a,i)}}),s;if(t="number"!=typeof t?0:t,a="number"!=typeof a?-.5:a,void 0===i){if("number"!=typeof e)return s._pos;s._pos=[e,t,a]}for(var n=s._getSoundIds(i),r=0;r<n.length;r++){var o=s._soundById(n[r]);if(o){if("number"!=typeof e)return o._pos;o._pos=[e,t,a],o._node&&(o._panner&&!o._panner.pan||L(o,"spatial"),void 0!==o._panner.positionX?(o._panner.positionX.setValueAtTime(e,w.ctx.currentTime),o._panner.positionY.setValueAtTime(t,w.ctx.currentTime),o._panner.positionZ.setValueAtTime(a,w.ctx.currentTime)):o._panner.setPosition(e,t,a)),s._emit("pos",o._id)}}return s},_.prototype.orientation=function(e,t,a,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(e,t,a,i)}}),s;if(t="number"!=typeof t?s._orientation[1]:t,a="number"!=typeof a?s._orientation[2]:a,void 0===i){if("number"!=typeof e)return s._orientation;s._orientation=[e,t,a]}for(var n=s._getSoundIds(i),r=0;r<n.length;r++){var o=s._soundById(n[r]);if(o){if("number"!=typeof e)return o._orientation;o._orientation=[e,t,a],o._node&&(o._panner||(o._pos||(o._pos=s._pos||[0,0,-.5]),L(o,"spatial")),void 0!==o._panner.orientationX?(o._panner.orientationX.setValueAtTime(e,w.ctx.currentTime),o._panner.orientationY.setValueAtTime(t,w.ctx.currentTime),o._panner.orientationZ.setValueAtTime(a,w.ctx.currentTime)):o._panner.setOrientation(e,t,a)),s._emit("orientation",o._id)}}return s},_.prototype.pannerAttr=function(){var e,t,a,i=this,s=arguments;if(!i._webAudio)return i;if(0===s.length)return i._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return(a=i._soundById(parseInt(s[0],10)))?a._pannerAttr:i._pannerAttr;e=s[0],void 0===t&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===s.length&&(e=s[0],t=parseInt(s[1],10));for(var n=i._getSoundIds(t),r=0;r<n.length;r++)if(a=i._soundById(n[r])){var o=a._pannerAttr;o={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:o.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:o.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:o.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:o.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:o.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:o.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:o.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:o.panningModel};var l=a._panner;l?(l.coneInnerAngle=o.coneInnerAngle,l.coneOuterAngle=o.coneOuterAngle,l.coneOuterGain=o.coneOuterGain,l.distanceModel=o.distanceModel,l.maxDistance=o.maxDistance,l.refDistance=o.refDistance,l.rolloffFactor=o.rolloffFactor,l.panningModel=o.panningModel):(a._pos||(a._pos=i._pos||[0,0,-.5]),L(a,"spatial"))}return i},k.prototype.init=function(e){return function(){var t=this,a=t._parent;t._orientation=a._orientation,t._stereo=a._stereo,t._pos=a._pos,t._pannerAttr=a._pannerAttr,e.call(this),t._stereo?a.stereo(t._stereo):t._pos&&a.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(k.prototype.init),k.prototype.reset=function(e){return function(){var t=this,a=t._parent;return t._orientation=a._orientation,t._stereo=a._stereo,t._pos=a._pos,t._pannerAttr=a._pannerAttr,t._stereo?a.stereo(t._stereo):t._pos?a.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,a._refreshBuffer(t)),e.call(this)}}(k.prototype.reset);var L=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=w.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],w.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],w.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],w.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],w.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],w.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],w.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=w.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,w.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)};class M extends HTMLElement{async connectedCallback(){this.locked=this.hasAttribute("locked"),this.locked||(this.debug=0,this.consoleColor="#f05ee4",this.interactingClassName="interacting",this.spawned=!1,this.built=!1,this.rendered=!1,this.attrObservers=[],this.__preservedProps=this.props,this.props=this._newPropsProxiedObject(),this.debug&&(console.log("%cLowrider connectedCallback for:",`color:${this.consoleColor};`),console.log(this)),this.classList.remove(this.interactingClassName),await this.spawn(),this.isUsingLazyRenderMode()?this.enableLazyRender():this.isUsingRenderQueue()?this.addToRenderQueue():this._finishRender())}disconnectedCallback(){this.locked||(this._supportedInfiniteScrollEventListener&&this._supportedInfiniteScrollParent.removeEventListener("scroll",this._supportedInfiniteScrollEventListener),"onRemoved"in this&&this.onRemoved())}async spawn(e){if(!this.locked)return"onSpawn"in this&&!1===await this.onSpawn(e)?(this.spawned=!1,!1):(this.spawned=!0,!0)}async build(e){if(this.locked)return;let t;return"onBuild"in this&&(t=await this.onBuild(e),this.built=!1!==t),t}async load(){if("onLoad"in this&&this.onLoad(),"object"==typeof this.__preservedProps&&null!==this.__preservedProps)for(let[e,t]of Object.entries(this.__preservedProps))this.props[e]=t}async shouldBuild(){return!this.locked&&null===this.firstElementChild}_newPropsProxiedObject(){return new Proxy({},{set:(e,t,a)=>{e[t]=a;for(let e of this.querySelectorAll(`[data-prop="${t}"]`))e.innerHTML=a;return!0}})}_ensureGlobals(){"LowriderGlobals"in window||(window.LowriderGlobals={renderQueues:{}})}isUsingRenderQueue(){return this.hasAttribute("render-queue")}_createRenderQueue(e){if(e in window.LowriderGlobals.renderQueues)throw new Error(`Render queue ${e} already exists`);console.log(`Creating render queue ${e}`),window.LowriderGlobals.renderQueues[e]={queue:[],running:!1,runner:async()=>{if(window.LowriderGlobals.renderQueues[e].running)return void console.log("cant run twice, normal");window.LowriderGlobals.renderQueues[e].running=!0;let t=window.LowriderGlobals.renderQueues[e].queue;for(;t.length;){let a=t[0];a.classList.remove("in-render-queue"),await a._finishRender(),t.splice(0,1),console.log(`render queue ${e} rendered item`)}window.LowriderGlobals.renderQueues[e].running=!1,console.log(`Render queue ${e} cleared!`)}}}addToRenderQueue(){this._ensureGlobals();let e=this.getAttribute("render-queue")||"default";e in window.LowriderGlobals.renderQueues||this._createRenderQueue(e),window.LowriderGlobals.renderQueues[e].queue.push(this),this.classList.add("in-render-queue"),setTimeout((()=>{this._runRenderQueue(e)}),0)}_runRenderQueue(e){if(!(e in window.LowriderGlobals.renderQueues))throw new Error(`Render queue ${e} does not exist`);window.LowriderGlobals.renderQueues[e].running||window.LowriderGlobals.renderQueues[e].runner()}isUsingLazyRenderMode(){return this.hasAttribute("lazy-render")}enableLazyRender(){if("_intersectionObserver"in this&&this._intersectionObserver instanceof IntersectionObserver)throw new Error("Already observing visibility");this._lazyRenderAttrWatcher=this.watchAttr("lazy-render",(e=>{this.isUsingLazyRenderMode()&&this.disableLazyRender()})),this._intersectionObserver=new IntersectionObserver((async(e,t)=>{e[0].isIntersecting&&(this.disableLazyRender(),this.isUsingRenderQueue()?this.addToRenderQueue():this._finishRender())})),this._intersectionObserver.observe(this)}disableLazyRender(){if(!("_intersectionObserver"in this&&this._intersectionObserver instanceof IntersectionObserver))throw new Error("Must be observing visibility");this._lazyRenderAttrWatcher.disconnect(),this._lazyRenderAttrWatcher=null,this._intersectionObserver.disconnect(),this._intersectionObserver=null,this.hasAttribute("lazy-render")&&this.removeAttribute("lazy-render")}_finishRender(){return new Promise((async e=>{await this.shouldBuild()&&await this.build(),setTimeout((async()=>{await this.load(),this.rendered=!0,e(!0)}),0)}))}async render(e){if(!this.locked){if(this.isUsingLazyRenderMode()&&this.disableLazyRender(),this.attrObservers.length){for(let e of this.attrObservers)e.disconnect();this.attrObservers=[]}return this.rendered=!1,"onRemoved"in this&&await this.onRemoved(),await this.spawn(e),await this.build(e),setTimeout((()=>{this.load(e)}),0),this.rendered=!0,!0}}unlock(){this.locked=!1,this.removeAttribute("locked")}watchAttr(e,t){if(this.locked)return;Array.isArray(e)||(e=[e]);let a=new MutationObserver((e=>{t(e)}));return a.observe(this,{attributes:!0,attributeOldValue:!0,attributeFilter:e}),this.attrObservers.push(a),a}supportInfiniteScroll(e,t="body",a=600){const i=document.querySelector(t);let s=e.bind(this);i.addEventListener("scroll",(e=>{this.getBoundingClientRect().bottom<=i.getBoundingClientRect().bottom+a&&s()}))}supportInteractingState(e={}){if("rightClickEls"in e||(e.rightClickEls=[this]),"leftClickEls"in e||(e.leftClickEls=[...Array.from(this.querySelectorAll("dot-menu"))]),e.rightClickEls.length)for(let t of e.rightClickEls)t.addEventListener("mousedown",(e=>{3===e.which&&this.enterInteractingState()}));if(e.leftClickEls.length)for(let t of e.leftClickEls)t.addEventListener("mousedown",(e=>{1===e.which&&this.enterInteractingState()}));let t=Array.from(this.querySelectorAll('a, button, [tabindex="0"]'));if(t.length)for(let e of t)e.addEventListener("focus",(e=>{this.enterInteractingState()}))}enterInteractingState(){let e=this;e.classList.contains(this.interactingClassName)||(e._checkIfDoneInteracting=t=>{if(this.debug&&(console.log("%cchecking if done interacting with",`color:${this.consoleColor}`),console.log(e),console.log("%cmb or kb event",`color:${this.consoleColor}`),console.log(t)),t instanceof KeyboardEvent){if("Shift"===t.key||"Alt"===t.key||"Meta"===t.key||"Control"===t.key)return;if(t.target.closest("context-menu"))return;if(e.contains(t.target))return}if(t instanceof MouseEvent){if(3===t.which){if(e.contains(t.target))return;if(t.target.closest("context-menu"))return}if(1===t.which){let a=e.querySelector("dot-menu");if(a&&a.contains(t.target))return}}t.target.matches("context-menu .dropdown-item")||t.target.matches("context-menu .dropdown-item > span")||(document.querySelector("music-app").removeEventListener("mouseup",e._checkIfDoneInteracting),document.querySelector("music-app").removeEventListener("keyup",e._checkIfDoneInteracting),e.classList.remove(this.interactingClassName),e._checkIfDoneInteracting=null,this.debug&&(console.log("%cdone interacting with",`color:${this.consoleColor}`),console.log(e)))},e.classList.add(this.interactingClassName),document.querySelector("music-app").addEventListener("mouseup",e._checkIfDoneInteracting),document.querySelector("music-app").addEventListener("keyup",e._checkIfDoneInteracting))}enableDropArea(e,t){let a,i=this;e instanceof Element?(i=e,a=t):a=e,i.addEventListener("dragover",(e=>{e.preventDefault()})),i.addEventListener("dragenter",(e=>{e.preventDefault(),i.classList.add("drop-hovering")})),i.addEventListener("dragleave",(e=>{e.preventDefault(),i.classList.remove("drop-hovering")})),i.addEventListener("drop",(e=>{let t=e.dataTransfer.files;i.classList.remove("drop-hovering"),"function"==typeof a&&a(e,t)}))}static elementFactory(e){let t=document.createDocumentFragment(),a=document.createElement("div");t.appendChild(a),a.innerHTML=`<${e.name}></${e.name}>`;let i=a.firstElementChild;if("attrs"in e&&"object"==typeof e.attrs)for(let[t,a]of Object.entries(e.attrs))"string"!=typeof a&&(a=JSON.stringify(a)),i.setAttribute(t,a);if("bindings"in e&&"object"==typeof e.bindings)for(let[t,a]of Object.entries(e.bindings))i[t]=a;return i}static register(e,t){void 0===window.customElements.get(e)?window.customElements.define(e,t):console.warn(`Custom Element ${e} is already defined`)}}const I=M;class O{constructor(e,t){let a=0,i=0;if(void 0===t.position||"mouse"===t.position)a=e.clientY-15,i=e.clientX;else if("elementTopCenter"===t.position){let t=n(e.target).position();a=t.y-15,i=t.x+e.target.offsetWidth/2}n("music-app").appendHtml(`\n      <div id="${t.id}" class="the-tooltip">\n        <div class="inner">\n          ${t.message}\n        </div>\n      </div>\n    `),n("#"+t.id).css({top:a,left:i}).addClass("show")}}function $(e){new O(e,{id:"hover-tooltip",position:"elementTopCenter",message:n(e.target).attr("data-tooltip")});const t=e=>{e.target.matches(".tooltip")||(n(".the-tooltip#hover-tooltip").remove(),document.removeEventListener("mouseover",t))};document.addEventListener("mouseover",t)}async function B(e,t="",a={}){"id"in a||(a.id=n().randomStr(12,"abcdefghijklmnopqrstuvwxyz")),"mode"in a||(a.mode="locked"),"position"in a||(a.position="bottom-right"),t instanceof Element&&(t=t.innerHTML),"floating"===a.mode?await async function(e,t,a={}){n(e).addClass("floating-modal-open");let i=n(e).prependHtml(await h(`\n    <div id="${a.id}" class="modal animated bounceIn" data-mode="floating" data-position="${a.position}">\n      <div class="grab"></div>\n      <div class="modal-content">\n        <button class="close-modal icon-button clicks" title="{i18n{close}}">\n          <span tabindex="-1">\n            <i class="fas fa-times-circle"></i>\n          </span>\n        </button>\n\n        ${t}\n      </div>\n    </div>\n  `));H(i.attr("id")),function(e,t=el){if(!(e instanceof Element))throw new Error("enterFloatingState() requires an Element");let a=n(e);t.addEventListener("mousedown",(t=>{function i(e){let i=e.x-t.x,s=e.y-t.y;a.attr("style",`transform: translate(${i}px, ${s}px);`)}function s(t){!function(){document.removeEventListener("mouseup",s),document.removeEventListener("mousemove",i);let t=function(e){let t=e.getBoundingClientRect(),a={x:t.right-t.width/2,y:t.bottom-t.height/2},i=["top-left","top-right","bottom-left","bottom-right"],s=null,n=null;for(let e of i){let t=D(e),i=(Math.abs(a.x-t.x)+Math.abs(a.y-t.y))/2;(i<n||null===n)&&(n=i,s=e)}return s}(e);if(null===t)throw new Error("Moveable Element could not determine which corner is closest");if(t!==a.attr("data-position")){let i=function(e,t){let a=e.getBoundingClientRect(),i=e.cloneNode(!0);n(i).removeAttr("id"),n(i).attr("style","opacity: 0;"),n(i).attr("data-position",t),e.insertAdjacentElement("afterend",i);let s=i.getBoundingClientRect();n(i).remove();let r=0,o=0;return r=a.x>s.x?a.x-s.x:Math.abs(a.x)-s.x,o=a.y>s.y?a.y-s.y:Math.abs(a.y)-s.y,{x:r,y:o}}(e,t),s=`transform: translate(${i.x}px, ${i.y}px)`;a.attr("style",s),a.attr("data-position",t)}setTimeout((()=>{a.removeClass("moving"),a.removeAttr("style")}),20)}()}a.removeClass("bounceIn","fadeIn","animated"),document.addEventListener("mouseup",s),document.addEventListener("mousemove",i),a.addClass("moving")}))}(i.el(),i.find(".grab").el()),z(i.attr("id"),a)}(e,t,a):await async function(e,t,a={}){n(e).addClass("locked-modal-open");let i=n(e).appendHtml(await h(`\n    <div id="${a.id}" class="modal" data-mode="locked">\n      <div class="modal-content animated bounceIn">\n        <button class="close-modal icon-button clicks" title="{i18n{close}}">\n          <span tabindex="-1">\n            <i class="fas fa-times-circle"></i>\n          </span>\n        </button>\n\n        ${t}\n      </div>\n    </div>\n  `));H(i.attr("id")),z(i.attr("id"),a),n().keepFocusWithin(`#${a.id}.modal`)}(e,t,a)}function H(e){let t=n(`#${e}`);const a=function(e){e instanceof KeyboardEvent&&"Space"!==e.code||j(n(this).closest(".modal").attr("id"))};t.find("button.close-modal").on("click",a),t.find("button.close-modal").on("keydown",a)}function z(e,t){let a=n(`#${e}`);a.el().modalCallbacks={},"onClose"in t&&(a.el().modalCallbacks.onClose=t.onClose)}function D(e){let t=getComputedStyle(document.body);return{"top-left":{x:parseInt(t.getPropertyValue("--floating-left-space")),y:parseInt(t.getPropertyValue("--floating-top-space"))},"top-right":{x:window.innerWidth-parseInt(t.getPropertyValue("--floating-right-space")),y:parseInt(t.getPropertyValue("--floating-top-space"))},"bottom-left":{x:parseInt(t.getPropertyValue("--floating-left-space")),y:window.innerHeight-parseInt(t.getPropertyValue("--floating-bottom-space"))},"bottom-right":{x:window.innerWidth-parseInt(t.getPropertyValue("--floating-right-space")),y:window.innerHeight-parseInt(t.getPropertyValue("--floating-bottom-space"))}}[e]}function j(e){let t=n(`#${e}`);"function"==typeof t.el().modalCallbacks.onClose&&t.el().modalCallbacks.onClose(e),1===t.closest(".floating-modal-open").find('.modal[data-mode="floating"]').els.length&&t.closest(".floating-modal-open").removeClass("floating-modal-open"),1===t.closest(".locked-modal-open").find('.modal[data-mode="locked"]').els.length&&t.closest(".locked-modal-open").removeClass("locked-modal-open"),n().releaseFocus(),n(`#${e}.modal`).remove()}function q(){n(".modal").each((e=>{j(n(e).attr("id"))}))}async function R(e,t){switch(console.log(`%c${e.action}`,"color:#f39a11;"),e.action){case"maximized":n(this).addClass("maximized"),n(this).removeClass("minimized");break;case"openSettings":n("music-settings").el().openSettingsPanel();break;case"swipe":"left"===e.direction?Router.back():"right"===e.direction&&Router.forward();break;case"back":Router.back();break;case"forward":Router.forward();break;case"play":Player.play();break;case"pause":Player.pause();break;case"playpause":Player.playPause();break;case"stop":Player.stop();break;case"next":Player.next();break;case"previous":Player.previous();break;case"togglequeue":n("music-app").toggleClass("queue-open");break;case"alert":alert(e.message);break;case"show-welcome":this.showWelcome();break;case"show-open-source":this.showOpenSource();break;case"show-about":this.showAbout();break;case"zoom-in":if("electron"===n("#app").attr("env")){const{webFrame:e}=a(933);e.setZoomLevel(e.getZoomLevel()+.5)}break;case"zoom-out":if("electron"===n("#app").attr("env")){const{webFrame:e}=a(933);e.setZoomLevel(e.getZoomLevel()-.5)}break;case"reset-zoom":if("electron"===n("#app").attr("env")){const{webFrame:e}=a(933);e.setZoomLevel(0)}}}const F=function(e){"Space"===e.code&&n(e.target).find("i").trigger("mouseup")},N=function(e){"Space"===e.code&&setTimeout((()=>{W(this)}),0)},G=function(e){setTimeout((()=>{W(this)}),0)};function W(e){let t=n(e).attr("data-transfer-focus-to-child")?e:"music-app",a=n(e).attr("data-transfer-focus-to"),i=n(t).find(a);i.els.length&&setTimeout((()=>{i.el().focus()}),0)}class V extends I{constructor(){super(),console.groupCollapsed("%cC%co%cl%co%cu%cr %cI%cn%cd%ce%cx","font-weight:600; font-size:14px; color:red;","font-weight:600; font-size:14px; color:white;","font-weight:600; font-size:14px; color:red;","font-weight:600; font-size:14px; color:white;","font-weight:600; font-size:14px; color:red;","font-weight:600; font-size:14px; color:white;","font-weight:600; font-size:14px; color:red;","font-weight:600; font-size:14px; color:white;","font-weight:600; font-size:14px; color:red;","font-weight:600; font-size:14px; color:white;","font-weight:600; font-size:14px; color:red;"),console.log("%cOrange: Main process announcements","color:#f39a11;"),console.log("%cGreen: Bridge object instance","color:#5fb64a;"),console.log("%cBlue: UI Router object instance","color:#47aac9;"),console.log("%cPink: Audio playback","color:#d61fd0;"),console.log("Default: Other"),console.groupEnd(),this.maybeEnableDeveloperMode(),this.boundAnnouncementListener=R.bind(this),this.boundOnDocumentKeyDown=this.onDocumentKeyDown.bind(this),this.boundOnDocumentKeyUp=this.onDocumentKeyUp.bind(this),this.boundOnWindowResize=this.onWindowResize.bind(this),window.disableCustomCSS=()=>{document.querySelector("#user-custom-css").remove(),document.querySelector('textarea[name="custom_css"]').value="",window.localStorage.removeItem("custom_css")},this.enableModals(),function(e){n("button.icon-button").on("keydown",e,F),n("a[data-transfer-focus-to]").on("keydown",e,N),n("button[data-transfer-focus-to]").on("click",e,G)}(this),n(this).attr("os",process.platform),"electron"===this.getAttribute("env")&&setTimeout((async()=>{JSON.parse(window.localStorage.getItem("auto_check_for_updates"))&&this.checkForUpdates()}),4e3)}async maybeEnableDeveloperMode(){JSON.parse(window.localStorage.getItem("developer_mode"))?this.enableDeveloperMode():this.enableDeveloperMode(!1)}async enableDeveloperMode(e){!1===e?n(this).removeClass("developer-mode"):n(this).addClass("developer-mode")}async getDefaultServer(){let e=await Bridge.ipcAsk("get-option","default_server");return e?await Bridge.ipcAsk("db-api",{fn:"getRow",args:["servers",e]}):null}async connectToServer(e,t){if(!e)throw new Error("Host is required");if(!t)throw new Error("Port is required");try{await Bridge.init("http",{host:e,port:t,scheme:"http://"})}catch(e){return console.log("HTTP connection to Cardinal Server cannot be established. Not attempting WebSocket connection."),!1}try{await Bridge.init("ws",{host:e,port:parseInt(t)+1,scheme:"ws://"})}catch(e){console.log("WebSocket connection to server failed")}return!(!Bridge.httpConnectionEstablished||!Bridge.wsConnectionEstablished)}async showConnectionLockScreen(e){let t=e?`message="${e}"`:"";n(this).prependHtml(await h(`\n      <div id="win32-window-controls" class="win32-only">\n        {inc{/elements/music-app/templates/win32-window-control-buttons.html}}\n      </div>\n      <server-connect overlay ${t}></server-connect>`))}isConnectionLockScreenShowing(){return!!document.querySelector("server-connect[overlay]")}async autoConnectOrLock(){if(!("Bridge"in window))throw new Error("AutoConnect: Cannot auto connect, window.Bridge global is missing.");if(Bridge.httpConnectionEstablished&&Bridge.wsConnectionEstablished)return console.log("AutoConnect: Bridge is already connected."),!0;const e=await this.getDefaultServer();if(!e)return console.log("AutoConnect: No default server set, showing connection screen."),this.showConnectionLockScreen(),!1;const t=`${e.server_host}:${e.server_port_http}`;return await this.connectToServer(e.server_host,e.server_port_http)?(console.log(`AutoConnect: Automatically connected to server at ${t}.`),await this.maybeSetI18nViaHttp(),!0):(console.log(`AutoConnect: Could not connect to server at ${t}`),this.showConnectionLockScreen("autoconnect-failed"),!1)}async maybeSetI18nViaHttp(){if(!window.i18n){let e=await Bridge.httpApi("/i18n");200===e.status?window.i18n=e.response:console.error("i18n strings HTTP route did not return with status 200")}}async injectCustomCss(){let e=window.localStorage.getItem("custom_css"),t=document.querySelector("#user-custom-css");if(t&&t.remove(),e){let t=document.createElement("style");t.id="user-custom-css",t.textContent=e,document.head.append(t)}}async setColors(){let e=window.localStorage.getItem("color_theme")||"dark",t=window.localStorage.getItem("accent_color");e&&n(this).attr("color-theme",e),t&&document.documentElement.style.setProperty("--accent-color",t)}registerCommonEventHandlers(){Bridge.ipcListen("announcements",this.boundAnnouncementListener),document.addEventListener("keydown",this.boundOnDocumentKeyDown),document.addEventListener("keyup",this.boundOnDocumentKeyUp),window.addEventListener("resize",this.boundOnWindowResize),n("#win32-window-controls .minimize").on("click",(e=>{Bridge.ipcSay("minimize-player")})),n("#win32-window-controls .maximize").on("click",(e=>{Bridge.ipcSay("maximize-player")})),n("#win32-window-controls .restore").on("click",(e=>{Bridge.ipcSay("restore-player")})),n("#win32-window-controls .close").on("click",(e=>{Bridge.ipcSay("close-player")})),n("button#back-button").on("click",(e=>{1===e.which&&Router.back()})),n("a.external").on("click",this,(function(e){e.preventDefault();let t=n(this).attr("href");Bridge.ipcSay("open-url",t)})),"ContextMenu"in window&&ContextMenu.listenForRightClicks(this)}removeCommonEventHandlers(){Bridge.removeListener("announcements",this.boundAnnouncementListener),document.removeEventListener("keydown",this.boundOnDocumentKeyDown),document.removeEventListener("keyup",this.boundOnDocumentKeyUp),window.removeEventListener("resize",this.boundOnWindowResize)}onDocumentKeyDown(e){switch(e.which){case 16:this.classList.add("shift-down");break;case 17:this.classList.add("ctrl-down");break;case 18:this.classList.add("option-down");break;case 91:this.classList.add("cmd-down");break;case 32:for(let t of["input","textarea","button","a"])if(e.target.matches(t))return;e.preventDefault(),Player.playPause();break;case 37:Player.previous();break;case 39:Player.next()}}onDocumentKeyUp(e){switch(e.which){case 16:this.classList.remove("shift-down");break;case 17:this.classList.remove("ctrl-down");break;case 18:this.classList.remove("option-down");break;case 91:this.classList.remove("cmd-down");break;case 27:"ContextMenu"in window&&ContextMenu.closeAllContextMenus(),this.modal.closeAll(),n("context-menu").each((e=>e.closeAll()))}}onWindowResize(){0===window.screenX&&0===window.screenY||n(this).removeClass("maximized")}enableModals(){n("[data-modal]").on("click",this,(async e=>{let t=n(e.target),a=t.attr("data-modal"),i=document.querySelector(a);"modal"in this?this.modal.show(t.closest("#app").el(),i):console.warn("No `modal` handler set.")}))}async checkForUpdates(){if("electron"!==this.getAttribute("env"))return console.warn("Updates only available in Electron.");Bridge.ipcSay("check-for-updates-silently")}}const Q="validation-error";function X(e){!function(e){n(e).find("select").each((e=>{if(n(e).closest(".form-select").els.length)return;let t=n(e).hasAttr("multiple")?"form-multi-select":"form-select",a=n(e).attr("data-label")?`<span class="label-text">${n(e).attr("data-label")}</span>`:"",i=n(e).before(`\n      <div class="field ${t}">\n        ${a}\n        <div class="select-outer"></div>\n      </div>`);n(e).moveTo(i.find(".select-outer").el())}))}(e),function(e){n(e).find('input[type="checkbox"]').each((e=>{if(n(e).closest(".toggle-switch").els.length)return;let t=n(e).attr("data-label"),a=n(e).attr("data-align")?n(e).attr("data-align"):"left",i=!!n(e).attr("data-explanation")&&n(e).attr("data-explanation"),s="";i&&(s=`<i class="explanation tooltip far fa-question-circle" data-tooltip="${i}"></i>`);let r=`\n      <div class="field toggle-switch-field align-${a}">\n        <label>\n          <div class="toggle-switch">\n            <div class="switch"></div>\n            <div class="focus"></div>\n          </div>\n        </label>\n        <span class="label-text">${s}${t}</span>\n      </div>`,o=n(e).before(r).find(".switch").el();n(e).moveTo(o,"beforebegin")}))}(e),function(e){n(e).find('input[type="radio"]').each((e=>{if(n(e).closest(".radio-field").els.length)return;let t=n(e).attr("data-label")||"",a=`\n      <div class="field radio-field">\n        <label class="clicks" ${n(e).hasClass("color-swatch")?`style="background-color:${n(e).attr("value")};"`:""}></label>\n        <span class="label-text">${t}</span>\n      </div>`,i=n(e).before(a).find("label").el();n(e).moveTo(i,"afterbegin")}))}(e),function(e){n(e).find('input[type="file"]').each((e=>{if(!n(e).closest(".photo-input").els.length&&"image/*"===n(e).attr("accept")){n(e).wrapInto('<div class="photo-input field"></div>'),n(e).wrapInto("<label></label>");let t=n(e).closest(".photo-input"),a=n(e).attr("data-label"),i=y("choose-file");const s=()=>{let a=n(e).attr("data-original-value");a?t.find(".thumb").attr("style",`background-image: url('${n().__doubleSlashesOnWindowsOnly(a)}')`):(t.find(".thumb").removeAttr("style"),t.find('input[type="file"]').removeAttr("data-value"))};if(t.prependHtml(`<span class="label-text">${a}</span>`),t.find("label").appendHtml(`\n        <div class="thumb">\n          <span class="btn">${i}</span>\n        </div>\n      `),t.find(".thumb").appendHtml('\n        <button type="button" class="remove-photo icon-button">\n          <span tabindex="-1">\n            <i class="fas fa-times-circle"></i>\n          </span>\n        </button>\n      '),n(e).attr("data-value")){let a=n(e).attr("data-value");t.find(".thumb").attr("style",`background-image: url('${n().__doubleSlashesOnWindowsOnly(a)}')`),n(e).attr("data-original-value",a)}e.addEventListener("change",(a=>{let i=n(e).value();if(i instanceof FileList){let a=i[0];t.find(".thumb").attr("style",`background-image: url('${n().__doubleSlashesOnWindowsOnly(a.path)}')`),n(e).attr("data-value",a.path)}else s()})),t.find(".remove-photo").el().addEventListener("click",(e=>{t.find(".thumb").removeAttr("style"),t.find('input[type="file"]').el().value=null,t.find('input[type="file"]').attr("data-value","")}))}}))}(e),function(e){n(e).find('input[type="number"][maxlength]').each((e=>{e.addEventListener("change",(t=>{let a=parseInt(n(e).value()),i=parseInt(n(e).attr("maxlength"));a.length>i&&(a=parseInt(a.substring(0,i))),e.value=a}))})),n(e).find('input[type="number"][min], input[type="number"][max]').each((e=>{e.addEventListener("change",(t=>{let a=parseInt(n(e).value()),i=n(e).attr("min")?parseInt(n(e).attr("min")):0,s=n(e).attr("max")?parseInt(n(e).attr("max")):Number.MAX_SAFE_INTEGER;i&&a<i&&(a=i),s&&a>s&&(a=s),e.value=a}))}))}(e),function(e){n(e).find('input[type="text"], input[type="number"], textarea').each((e=>{if(n(e).closest(".text-input").els.length)return;let t=n(e).wrapInto('<label class="text-input"></label>').el(),a=n(t).attr("data-label");a?n(t).closest(".text-input").prependHtml(`<span class="label-text">${a}</span>`):n(t).addClass("no-label")}))}(e),function(e){n(e).find(".hidden-fields").each((e=>{let t="input, select, textarea, button, a";n(e).find(t).attr("tabindex","-1"),new MutationObserver((a=>{n(e).hasClass("show")?n(e).find(t).removeAttr("tabindex"):n(e).find(t).attr("tabindex","-1")})).observe(e,{attributes:!0,attributeFilter:["class"]})}))}(e),function(e){e.addEventListener("reset",(t=>{n(e).find(".photo-input").each((e=>{let t=e.querySelector('input[type="file"]');if(n(t).attr("data-original-value")){let a=n(t).attr("data-original-value");n(t).attr("data-value",a),n(e).find(".thumb").attr("style",`background-image: url('${n().__doubleSlashesOnWindowsOnly(a)}')`)}t.files=null,setTimeout((()=>{let e=new Event("change",{bubbles:!0});t.dispatchEvent(e)}),0)}))}))}(e),function(e){n(e).watchAttrs(["class"],(t=>{let a=n(e);a.hasClass("success")&&(a.find('button[type="submit"]').prependHtml('\n        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n          <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" />\n          <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />\n        </svg>'),setTimeout((()=>{a&&(a.find(".checkmark").remove(),a.removeClass("success"))}),2e3))}))}(e)}class Y{constructor(e){let t={selector:null,defaultTab:null,animationOut:null,animationIn:null};for(let a in t)this[a]=e[a]||t[a];this.init(),this.registerEventHandlers()}registerEventHandlers(){let e=this;n(this.selector).find(".flex-tab").each((t=>{t.addEventListener("click",(a=>{let i=n(t).attr("data-tab-index");e.showTab(i)})),t.addEventListener("keyup",(()=>{"Space"===event.code&&n(t).trigger("click")}))}))}init(){let e=n(this.selector),t=[];e.find(".tab").each(((e,a)=>{let i=n(e);i.attr("data-tab-index",a+1),t.push({icon:i.attr("data-tab-icon"),name:i.attr("data-tab-name")})})),this.injectTabsHeader(t),this.hideAll();let a=1;"string"==typeof this.defaultTab?a=this.tabNameToIndex(this.defaultTab):"number"==typeof this.defaultTab&&(a=this.defaultTab),this.showTab(a),n(this.selector).addClass("ready")}injectTabsHeader(e){let t=n(this.selector),a=t.attr("data-tab-row-title"),i=a?`<h2>${a}</h2>`:"";t.prependHtml(`<header class="tabs-row">${i}</header>`);let s=t.find("header.tabs-row"),r=1;for(let t of e)s.appendHtml(`\n        <div class="flex-tab" data-tab-index="${r}">\n          <a href="javascript:;">\n            <span tabindex="-1">\n              <i class="fas fa-${t.icon}"></i>\n              <h6>${t.name}</h6>\n            </span>\n          </a>\n        </div>\n      `),r++;t.prependHtml('\n      <button type="button" class="close">\n        <i tabindex="-1" class="fas fa-times-circle"></i>\n      </button>\n    ')}tabNameToIndex(e){return n(this.selector).find(`.tab[data-tab-slug="${e}"]`).attr("data-tab-index")}hideAll(){let e=n(this.selector);e.find(".flex-tab.active").removeClass("active"),e.find(".tab.active").removeClass("active")}showTab(e=1){"string"==typeof e&&(e=this.tabNameToIndex(e));let t=n(this.selector),a=t.find(`header.tabs-row .flex-tab[data-tab-index="${e}"]`),i=t.find(`.tab[data-tab-index="${e}"]`);this.hideAll(),a.addClass("active"),i.addClass("active"),t.attr("data-current-tab",e)}}function U(e,t,a){if("lang"!==e)return;console.log("Rerendering #app to change language"),Router.setLang(t);const i=document.querySelector("#app");i.classList.remove("settings-open"),i.render()}function K(e,t,a){"color_theme"===e&&document.querySelector("#app").setAttribute("color-theme",t)}function J(e,t,a){if("accent_color"!==e)return;window.localStorage.setItem("accent_color",t);let i=a.target.closest(".settings-panel").querySelector(".swatches .active");i&&i.classList.remove("active"),a.target.closest("label").classList.add("active"),document.documentElement.style.setProperty("--accent-color",t)}function Z(e,t,a){"custom_css"===e&&(window.localStorage.setItem("custom_css",t),document.querySelector("#app").injectCustomCss())}function ee(e,t,a){"developer_mode"===e&&(window.localStorage.setItem("developer_mode",t),document.querySelector("#app").maybeEnableDeveloperMode())}class te extends I{constructor(){super(),this.formId="#app-settings-form",this.boundOnDataSettingsAttrClick=this.onDataSettingsAttrClick.bind(this),this.onFieldChange=null,this._callbacks={onSettingChange:[],onClose:[]}}formSetup(){X(this.querySelector(this.formId)),this.setSyncGroups(),this.registerFieldEventListeners(),n(this.formId).on("submit",(e=>{e.preventDefault()})),this.watchSyncGroups();let e=window.localStorage.getItem("accent_color");e&&this.querySelector(`input[name="accent_color"][value="${e}"]`).closest("label").classList.add("active")}registerFieldEventListeners(){this.registerCallback("onSettingChange",U),this.registerCallback("onSettingChange",K),this.registerCallback("onSettingChange",J),this.registerCallback("onSettingChange",Z),this.registerCallback("onSettingChange",ee);let e=n(this).find(`${this.formId} button[name="factory-reset"]`);e.els.length&&e.each((e=>{e.addEventListener("click",(e=>{e.preventDefault(),confirm(y("settings.factory-reset.confirm"))&&confirm(y("danger-confirm"))&&Bridge.ipcSay("factory-reset")}))}))}onDataSettingsAttrClick(e){let t=n(e.target).attr("data-settings");e.target.matches("[data-settings]")||(t=n(e.target.closest("[data-settings]")).attr("data-settings")),this.openSettingsPanel(t)}setSyncGroups(){n(`${this.formId} [data-sync-with-db]`).each((async e=>{let t=n(e).attr("name"),a=window.localStorage.getItem(t);if(null!==a){try{a=JSON.parse(a)}catch(e){}e.matches('[type="checkbox"]')||e.matches('[type="radio"]')?a?e.checked=!0:a||(e.checked=!1):n(e).value(a)}}))}watchSyncGroups(){n(`${this.formId} [data-sync-with-db]`).on("change",(e=>{let t,a=e.target,i=n(a).attr("name");if(t="checkbox"===n(a).attr("type")?a.checked?1:0:"radio"===n(a).attr("type")?n(a).closest(".settings-panel").find(`input[type="radio"][name="${i}"]:checked`).value():n(a).value(),window.localStorage.setItem(i,t),this._callbacks.onSettingChange.length)for(let a of this._callbacks.onSettingChange)a(i,t,e)}))}openSettingsPanel(e){if(!n(".settings-panel").hasClass("open")){if(n("#app").addClass("settings-open"),n(".settings-panel").addClass("open"),!e){let t=n(this.tabs.selector).attr("data-current-tab");t&&(e=t)}this.tabs.showTab(e),n().keepFocusWithin(".settings-panel")}}registerCallback(e,t){this._callbacks[e].push(t)}getFieldTemplates(){let e=["advanced/developer","advanced/factory-reset","general/lang","general/notifications","general/start-page","general/updates","modals/folder-structure","playback/flags","theme/color-theme","theme/custom-css","theme/swatches"],t={};for(let a of e)t[`settings-field/${a}`]=this.getFieldTemplate(a);return t}getFieldTemplate(e){switch(e){case"advanced/developer":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.developer.title}}</h4>\n        \n          <input type="checkbox" data-sync-with-db name="developer_mode" data-label="{i18n{settings.developer.enable-label}}">\n        </div>';case"advanced/factory-reset":return'\n        <div class="form-group factory-reset-group">\n          <h4 class="group-title">{i18n{settings.factory-reset.title}}</h4>\n\n          <button class="danger" type="button" name="factory-reset">\n            <span tabindex="-1">{i18n{settings.factory-reset.desc}}</span>\n          </button>\n        </div>';case"general/lang":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.language.title}}</h4>\n\n          <select name="lang" data-sync-with-db>\n            <option value="en" selected="selected">English</option>\n            <option value="fr">Français</option>\n          </select>\n        </div>';case"general/notifications":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.notifications.title}}</h4>\n\n          <input type="checkbox" data-sync-with-db name="notification_on_song_change" data-label="{i18n{settings.notifications.song-change-label}}">\n        </div>';case"general/start-page":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.start-page.title}}</h4>\n\n          <select name="start_page" data-sync-with-db>\n            <optgroup label="{i18n{nav.music.title}}">\n              <option value="/explore-music">{i18n{nav.music.explore}}</option>\n              <option value="/artists">{i18n{nav.music.artists}}</option>\n              <option value="/music-releases">{i18n{nav.music.releases}}</option>\n              <option value="/tracks">{i18n{nav.music.tracks}}</option>\n              <option value="/playlists">{i18n{nav.music.playlists}}</option>\n              <option value="/music-genres">{i18n{nav.music.genres}}</option>\n            </optgroup>\n          </select>\n        </div>';case"general/updates":return'\n        <div class="form-group"b>\n          <h4 class="group-title">{i18n{settings.updates.title}}</h4>\n\n          <input type="checkbox" data-sync-with-db name="auto_check_for_updates" data-label="{i18n{settings.updates.auto-check-label}}">\n        </div>';case"modals/folder-structure":return'\n        <div class="folder-structure-guide">\n          <div class="modal-header">\n            <h2>{i18n{folder-structure-guide.title}}</h2>\n          </div>\n\n          <div class="text-content">\n            {i18n{folder-structure-guide.desc-before-examples}}\n          </div>\n\n          <div class="folder-structure-examples">\n            \x3c!-- Music Examples --\x3e\n            <h3>{i18n{folder-structure-guide.example.music.title}}</h3>\n\n            <div class="code-blocks half-half">\n              <code>\n                /{i18n{folder-structure-guide.example.music.code.artist}}<br>\n                &nbsp;&nbsp;/{i18n{folder-structure-guide.example.music.code.album}}<br>\n                &nbsp;&nbsp;&nbsp;&nbsp;• {i18n{folder-structure-guide.example.music.code.song}}<br>\n                &nbsp;&nbsp;&nbsp;&nbsp;• {i18n{folder-structure-guide.example.music.code.cover-art}}<br>\n              </code>\n              <div class="or">{i18n{or}}</div>\n              <code>\n                /{i18n{folder-structure-guide.example.music.code.artist}}<br>\n                &nbsp;&nbsp;/{i18n{folder-structure-guide.example.music.code.album}}<br>\n                &nbsp;&nbsp;&nbsp;&nbsp;/{i18n{folder-structure-guide.example.music.code.disc}}<br>\n                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;• {i18n{folder-structure-guide.example.music.code.song}}<br>\n                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;• {i18n{folder-structure-guide.example.music.code.cover-art}}<br>\n              </code>\n            </div>\n          </div>\n\n          <div class="supported-types">\n            <h3>{i18n{folder-structure-guide.supported-types.title}}</h3>\n\n            <table class="informational">\n              <tr>\n                <td>{i18n{folder-structure-guide.example.music.title}}</td>\n                <td>\n                  <code class="inline">.mp3</code>\n                  <code class="inline">.flac</code>\n                </td>\n              </tr>\n              <tr>\n                <td>{i18n{folder-structure-guide.example.tv-movies.title}}</td>\n                <td>\n                  <code class="inline">.mp4</code>\n                </td>\n              </tr>\n              <tr>\n                <td>{i18n{folder-structure-guide.supported-types.artwork}}</td>\n                <td>\n                  <code class="inline">.jpg</code>\n                  <code class="inline">.png</code>\n                  <code class="inline">.gif</code>\n                </td>\n              </tr>\n            </table>\n          </div>\n        </div>';case"playback/flags":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.music-playback.title}}</h4>\n\n          <input type="checkbox" data-sync-with-db name="always_load_whole_song" data-label="{i18n{settings.music-playback.always-load-whole-song}}">\n        </div>';case"theme/color-theme":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.color-theme.title}}</h4>\n\n          <select name="color_theme" data-sync-with-db>\n            <option value="dark" selected="selected">{i18n{settings.color-theme.option.dark}}</option>\n            <option value="light">{i18n{settings.color-theme.option.light}}</option>\n          </select>\n        </div>';case"theme/custom-css":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.custom-css.title}}</h4>\n\n          <div class="instructions">\n            <div class="slidetoggle slim">\n              <button class="label">\n                <span tabindex="-1">\n                  <i class="warning-icon fas fa-exclamation-triangle"></i>\n                  {i18n{settings.custom-css.notice}}\n                </span>\n              </button>\n\n              <span class="content">{i18n{settings.custom-css.instructions}}</span>\n            </div>\n          </div>\n\n          <textarea class="custom-css" data-sync-with-db name="custom_css"></textarea>\n        </div>';case"theme/swatches":return'\n        <div class="form-group">\n          <h4 class="group-title">{i18n{settings.accent-color.title}}</h4>\n\n          <div class="swatches">\n            <input type="radio" name="accent_color" data-sync-with-db title="The Last Popsicle Purple" type="button" class="color-swatch clicks" value="#a174dd">\n            <input type="radio" name="accent_color" data-sync-with-db title="Flamingo Jam Pink" type="button" class="color-swatch clicks" value="#e9219c">\n            <input type="radio" name="accent_color" data-sync-with-db title="Rapper Name lil\'Blue" type="button" class="color-swatch clicks" value="#4da3bd">\n            <input type="radio" name="accent_color" data-sync-with-db title="The Bold and the Bluetiful" type="button" class="color-swatch clicks" value="#3793cf">\n            <input type="radio" name="accent_color" data-sync-with-db title="Cantaloupe Green" type="button" class="color-swatch clicks" value="#57b983">\n            <input type="radio" name="accent_color" data-sync-with-db title="Zergling Rush! Green" type="button" class="color-swatch clicks" value="#379c3f">\n            <input type="radio" name="accent_color" data-sync-with-db title="Nuclear Warning Yellow" type="button" class="color-swatch clicks" value="#ccb118">\n            <input type="radio" name="accent_color" data-sync-with-db title="At Least It\'s Not Brown, Orange" type="button" class="color-swatch clicks" value="#d45912">\n            <input type="radio" name="accent_color" data-sync-with-db title="Alien Invasion Red" type="button" class="color-swatch clicks" value="#cc4c43">\n            <input type="radio" name="accent_color" data-sync-with-db title="Soulless Grey" type="button" class="color-swatch clicks" value="#575757">\n          </div>\n        </div>'}}}async function ae(e={}){let t=n(e.el);if("number"==typeof e.idsToAdd&&(e.idsToAdd=[e.idsToAdd]),t.find(".submenu").els.length)return;t.appendHtml(`\n    <ol class="submenu">\n      ${await n().getFileContents("/images/loading.svg")}\n    </ol>\n  `);let a=t.find(".submenu"),i=t.closest("context-menu"),s=await new v({table:"music_playlists",itemsPerPage:-1});if(t.find(".loading").remove(),!s.results.length){let e=i.find("template.menu-item").getTemplate();return n(e).find("a").attr("href","/playlists").addClass("router-link"),n(e).find('span[tabindex="-1"]').html(y("playlist-list.empty-message")),void a.appendHtml(e)}for(let i of s.results){let s=a.appendHtml(`\n      <button type="button" class="add context-menu-item" data-playlist-id="${i.id}">\n        <span tabindex="-1">${i.playlist_name}</span>\n      </button>\n    `);const n=async t=>{if(t.preventDefault(),t.stopPropagation(),t instanceof KeyboardEvent&&"Space"!==t.code&&"Enter"!==t.code)return;let a=i.playlist_track_ids;Array.isArray(a)||(a=[]);for(let t of e.idsToAdd)a.push(t);if(!await Bridge.httpApi("/db-api","POST",{fn:"update",args:["music_playlists",i.id,{playlist_track_ids:a}]}))throw new Error("Error updating database with new playlist tracks");ContextMenu.closeAllContextMenus()};t.addClass("open"),s.on("click",n),s.on("keydown",n)}}class ie extends I{onSpawn(){this.dotMenuReference=null,new MutationObserver((e=>{this.querySelector(".submenu")&&this.checkDropdownFit(this.querySelector(".submenu"))})).observe(this,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}registerEventListeners(){n(this).find("a.context-menu-item").each((e=>{const t=t=>{if(t instanceof KeyboardEvent&&"Space"!==t.code)return;let a=n(e),i=a.closest("context-menu"),s=a.closest(".group-items").attr("data-group"),r=a.attr("data-label"),o=window.hasOwnProperty("lastElementRightClicked")?window.lastElementRightClicked:null;if(a.hasClass("dropdown-item")&&a.hasClass("open"))return a.find(".submenu").remove(),void a.removeClass("open");i.el().items[s][r].cb(o,a.el())};e.addEventListener("click",t),e.addEventListener("keydown",t)})),n(this).find(".context-menu-item").each((e=>{e.addEventListener("keydown",(e=>{if("Tab"===e.code){let t=n(e.target.closest("context-menu")).find(".context-menu-item");e.target===t.els.pop()&&ie.closeAllContextMenus()}}))}))}static async buildAncestralMenuItemsObject(e){let t={},a=[e,...n(e).parents().els];for(let e of a)if("getContextMenuItems"in e){let a=await e.getContextMenuItems();for(let e of a)t[e.group]={...e.items,...t[e.group]}}return t}buildHtml(e){return new Promise((async(t,a)=>{this.items=e,this.innerHTML=await h("/elements/context-menu/context-menu.html");for(let t in e){let a=n(this).getTemplate(".group");n(a).find(".group-name").html(t),n(a).find(".group-items").attr("data-group",t);for(let[i,s]of Object.entries(e[t])){let e=this._buildContextMenuItemHtml(i,s);n(a).find(".group-items").appendHtml(e)}n(this).find("ol").appendHtml(a)}this.checkFit(),t()}))}_buildContextMenuItemHtml(e,t){let a=n(this).getTemplate(".menu-item"),i=e;if("icon"in t&&(i=`<i class="fas fa-${t.icon}"></i>${e}`),n(a).find(".context-menu-item").attr("data-label",e),n(a).find('.context-menu-item span[tabindex="-1"]').html(i),"attrs"in t)for(let e in t.attrs)n(a).find(".context-menu-item").attr(e,t.attrs[e]);return"class"in t&&n(a).find(".context-menu-item").addClass(t.class),a}static async renderSpecialItem(e,a){return await t[e](a)}checkFit(){let e=document.body.getBoundingClientRect(),t=this.getBoundingClientRect();switch(n(this).attr("origin")){case"top-left":break;case"top-right":n(this).css({top:t.top,left:t.left-t.width}),e=document.body.getBoundingClientRect(),t=this.getBoundingClientRect()}let a=0,i=0;if(t.bottom>e.bottom&&(a=t.bottom-e.bottom),t.right>e.right&&(i=t.right-e.right),a||i){let e=n(this).css("top"),t=n(this).css("left");a&&(e-=a),i&&(t-=i),n(this).css({top:e,left:t})}}checkDropdownFit(e){let t=document.body.getBoundingClientRect(),a=e.getBoundingClientRect(),i=0,s=0;if(a.bottom>t.bottom&&(s=a.bottom-t.bottom),a.right>t.right&&(i=a.right-t.right),i&&n(e).addClass("shift-left"),s){let i;i=a.top-s>=0?"-"+s+"px":a.top-t.top,n(e).css({top:i})}}static maybeCloseAllContextMenus(e,t=""){e.target.matches(`context-menu${t}`)||n(e.target).parents(`context-menu${t}`).els.length||ie.closeAllContextMenus(t)}static listenForRightClicks(e){e.addEventListener("mouseup",(t=>{if(3!==t.which)return;if(n(t.target).parents("context-menu").els.length||t.target.matches("context-menu"))return;window.lastElementRightClicked=t.path[0],ie.maybeCloseAllContextMenus(t),ie.create(t,{classes:"rmb"});const a=t=>{let i=["context-menu"],s=!0;for(let e of i)(n(t.target).parents(e).els.length||t.target.matches(e))&&(s=!1);s&&(ie.closeAllContextMenus(".rmb"),e.removeEventListener("click",a))};e.addEventListener("click",a)}))}static closeAllContextMenus(e=""){n(`context-menu${e}`).remove(),n("dot-menu").removeClass("open")}static async create(e,t={}){return new Promise((async(a,i)=>{let s="items"in t?t.items:await ie.buildAncestralMenuItemsObject(e.target),r="origin"in t?t.origin:"top-left",o="position"in t?t.position.x:e.clientX,l="position"in t?t.position.y:e.clientY,d="ctrl"in t?t.ctrl:e.ctrlKey,c="alt"in t?t.alt:e.altKey,u="shift"in t?t.shift:e.shiftKey,h="id"in t?t.id:"",p="classes"in t?t.classes:"",m=!("show"in t)||t.show;if("object"!=typeof s||!Object.keys(s).length)return;let f=n("#app").appendHtml(`<context-menu class="${p}"></context-menu>`);f.attr("position-x",o).attr("position-y",l).attr("ctrl",d).attr("alt",c).attr("shift",u).attr("origin",r).attr("show",m).attr("id",h).css({top:l,left:o}),await f.el().buildHtml(s),f.el().registerEventListeners(),f.addClass("show"),a(f.els[0])}))}}function se(e){if(!("dragEl"in e))throw new Error("DragNDrop requires the dragEl option");if(!("dropEl"in e))throw new Error("DragNDrop requires the dropEl option");e.dragEl.addEventListener("dragstart",(t=>{if(!("onDrag"in e)||"function"!=typeof e.onDrag||!1!==e.onDrag(t)){if("dragImage"in e&&!1===e.dragImage){const e=document.createElement("div");e.style.width="1px",e.style.height="1px",e.style.position="fixed",e.style.top=0,e.style.left=0,e.classList.add("fake-drag-image"),document.body.appendChild(e),t.dataTransfer.setDragImage(e,0,0)}else if("dragImage"in e&&e.dragImage instanceof Element){let a=e.dragImage.getBoundingClientRect();t.dataTransfer.setDragImage(e.dragImage,t.pageX-a.left,t.pageY-a.top)}t.dataTransfer.setData("text/plain",e.dragEl.outerHTML),t.dataTransfer.dropEffect="move",t.target.classList.add("dragging")}})),"dragoverEl"in e&&(e.dragoverEl.addEventListener("dragover",(t=>{const a=e.dragoverEl;t.pageY<n(a).position().y+a.clientHeight/2?(a.classList.remove("can-drop-bottom"),a.classList.add("can-drop-top")):(a.classList.remove("can-drop-top"),a.classList.add("can-drop-bottom")),t.preventDefault()})),e.dragoverEl.addEventListener("dragleave",(t=>{e.dragoverEl.classList.remove("can-drop-top"),e.dragoverEl.classList.remove("can-drop-bottom")}))),e.dragEl.addEventListener("dragend",(t=>{"onDragEnd"in e&&"function"==typeof e.onDragEnd&&e.onDragEnd(t),"none"===t.dataTransfer.dropEffect&&ne()})),e.dropEl.addEventListener("drop",(t=>{const a=e.dropEl,i=t.dataTransfer.getData("text/plain");let s;s=a.classList.contains("can-drop-top")?n(a).before(i):(a.classList.contains("can-drop-bottom"),n(a).after(i)),n(".dragging").remove(),s.animate("fadeIn","speed-1s"),"onDrop"in e&&"function"==typeof e.onDrop&&e.onDrop(t,s.el()),ne()}))}function ne(){n(".can-drop-top").removeClass("can-drop-top"),n(".can-drop-bottom").removeClass("can-drop-bottom"),n(".dragging").removeClass("dragging"),n(".fake-drag-image").els.length&&n(".fake-drag-image").remove()}function re(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function oe(){return(oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}function le(e){return null!==e&&"object"==typeof e&&"constructor"in e&&e.constructor===Object}function de(e,t){void 0===e&&(e={}),void 0===t&&(t={}),Object.keys(t).forEach((function(a){void 0===e[a]?e[a]=t[a]:le(t[a])&&le(e[a])&&Object.keys(t[a]).length>0&&de(e[a],t[a])}))}var ce={body:{},addEventListener:function(){},removeEventListener:function(){},activeElement:{blur:function(){},nodeName:""},querySelector:function(){return null},querySelectorAll:function(){return[]},getElementById:function(){return null},createEvent:function(){return{initEvent:function(){}}},createElement:function(){return{children:[],childNodes:[],style:{},setAttribute:function(){},getElementsByTagName:function(){return[]}}},createElementNS:function(){return{}},importNode:function(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function ue(){var e="undefined"!=typeof document?document:{};return de(e,ce),e}var he={document:ce,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState:function(){},pushState:function(){},go:function(){},back:function(){}},CustomEvent:function(){return this},addEventListener:function(){},removeEventListener:function(){},getComputedStyle:function(){return{getPropertyValue:function(){return""}}},Image:function(){},Date:function(){},screen:{},setTimeout:function(){},clearTimeout:function(){},matchMedia:function(){return{}},requestAnimationFrame:function(e){return"undefined"==typeof setTimeout?(e(),null):setTimeout(e,0)},cancelAnimationFrame:function(e){"undefined"!=typeof setTimeout&&clearTimeout(e)}};function pe(){var e="undefined"!=typeof window?window:{};return de(e,he),e}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ge(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ve(e,t,a){return(ve=ge()?Reflect.construct:function(e,t,a){var i=[null];i.push.apply(i,t);var s=new(Function.bind.apply(e,i));return a&&fe(s,a.prototype),s}).apply(null,arguments)}function ye(e){var t="function"==typeof Map?new Map:void 0;return(ye=function(e){if(null===e||(a=e,-1===Function.toString.call(a).indexOf("[native code]")))return e;var a;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return ve(e,arguments,me(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),fe(i,e)})(e)}var be=function(e){var t,a;function i(t){var a,i,s;return i=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a=e.call.apply(e,[this].concat(t))||this),s=i.__proto__,Object.defineProperty(i,"__proto__",{get:function(){return s},set:function(e){s.__proto__=e}}),a}return a=e,(t=i).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a,i}(ye(Array));function we(e){void 0===e&&(e=[]);var t=[];return e.forEach((function(e){Array.isArray(e)?t.push.apply(t,we(e)):t.push(e)})),t}function _e(e,t){return Array.prototype.filter.call(e,t)}function ke(e,t){var a=pe(),i=ue(),s=[];if(!t&&e instanceof be)return e;if(!e)return new be(s);if("string"==typeof e){var n=e.trim();if(n.indexOf("<")>=0&&n.indexOf(">")>=0){var r="div";0===n.indexOf("<li")&&(r="ul"),0===n.indexOf("<tr")&&(r="tbody"),0!==n.indexOf("<td")&&0!==n.indexOf("<th")||(r="tr"),0===n.indexOf("<tbody")&&(r="table"),0===n.indexOf("<option")&&(r="select");var o=i.createElement(r);o.innerHTML=n;for(var l=0;l<o.childNodes.length;l+=1)s.push(o.childNodes[l])}else s=function(e,t){if("string"!=typeof e)return[e];for(var a=[],i=t.querySelectorAll(e),s=0;s<i.length;s+=1)a.push(i[s]);return a}(e.trim(),t||i)}else if(e.nodeType||e===a||e===i)s.push(e);else if(Array.isArray(e)){if(e instanceof be)return e;s=e}return new be(function(e){for(var t=[],a=0;a<e.length;a+=1)-1===t.indexOf(e[a])&&t.push(e[a]);return t}(s))}ke.fn=be.prototype;var Ce,xe,Se,Te={addClass:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=we(t.map((function(e){return e.split(" ")})));return this.forEach((function(e){var t;(t=e.classList).add.apply(t,i)})),this},removeClass:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=we(t.map((function(e){return e.split(" ")})));return this.forEach((function(e){var t;(t=e.classList).remove.apply(t,i)})),this},hasClass:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=we(t.map((function(e){return e.split(" ")})));return _e(this,(function(e){return i.filter((function(t){return e.classList.contains(t)})).length>0})).length>0},toggleClass:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=we(t.map((function(e){return e.split(" ")})));this.forEach((function(e){i.forEach((function(t){e.classList.toggle(t)}))}))},attr:function(e,t){if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(var a=0;a<this.length;a+=1)if(2===arguments.length)this[a].setAttribute(e,t);else for(var i in e)this[a][i]=e[i],this[a].setAttribute(i,e[i]);return this},removeAttr:function(e){for(var t=0;t<this.length;t+=1)this[t].removeAttribute(e);return this},transform:function(e){for(var t=0;t<this.length;t+=1)this[t].style.transform=e;return this},transition:function(e){for(var t=0;t<this.length;t+=1)this[t].style.transition="string"!=typeof e?e+"ms":e;return this},on:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=t[0],s=t[1],n=t[2],r=t[3];function o(e){var t=e.target;if(t){var a=e.target.dom7EventData||[];if(a.indexOf(e)<0&&a.unshift(e),ke(t).is(s))n.apply(t,a);else for(var i=ke(t).parents(),r=0;r<i.length;r+=1)ke(i[r]).is(s)&&n.apply(i[r],a)}}function l(e){var t=e&&e.target&&e.target.dom7EventData||[];t.indexOf(e)<0&&t.unshift(e),n.apply(this,t)}"function"==typeof t[1]&&(i=t[0],n=t[1],r=t[2],s=void 0),r||(r=!1);for(var d,c=i.split(" "),u=0;u<this.length;u+=1){var h=this[u];if(s)for(d=0;d<c.length;d+=1){var p=c[d];h.dom7LiveListeners||(h.dom7LiveListeners={}),h.dom7LiveListeners[p]||(h.dom7LiveListeners[p]=[]),h.dom7LiveListeners[p].push({listener:n,proxyListener:o}),h.addEventListener(p,o,r)}else for(d=0;d<c.length;d+=1){var m=c[d];h.dom7Listeners||(h.dom7Listeners={}),h.dom7Listeners[m]||(h.dom7Listeners[m]=[]),h.dom7Listeners[m].push({listener:n,proxyListener:l}),h.addEventListener(m,l,r)}}return this},off:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=t[0],s=t[1],n=t[2],r=t[3];"function"==typeof t[1]&&(i=t[0],n=t[1],r=t[2],s=void 0),r||(r=!1);for(var o=i.split(" "),l=0;l<o.length;l+=1)for(var d=o[l],c=0;c<this.length;c+=1){var u=this[c],h=void 0;if(!s&&u.dom7Listeners?h=u.dom7Listeners[d]:s&&u.dom7LiveListeners&&(h=u.dom7LiveListeners[d]),h&&h.length)for(var p=h.length-1;p>=0;p-=1){var m=h[p];n&&m.listener===n||n&&m.listener&&m.listener.dom7proxy&&m.listener.dom7proxy===n?(u.removeEventListener(d,m.proxyListener,r),h.splice(p,1)):n||(u.removeEventListener(d,m.proxyListener,r),h.splice(p,1))}}return this},trigger:function(){for(var e=pe(),t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];for(var s=a[0].split(" "),n=a[1],r=0;r<s.length;r+=1)for(var o=s[r],l=0;l<this.length;l+=1){var d=this[l];if(e.CustomEvent){var c=new e.CustomEvent(o,{detail:n,bubbles:!0,cancelable:!0});d.dom7EventData=a.filter((function(e,t){return t>0})),d.dispatchEvent(c),d.dom7EventData=[],delete d.dom7EventData}}return this},transitionEnd:function(e){var t=this;return e&&t.on("transitionend",(function a(i){i.target===this&&(e.call(this,i),t.off("transitionend",a))})),this},outerWidth:function(e){if(this.length>0){if(e){var t=this.styles();return this[0].offsetWidth+parseFloat(t.getPropertyValue("margin-right"))+parseFloat(t.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null},outerHeight:function(e){if(this.length>0){if(e){var t=this.styles();return this[0].offsetHeight+parseFloat(t.getPropertyValue("margin-top"))+parseFloat(t.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null},styles:function(){var e=pe();return this[0]?e.getComputedStyle(this[0],null):{}},offset:function(){if(this.length>0){var e=pe(),t=ue(),a=this[0],i=a.getBoundingClientRect(),s=t.body,n=a.clientTop||s.clientTop||0,r=a.clientLeft||s.clientLeft||0,o=a===e?e.scrollY:a.scrollTop,l=a===e?e.scrollX:a.scrollLeft;return{top:i.top+o-n,left:i.left+l-r}}return null},css:function(e,t){var a,i=pe();if(1===arguments.length){if("string"!=typeof e){for(a=0;a<this.length;a+=1)for(var s in e)this[a].style[s]=e[s];return this}if(this[0])return i.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(a=0;a<this.length;a+=1)this[a].style[e]=t;return this}return this},each:function(e){return e?(this.forEach((function(t,a){e.apply(t,[t,a])})),this):this},html:function(e){if(void 0===e)return this[0]?this[0].innerHTML:null;for(var t=0;t<this.length;t+=1)this[t].innerHTML=e;return this},text:function(e){if(void 0===e)return this[0]?this[0].textContent.trim():null;for(var t=0;t<this.length;t+=1)this[t].textContent=e;return this},is:function(e){var t,a,i=pe(),s=ue(),n=this[0];if(!n||void 0===e)return!1;if("string"==typeof e){if(n.matches)return n.matches(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);for(t=ke(e),a=0;a<t.length;a+=1)if(t[a]===n)return!0;return!1}if(e===s)return n===s;if(e===i)return n===i;if(e.nodeType||e instanceof be){for(t=e.nodeType?[e]:e,a=0;a<t.length;a+=1)if(t[a]===n)return!0;return!1}return!1},index:function(){var e,t=this[0];if(t){for(e=0;null!==(t=t.previousSibling);)1===t.nodeType&&(e+=1);return e}},eq:function(e){if(void 0===e)return this;var t=this.length;if(e>t-1)return ke([]);if(e<0){var a=t+e;return ke(a<0?[]:[this[a]])}return ke([this[e]])},append:function(){for(var e,t=ue(),a=0;a<arguments.length;a+=1){e=a<0||arguments.length<=a?void 0:arguments[a];for(var i=0;i<this.length;i+=1)if("string"==typeof e){var s=t.createElement("div");for(s.innerHTML=e;s.firstChild;)this[i].appendChild(s.firstChild)}else if(e instanceof be)for(var n=0;n<e.length;n+=1)this[i].appendChild(e[n]);else this[i].appendChild(e)}return this},prepend:function(e){var t,a,i=ue();for(t=0;t<this.length;t+=1)if("string"==typeof e){var s=i.createElement("div");for(s.innerHTML=e,a=s.childNodes.length-1;a>=0;a-=1)this[t].insertBefore(s.childNodes[a],this[t].childNodes[0])}else if(e instanceof be)for(a=0;a<e.length;a+=1)this[t].insertBefore(e[a],this[t].childNodes[0]);else this[t].insertBefore(e,this[t].childNodes[0]);return this},next:function(e){return this.length>0?e?this[0].nextElementSibling&&ke(this[0].nextElementSibling).is(e)?ke([this[0].nextElementSibling]):ke([]):this[0].nextElementSibling?ke([this[0].nextElementSibling]):ke([]):ke([])},nextAll:function(e){var t=[],a=this[0];if(!a)return ke([]);for(;a.nextElementSibling;){var i=a.nextElementSibling;e?ke(i).is(e)&&t.push(i):t.push(i),a=i}return ke(t)},prev:function(e){if(this.length>0){var t=this[0];return e?t.previousElementSibling&&ke(t.previousElementSibling).is(e)?ke([t.previousElementSibling]):ke([]):t.previousElementSibling?ke([t.previousElementSibling]):ke([])}return ke([])},prevAll:function(e){var t=[],a=this[0];if(!a)return ke([]);for(;a.previousElementSibling;){var i=a.previousElementSibling;e?ke(i).is(e)&&t.push(i):t.push(i),a=i}return ke(t)},parent:function(e){for(var t=[],a=0;a<this.length;a+=1)null!==this[a].parentNode&&(e?ke(this[a].parentNode).is(e)&&t.push(this[a].parentNode):t.push(this[a].parentNode));return ke(t)},parents:function(e){for(var t=[],a=0;a<this.length;a+=1)for(var i=this[a].parentNode;i;)e?ke(i).is(e)&&t.push(i):t.push(i),i=i.parentNode;return ke(t)},closest:function(e){var t=this;return void 0===e?ke([]):(t.is(e)||(t=t.parents(e).eq(0)),t)},find:function(e){for(var t=[],a=0;a<this.length;a+=1)for(var i=this[a].querySelectorAll(e),s=0;s<i.length;s+=1)t.push(i[s]);return ke(t)},children:function(e){for(var t=[],a=0;a<this.length;a+=1)for(var i=this[a].children,s=0;s<i.length;s+=1)e&&!ke(i[s]).is(e)||t.push(i[s]);return ke(t)},filter:function(e){return ke(_e(this,e))},remove:function(){for(var e=0;e<this.length;e+=1)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this}};function Ee(e,t){return void 0===t&&(t=0),setTimeout(e,t)}function Pe(){return Date.now()}function Ae(e,t){void 0===t&&(t="x");var a,i,s,n=pe(),r=n.getComputedStyle(e,null);return n.WebKitCSSMatrix?((i=r.transform||r.webkitTransform).split(",").length>6&&(i=i.split(", ").map((function(e){return e.replace(",",".")})).join(", ")),s=new n.WebKitCSSMatrix("none"===i?"":i)):a=(s=r.MozTransform||r.OTransform||r.MsTransform||r.msTransform||r.transform||r.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,")).toString().split(","),"x"===t&&(i=n.WebKitCSSMatrix?s.m41:16===a.length?parseFloat(a[12]):parseFloat(a[4])),"y"===t&&(i=n.WebKitCSSMatrix?s.m42:16===a.length?parseFloat(a[13]):parseFloat(a[5])),i||0}function Le(e){return"object"==typeof e&&null!==e&&e.constructor&&e.constructor===Object}function Me(){for(var e=Object(arguments.length<=0?void 0:arguments[0]),t=1;t<arguments.length;t+=1){var a=t<0||arguments.length<=t?void 0:arguments[t];if(null!=a)for(var i=Object.keys(Object(a)),s=0,n=i.length;s<n;s+=1){var r=i[s],o=Object.getOwnPropertyDescriptor(a,r);void 0!==o&&o.enumerable&&(Le(e[r])&&Le(a[r])?Me(e[r],a[r]):!Le(e[r])&&Le(a[r])?(e[r]={},Me(e[r],a[r])):e[r]=a[r])}}return e}function Ie(e,t){Object.keys(t).forEach((function(a){Le(t[a])&&Object.keys(t[a]).forEach((function(i){"function"==typeof t[a][i]&&(t[a][i]=t[a][i].bind(e))})),e[a]=t[a]}))}function Oe(){return Ce||(Ce=function(){var e=pe(),t=ue();return{touch:!!("ontouchstart"in e||e.DocumentTouch&&t instanceof e.DocumentTouch),pointerEvents:!!e.PointerEvent&&"maxTouchPoints"in e.navigator&&e.navigator.maxTouchPoints>=0,observer:"MutationObserver"in e||"WebkitMutationObserver"in e,passiveListener:function(){var t=!1;try{var a=Object.defineProperty({},"passive",{get:function(){t=!0}});e.addEventListener("testPassiveListener",null,a)}catch(e){}return t}(),gestures:"ongesturestart"in e}}()),Ce}function $e(e){return void 0===e&&(e={}),xe||(xe=function(e){var t=(void 0===e?{}:e).userAgent,a=Oe(),i=pe(),s=i.navigator.platform,n=t||i.navigator.userAgent,r={ios:!1,android:!1},o=i.screen.width,l=i.screen.height,d=n.match(/(Android);?[\s\/]+([\d.]+)?/),c=n.match(/(iPad).*OS\s([\d_]+)/),u=n.match(/(iPod)(.*OS\s([\d_]+))?/),h=!c&&n.match(/(iPhone\sOS|iOS)\s([\d_]+)/),p="Win32"===s,m="MacIntel"===s;return!c&&m&&a.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(o+"x"+l)>=0&&((c=n.match(/(Version)\/([\d.]+)/))||(c=[0,1,"13_0_0"]),m=!1),d&&!p&&(r.os="android",r.android=!0),(c||h||u)&&(r.os="ios",r.ios=!0),r}(e)),xe}function Be(){return Se||(Se=function(){var e,t=pe();return{isEdge:!!t.navigator.userAgent.match(/Edge/g),isSafari:(e=t.navigator.userAgent.toLowerCase(),e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent)}}()),Se}Object.keys(Te).forEach((function(e){ke.fn[e]=Te[e]}));var He={name:"resize",create:function(){var e=this;Me(e,{resize:{resizeHandler:function(){e&&!e.destroyed&&e.initialized&&(e.emit("beforeResize"),e.emit("resize"))},orientationChangeHandler:function(){e&&!e.destroyed&&e.initialized&&e.emit("orientationchange")}}})},on:{init:function(e){var t=pe();t.addEventListener("resize",e.resize.resizeHandler),t.addEventListener("orientationchange",e.resize.orientationChangeHandler)},destroy:function(e){var t=pe();t.removeEventListener("resize",e.resize.resizeHandler),t.removeEventListener("orientationchange",e.resize.orientationChangeHandler)}}},ze={attach:function(e,t){void 0===t&&(t={});var a=pe(),i=this,s=new(a.MutationObserver||a.WebkitMutationObserver)((function(e){if(1!==e.length){var t=function(){i.emit("observerUpdate",e[0])};a.requestAnimationFrame?a.requestAnimationFrame(t):a.setTimeout(t,0)}else i.emit("observerUpdate",e[0])}));s.observe(e,{attributes:void 0===t.attributes||t.attributes,childList:void 0===t.childList||t.childList,characterData:void 0===t.characterData||t.characterData}),i.observer.observers.push(s)},init:function(){var e=this;if(e.support.observer&&e.params.observer){if(e.params.observeParents)for(var t=e.$el.parents(),a=0;a<t.length;a+=1)e.observer.attach(t[a]);e.observer.attach(e.$el[0],{childList:e.params.observeSlideChildren}),e.observer.attach(e.$wrapperEl[0],{attributes:!1})}},destroy:function(){this.observer.observers.forEach((function(e){e.disconnect()})),this.observer.observers=[]}},De={name:"observer",params:{observer:!1,observeParents:!1,observeSlideChildren:!1},create:function(){Ie(this,{observer:oe(oe({},ze),{},{observers:[]})})},on:{init:function(e){e.observer.init()},destroy:function(e){e.observer.destroy()}}};function je(e){var t=this,a=ue(),i=pe(),s=t.touchEventsData,n=t.params,r=t.touches;if(!t.animating||!n.preventInteractionOnTransition){var o=e;o.originalEvent&&(o=o.originalEvent);var l=ke(o.target);if(("wrapper"!==n.touchEventsTarget||l.closest(t.wrapperEl).length)&&(s.isTouchEvent="touchstart"===o.type,(s.isTouchEvent||!("which"in o)||3!==o.which)&&!(!s.isTouchEvent&&"button"in o&&o.button>0||s.isTouched&&s.isMoved)))if(!!n.noSwipingClass&&""!==n.noSwipingClass&&o.target&&o.target.shadowRoot&&e.path&&e.path[0]&&(l=ke(e.path[0])),n.noSwiping&&l.closest(n.noSwipingSelector?n.noSwipingSelector:"."+n.noSwipingClass)[0])t.allowClick=!0;else if(!n.swipeHandler||l.closest(n.swipeHandler)[0]){r.currentX="touchstart"===o.type?o.targetTouches[0].pageX:o.pageX,r.currentY="touchstart"===o.type?o.targetTouches[0].pageY:o.pageY;var d=r.currentX,c=r.currentY,u=n.edgeSwipeDetection||n.iOSEdgeSwipeDetection,h=n.edgeSwipeThreshold||n.iOSEdgeSwipeThreshold;if(!u||!(d<=h||d>=i.screen.width-h)){if(Me(s,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),r.startX=d,r.startY=c,s.touchStartTime=Pe(),t.allowClick=!0,t.updateSize(),t.swipeDirection=void 0,n.threshold>0&&(s.allowThresholdMove=!1),"touchstart"!==o.type){var p=!0;l.is(s.formElements)&&(p=!1),a.activeElement&&ke(a.activeElement).is(s.formElements)&&a.activeElement!==l[0]&&a.activeElement.blur();var m=p&&t.allowTouchMove&&n.touchStartPreventDefault;(n.touchStartForcePreventDefault||m)&&o.preventDefault()}t.emit("touchStart",o)}}}}function qe(e){var t=ue(),a=this,i=a.touchEventsData,s=a.params,n=a.touches,r=a.rtlTranslate,o=e;if(o.originalEvent&&(o=o.originalEvent),i.isTouched){if(!i.isTouchEvent||"touchmove"===o.type){var l="touchmove"===o.type&&o.targetTouches&&(o.targetTouches[0]||o.changedTouches[0]),d="touchmove"===o.type?l.pageX:o.pageX,c="touchmove"===o.type?l.pageY:o.pageY;if(o.preventedByNestedSwiper)return n.startX=d,void(n.startY=c);if(!a.allowTouchMove)return a.allowClick=!1,void(i.isTouched&&(Me(n,{startX:d,startY:c,currentX:d,currentY:c}),i.touchStartTime=Pe()));if(i.isTouchEvent&&s.touchReleaseOnEdges&&!s.loop)if(a.isVertical()){if(c<n.startY&&a.translate<=a.maxTranslate()||c>n.startY&&a.translate>=a.minTranslate())return i.isTouched=!1,void(i.isMoved=!1)}else if(d<n.startX&&a.translate<=a.maxTranslate()||d>n.startX&&a.translate>=a.minTranslate())return;if(i.isTouchEvent&&t.activeElement&&o.target===t.activeElement&&ke(o.target).is(i.formElements))return i.isMoved=!0,void(a.allowClick=!1);if(i.allowTouchCallbacks&&a.emit("touchMove",o),!(o.targetTouches&&o.targetTouches.length>1)){n.currentX=d,n.currentY=c;var u,h=n.currentX-n.startX,p=n.currentY-n.startY;if(!(a.params.threshold&&Math.sqrt(Math.pow(h,2)+Math.pow(p,2))<a.params.threshold))if(void 0===i.isScrolling&&(a.isHorizontal()&&n.currentY===n.startY||a.isVertical()&&n.currentX===n.startX?i.isScrolling=!1:h*h+p*p>=25&&(u=180*Math.atan2(Math.abs(p),Math.abs(h))/Math.PI,i.isScrolling=a.isHorizontal()?u>s.touchAngle:90-u>s.touchAngle)),i.isScrolling&&a.emit("touchMoveOpposite",o),void 0===i.startMoving&&(n.currentX===n.startX&&n.currentY===n.startY||(i.startMoving=!0)),i.isScrolling)i.isTouched=!1;else if(i.startMoving){a.allowClick=!1,!s.cssMode&&o.cancelable&&o.preventDefault(),s.touchMoveStopPropagation&&!s.nested&&o.stopPropagation(),i.isMoved||(s.loop&&a.loopFix(),i.startTranslate=a.getTranslate(),a.setTransition(0),a.animating&&a.$wrapperEl.trigger("webkitTransitionEnd transitionend"),i.allowMomentumBounce=!1,!s.grabCursor||!0!==a.allowSlideNext&&!0!==a.allowSlidePrev||a.setGrabCursor(!0),a.emit("sliderFirstMove",o)),a.emit("sliderMove",o),i.isMoved=!0;var m=a.isHorizontal()?h:p;n.diff=m,m*=s.touchRatio,r&&(m=-m),a.swipeDirection=m>0?"prev":"next",i.currentTranslate=m+i.startTranslate;var f=!0,g=s.resistanceRatio;if(s.touchReleaseOnEdges&&(g=0),m>0&&i.currentTranslate>a.minTranslate()?(f=!1,s.resistance&&(i.currentTranslate=a.minTranslate()-1+Math.pow(-a.minTranslate()+i.startTranslate+m,g))):m<0&&i.currentTranslate<a.maxTranslate()&&(f=!1,s.resistance&&(i.currentTranslate=a.maxTranslate()+1-Math.pow(a.maxTranslate()-i.startTranslate-m,g))),f&&(o.preventedByNestedSwiper=!0),!a.allowSlideNext&&"next"===a.swipeDirection&&i.currentTranslate<i.startTranslate&&(i.currentTranslate=i.startTranslate),!a.allowSlidePrev&&"prev"===a.swipeDirection&&i.currentTranslate>i.startTranslate&&(i.currentTranslate=i.startTranslate),s.threshold>0){if(!(Math.abs(m)>s.threshold||i.allowThresholdMove))return void(i.currentTranslate=i.startTranslate);if(!i.allowThresholdMove)return i.allowThresholdMove=!0,n.startX=n.currentX,n.startY=n.currentY,i.currentTranslate=i.startTranslate,void(n.diff=a.isHorizontal()?n.currentX-n.startX:n.currentY-n.startY)}s.followFinger&&!s.cssMode&&((s.freeMode||s.watchSlidesProgress||s.watchSlidesVisibility)&&(a.updateActiveIndex(),a.updateSlidesClasses()),s.freeMode&&(0===i.velocities.length&&i.velocities.push({position:n[a.isHorizontal()?"startX":"startY"],time:i.touchStartTime}),i.velocities.push({position:n[a.isHorizontal()?"currentX":"currentY"],time:Pe()})),a.updateProgress(i.currentTranslate),a.setTranslate(i.currentTranslate))}}}}else i.startMoving&&i.isScrolling&&a.emit("touchMoveOpposite",o)}function Re(e){var t=this,a=t.touchEventsData,i=t.params,s=t.touches,n=t.rtlTranslate,r=t.$wrapperEl,o=t.slidesGrid,l=t.snapGrid,d=e;if(d.originalEvent&&(d=d.originalEvent),a.allowTouchCallbacks&&t.emit("touchEnd",d),a.allowTouchCallbacks=!1,!a.isTouched)return a.isMoved&&i.grabCursor&&t.setGrabCursor(!1),a.isMoved=!1,void(a.startMoving=!1);i.grabCursor&&a.isMoved&&a.isTouched&&(!0===t.allowSlideNext||!0===t.allowSlidePrev)&&t.setGrabCursor(!1);var c,u=Pe(),h=u-a.touchStartTime;if(t.allowClick&&(t.updateClickedSlide(d),t.emit("tap click",d),h<300&&u-a.lastClickTime<300&&t.emit("doubleTap doubleClick",d)),a.lastClickTime=Pe(),Ee((function(){t.destroyed||(t.allowClick=!0)})),!a.isTouched||!a.isMoved||!t.swipeDirection||0===s.diff||a.currentTranslate===a.startTranslate)return a.isTouched=!1,a.isMoved=!1,void(a.startMoving=!1);if(a.isTouched=!1,a.isMoved=!1,a.startMoving=!1,c=i.followFinger?n?t.translate:-t.translate:-a.currentTranslate,!i.cssMode)if(i.freeMode){if(c<-t.minTranslate())return void t.slideTo(t.activeIndex);if(c>-t.maxTranslate())return void(t.slides.length<l.length?t.slideTo(l.length-1):t.slideTo(t.slides.length-1));if(i.freeModeMomentum){if(a.velocities.length>1){var p=a.velocities.pop(),m=a.velocities.pop(),f=p.position-m.position,g=p.time-m.time;t.velocity=f/g,t.velocity/=2,Math.abs(t.velocity)<i.freeModeMinimumVelocity&&(t.velocity=0),(g>150||Pe()-p.time>300)&&(t.velocity=0)}else t.velocity=0;t.velocity*=i.freeModeMomentumVelocityRatio,a.velocities.length=0;var v=1e3*i.freeModeMomentumRatio,y=t.velocity*v,b=t.translate+y;n&&(b=-b);var w,_,k=!1,C=20*Math.abs(t.velocity)*i.freeModeMomentumBounceRatio;if(b<t.maxTranslate())i.freeModeMomentumBounce?(b+t.maxTranslate()<-C&&(b=t.maxTranslate()-C),w=t.maxTranslate(),k=!0,a.allowMomentumBounce=!0):b=t.maxTranslate(),i.loop&&i.centeredSlides&&(_=!0);else if(b>t.minTranslate())i.freeModeMomentumBounce?(b-t.minTranslate()>C&&(b=t.minTranslate()+C),w=t.minTranslate(),k=!0,a.allowMomentumBounce=!0):b=t.minTranslate(),i.loop&&i.centeredSlides&&(_=!0);else if(i.freeModeSticky){for(var x,S=0;S<l.length;S+=1)if(l[S]>-b){x=S;break}b=-(b=Math.abs(l[x]-b)<Math.abs(l[x-1]-b)||"next"===t.swipeDirection?l[x]:l[x-1])}if(_&&t.once("transitionEnd",(function(){t.loopFix()})),0!==t.velocity){if(v=n?Math.abs((-b-t.translate)/t.velocity):Math.abs((b-t.translate)/t.velocity),i.freeModeSticky){var T=Math.abs((n?-b:b)-t.translate),E=t.slidesSizesGrid[t.activeIndex];v=T<E?i.speed:T<2*E?1.5*i.speed:2.5*i.speed}}else if(i.freeModeSticky)return void t.slideToClosest();i.freeModeMomentumBounce&&k?(t.updateProgress(w),t.setTransition(v),t.setTranslate(b),t.transitionStart(!0,t.swipeDirection),t.animating=!0,r.transitionEnd((function(){t&&!t.destroyed&&a.allowMomentumBounce&&(t.emit("momentumBounce"),t.setTransition(i.speed),setTimeout((function(){t.setTranslate(w),r.transitionEnd((function(){t&&!t.destroyed&&t.transitionEnd()}))}),0))}))):t.velocity?(t.updateProgress(b),t.setTransition(v),t.setTranslate(b),t.transitionStart(!0,t.swipeDirection),t.animating||(t.animating=!0,r.transitionEnd((function(){t&&!t.destroyed&&t.transitionEnd()})))):t.updateProgress(b),t.updateActiveIndex(),t.updateSlidesClasses()}else if(i.freeModeSticky)return void t.slideToClosest();(!i.freeModeMomentum||h>=i.longSwipesMs)&&(t.updateProgress(),t.updateActiveIndex(),t.updateSlidesClasses())}else{for(var P=0,A=t.slidesSizesGrid[0],L=0;L<o.length;L+=L<i.slidesPerGroupSkip?1:i.slidesPerGroup){var M=L<i.slidesPerGroupSkip-1?1:i.slidesPerGroup;void 0!==o[L+M]?c>=o[L]&&c<o[L+M]&&(P=L,A=o[L+M]-o[L]):c>=o[L]&&(P=L,A=o[o.length-1]-o[o.length-2])}var I=(c-o[P])/A,O=P<i.slidesPerGroupSkip-1?1:i.slidesPerGroup;if(h>i.longSwipesMs){if(!i.longSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&(I>=i.longSwipesRatio?t.slideTo(P+O):t.slideTo(P)),"prev"===t.swipeDirection&&(I>1-i.longSwipesRatio?t.slideTo(P+O):t.slideTo(P))}else{if(!i.shortSwipes)return void t.slideTo(t.activeIndex);!t.navigation||d.target!==t.navigation.nextEl&&d.target!==t.navigation.prevEl?("next"===t.swipeDirection&&t.slideTo(P+O),"prev"===t.swipeDirection&&t.slideTo(P)):d.target===t.navigation.nextEl?t.slideTo(P+O):t.slideTo(P)}}}function Fe(){var e=this,t=e.params,a=e.el;if(!a||0!==a.offsetWidth){t.breakpoints&&e.setBreakpoint();var i=e.allowSlideNext,s=e.allowSlidePrev,n=e.snapGrid;e.allowSlideNext=!0,e.allowSlidePrev=!0,e.updateSize(),e.updateSlides(),e.updateSlidesClasses(),("auto"===t.slidesPerView||t.slidesPerView>1)&&e.isEnd&&!e.isBeginning&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0),e.autoplay&&e.autoplay.running&&e.autoplay.paused&&e.autoplay.run(),e.allowSlidePrev=s,e.allowSlideNext=i,e.params.watchOverflow&&n!==e.snapGrid&&e.checkOverflow()}}function Ne(e){var t=this;t.allowClick||(t.params.preventClicks&&e.preventDefault(),t.params.preventClicksPropagation&&t.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))}function Ge(){var e=this,t=e.wrapperEl,a=e.rtlTranslate;e.previousTranslate=e.translate,e.isHorizontal()?e.translate=a?t.scrollWidth-t.offsetWidth-t.scrollLeft:-t.scrollLeft:e.translate=-t.scrollTop,-0===e.translate&&(e.translate=0),e.updateActiveIndex(),e.updateSlidesClasses();var i=e.maxTranslate()-e.minTranslate();(0===i?0:(e.translate-e.minTranslate())/i)!==e.progress&&e.updateProgress(a?-e.translate:e.translate),e.emit("setTranslate",e.translate,!1)}var We=!1;function Ve(){}var Qe={init:!0,direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,nested:!1,width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,slidesPerGroupSkip:0,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!1,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,containerModifierClass:"swiper-container-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1},Xe={modular:{useParams:function(e){var t=this;t.modules&&Object.keys(t.modules).forEach((function(a){var i=t.modules[a];i.params&&Me(e,i.params)}))},useModules:function(e){void 0===e&&(e={});var t=this;t.modules&&Object.keys(t.modules).forEach((function(a){var i=t.modules[a],s=e[a]||{};i.on&&t.on&&Object.keys(i.on).forEach((function(e){t.on(e,i.on[e])})),i.create&&i.create.bind(t)(s)}))}},eventsEmitter:{on:function(e,t,a){var i=this;if("function"!=typeof t)return i;var s=a?"unshift":"push";return e.split(" ").forEach((function(e){i.eventsListeners[e]||(i.eventsListeners[e]=[]),i.eventsListeners[e][s](t)})),i},once:function(e,t,a){var i=this;if("function"!=typeof t)return i;function s(){i.off(e,s),s.__emitterProxy&&delete s.__emitterProxy;for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];t.apply(i,n)}return s.__emitterProxy=t,i.on(e,s,a)},onAny:function(e,t){var a=this;if("function"!=typeof e)return a;var i=t?"unshift":"push";return a.eventsAnyListeners.indexOf(e)<0&&a.eventsAnyListeners[i](e),a},offAny:function(e){var t=this;if(!t.eventsAnyListeners)return t;var a=t.eventsAnyListeners.indexOf(e);return a>=0&&t.eventsAnyListeners.splice(a,1),t},off:function(e,t){var a=this;return a.eventsListeners?(e.split(" ").forEach((function(e){void 0===t?a.eventsListeners[e]=[]:a.eventsListeners[e]&&a.eventsListeners[e].forEach((function(i,s){(i===t||i.__emitterProxy&&i.__emitterProxy===t)&&a.eventsListeners[e].splice(s,1)}))})),a):a},emit:function(){var e,t,a,i=this;if(!i.eventsListeners)return i;for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];"string"==typeof n[0]||Array.isArray(n[0])?(e=n[0],t=n.slice(1,n.length),a=i):(e=n[0].events,t=n[0].data,a=n[0].context||i),t.unshift(a);var o=Array.isArray(e)?e:e.split(" ");return o.forEach((function(e){if(i.eventsAnyListeners&&i.eventsAnyListeners.length&&i.eventsAnyListeners.forEach((function(i){i.apply(a,[e].concat(t))})),i.eventsListeners&&i.eventsListeners[e]){var s=[];i.eventsListeners[e].forEach((function(e){s.push(e)})),s.forEach((function(e){e.apply(a,t)}))}})),i}},update:{updateSize:function(){var e,t,a=this,i=a.$el;e=void 0!==a.params.width&&null!==a.params.width?a.params.width:i[0].clientWidth,t=void 0!==a.params.height&&null!==a.params.width?a.params.height:i[0].clientHeight,0===e&&a.isHorizontal()||0===t&&a.isVertical()||(e=e-parseInt(i.css("padding-left")||0,10)-parseInt(i.css("padding-right")||0,10),t=t-parseInt(i.css("padding-top")||0,10)-parseInt(i.css("padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Me(a,{width:e,height:t,size:a.isHorizontal()?e:t}))},updateSlides:function(){var e=this,t=pe(),a=e.params,i=e.$wrapperEl,s=e.size,n=e.rtlTranslate,r=e.wrongRTL,o=e.virtual&&a.virtual.enabled,l=o?e.virtual.slides.length:e.slides.length,d=i.children("."+e.params.slideClass),c=o?e.virtual.slides.length:d.length,u=[],h=[],p=[];function m(e,t){return!a.cssMode||t!==d.length-1}var f=a.slidesOffsetBefore;"function"==typeof f&&(f=a.slidesOffsetBefore.call(e));var g=a.slidesOffsetAfter;"function"==typeof g&&(g=a.slidesOffsetAfter.call(e));var v=e.snapGrid.length,y=e.snapGrid.length,b=a.spaceBetween,w=-f,_=0,k=0;if(void 0!==s){var C,x;"string"==typeof b&&b.indexOf("%")>=0&&(b=parseFloat(b.replace("%",""))/100*s),e.virtualSize=-b,n?d.css({marginLeft:"",marginTop:""}):d.css({marginRight:"",marginBottom:""}),a.slidesPerColumn>1&&(C=Math.floor(c/a.slidesPerColumn)===c/e.params.slidesPerColumn?c:Math.ceil(c/a.slidesPerColumn)*a.slidesPerColumn,"auto"!==a.slidesPerView&&"row"===a.slidesPerColumnFill&&(C=Math.max(C,a.slidesPerView*a.slidesPerColumn)));for(var S,T=a.slidesPerColumn,E=C/T,P=Math.floor(c/a.slidesPerColumn),A=0;A<c;A+=1){x=0;var L=d.eq(A);if(a.slidesPerColumn>1){var M=void 0,I=void 0,O=void 0;if("row"===a.slidesPerColumnFill&&a.slidesPerGroup>1){var $=Math.floor(A/(a.slidesPerGroup*a.slidesPerColumn)),B=A-a.slidesPerColumn*a.slidesPerGroup*$,H=0===$?a.slidesPerGroup:Math.min(Math.ceil((c-$*T*a.slidesPerGroup)/T),a.slidesPerGroup);M=(I=B-(O=Math.floor(B/H))*H+$*a.slidesPerGroup)+O*C/T,L.css({"-webkit-box-ordinal-group":M,"-moz-box-ordinal-group":M,"-ms-flex-order":M,"-webkit-order":M,order:M})}else"column"===a.slidesPerColumnFill?(O=A-(I=Math.floor(A/T))*T,(I>P||I===P&&O===T-1)&&(O+=1)>=T&&(O=0,I+=1)):I=A-(O=Math.floor(A/E))*E;L.css("margin-"+(e.isHorizontal()?"top":"left"),0!==O&&a.spaceBetween&&a.spaceBetween+"px")}if("none"!==L.css("display")){if("auto"===a.slidesPerView){var z=t.getComputedStyle(L[0],null),D=L[0].style.transform,j=L[0].style.webkitTransform;if(D&&(L[0].style.transform="none"),j&&(L[0].style.webkitTransform="none"),a.roundLengths)x=e.isHorizontal()?L.outerWidth(!0):L.outerHeight(!0);else if(e.isHorizontal()){var q=parseFloat(z.getPropertyValue("width")||0),R=parseFloat(z.getPropertyValue("padding-left")||0),F=parseFloat(z.getPropertyValue("padding-right")||0),N=parseFloat(z.getPropertyValue("margin-left")||0),G=parseFloat(z.getPropertyValue("margin-right")||0),W=z.getPropertyValue("box-sizing");if(W&&"border-box"===W)x=q+N+G;else{var V=L[0],Q=V.clientWidth;x=q+R+F+N+G+(V.offsetWidth-Q)}}else{var X=parseFloat(z.getPropertyValue("height")||0),Y=parseFloat(z.getPropertyValue("padding-top")||0),U=parseFloat(z.getPropertyValue("padding-bottom")||0),K=parseFloat(z.getPropertyValue("margin-top")||0),J=parseFloat(z.getPropertyValue("margin-bottom")||0),Z=z.getPropertyValue("box-sizing");if(Z&&"border-box"===Z)x=X+K+J;else{var ee=L[0],te=ee.clientHeight;x=X+Y+U+K+J+(ee.offsetHeight-te)}}D&&(L[0].style.transform=D),j&&(L[0].style.webkitTransform=j),a.roundLengths&&(x=Math.floor(x))}else x=(s-(a.slidesPerView-1)*b)/a.slidesPerView,a.roundLengths&&(x=Math.floor(x)),d[A]&&(e.isHorizontal()?d[A].style.width=x+"px":d[A].style.height=x+"px");d[A]&&(d[A].swiperSlideSize=x),p.push(x),a.centeredSlides?(w=w+x/2+_/2+b,0===_&&0!==A&&(w=w-s/2-b),0===A&&(w=w-s/2-b),Math.abs(w)<.001&&(w=0),a.roundLengths&&(w=Math.floor(w)),k%a.slidesPerGroup==0&&u.push(w),h.push(w)):(a.roundLengths&&(w=Math.floor(w)),(k-Math.min(e.params.slidesPerGroupSkip,k))%e.params.slidesPerGroup==0&&u.push(w),h.push(w),w=w+x+b),e.virtualSize+=x+b,_=x,k+=1}}if(e.virtualSize=Math.max(e.virtualSize,s)+g,n&&r&&("slide"===a.effect||"coverflow"===a.effect)&&i.css({width:e.virtualSize+a.spaceBetween+"px"}),a.setWrapperSize&&(e.isHorizontal()?i.css({width:e.virtualSize+a.spaceBetween+"px"}):i.css({height:e.virtualSize+a.spaceBetween+"px"})),a.slidesPerColumn>1&&(e.virtualSize=(x+a.spaceBetween)*C,e.virtualSize=Math.ceil(e.virtualSize/a.slidesPerColumn)-a.spaceBetween,e.isHorizontal()?i.css({width:e.virtualSize+a.spaceBetween+"px"}):i.css({height:e.virtualSize+a.spaceBetween+"px"}),a.centeredSlides)){S=[];for(var ae=0;ae<u.length;ae+=1){var ie=u[ae];a.roundLengths&&(ie=Math.floor(ie)),u[ae]<e.virtualSize+u[0]&&S.push(ie)}u=S}if(!a.centeredSlides){S=[];for(var se=0;se<u.length;se+=1){var ne=u[se];a.roundLengths&&(ne=Math.floor(ne)),u[se]<=e.virtualSize-s&&S.push(ne)}u=S,Math.floor(e.virtualSize-s)-Math.floor(u[u.length-1])>1&&u.push(e.virtualSize-s)}if(0===u.length&&(u=[0]),0!==a.spaceBetween&&(e.isHorizontal()?n?d.filter(m).css({marginLeft:b+"px"}):d.filter(m).css({marginRight:b+"px"}):d.filter(m).css({marginBottom:b+"px"})),a.centeredSlides&&a.centeredSlidesBounds){var re=0;p.forEach((function(e){re+=e+(a.spaceBetween?a.spaceBetween:0)}));var oe=(re-=a.spaceBetween)-s;u=u.map((function(e){return e<0?-f:e>oe?oe+g:e}))}if(a.centerInsufficientSlides){var le=0;if(p.forEach((function(e){le+=e+(a.spaceBetween?a.spaceBetween:0)})),(le-=a.spaceBetween)<s){var de=(s-le)/2;u.forEach((function(e,t){u[t]=e-de})),h.forEach((function(e,t){h[t]=e+de}))}}Me(e,{slides:d,snapGrid:u,slidesGrid:h,slidesSizesGrid:p}),c!==l&&e.emit("slidesLengthChange"),u.length!==v&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),h.length!==y&&e.emit("slidesGridLengthChange"),(a.watchSlidesProgress||a.watchSlidesVisibility)&&e.updateSlidesOffset()}},updateAutoHeight:function(e){var t,a=this,i=[],s=0;if("number"==typeof e?a.setTransition(e):!0===e&&a.setTransition(a.params.speed),"auto"!==a.params.slidesPerView&&a.params.slidesPerView>1)if(a.params.centeredSlides)a.visibleSlides.each((function(e){i.push(e)}));else for(t=0;t<Math.ceil(a.params.slidesPerView);t+=1){var n=a.activeIndex+t;if(n>a.slides.length)break;i.push(a.slides.eq(n)[0])}else i.push(a.slides.eq(a.activeIndex)[0]);for(t=0;t<i.length;t+=1)if(void 0!==i[t]){var r=i[t].offsetHeight;s=r>s?r:s}s&&a.$wrapperEl.css("height",s+"px")},updateSlidesOffset:function(){for(var e=this.slides,t=0;t<e.length;t+=1)e[t].swiperSlideOffset=this.isHorizontal()?e[t].offsetLeft:e[t].offsetTop},updateSlidesProgress:function(e){void 0===e&&(e=this&&this.translate||0);var t=this,a=t.params,i=t.slides,s=t.rtlTranslate;if(0!==i.length){void 0===i[0].swiperSlideOffset&&t.updateSlidesOffset();var n=-e;s&&(n=e),i.removeClass(a.slideVisibleClass),t.visibleSlidesIndexes=[],t.visibleSlides=[];for(var r=0;r<i.length;r+=1){var o=i[r],l=(n+(a.centeredSlides?t.minTranslate():0)-o.swiperSlideOffset)/(o.swiperSlideSize+a.spaceBetween);if(a.watchSlidesVisibility||a.centeredSlides&&a.autoHeight){var d=-(n-o.swiperSlideOffset),c=d+t.slidesSizesGrid[r];(d>=0&&d<t.size-1||c>1&&c<=t.size||d<=0&&c>=t.size)&&(t.visibleSlides.push(o),t.visibleSlidesIndexes.push(r),i.eq(r).addClass(a.slideVisibleClass))}o.progress=s?-l:l}t.visibleSlides=ke(t.visibleSlides)}},updateProgress:function(e){var t=this;if(void 0===e){var a=t.rtlTranslate?-1:1;e=t&&t.translate&&t.translate*a||0}var i=t.params,s=t.maxTranslate()-t.minTranslate(),n=t.progress,r=t.isBeginning,o=t.isEnd,l=r,d=o;0===s?(n=0,r=!0,o=!0):(r=(n=(e-t.minTranslate())/s)<=0,o=n>=1),Me(t,{progress:n,isBeginning:r,isEnd:o}),(i.watchSlidesProgress||i.watchSlidesVisibility||i.centeredSlides&&i.autoHeight)&&t.updateSlidesProgress(e),r&&!l&&t.emit("reachBeginning toEdge"),o&&!d&&t.emit("reachEnd toEdge"),(l&&!r||d&&!o)&&t.emit("fromEdge"),t.emit("progress",n)},updateSlidesClasses:function(){var e,t=this,a=t.slides,i=t.params,s=t.$wrapperEl,n=t.activeIndex,r=t.realIndex,o=t.virtual&&i.virtual.enabled;a.removeClass(i.slideActiveClass+" "+i.slideNextClass+" "+i.slidePrevClass+" "+i.slideDuplicateActiveClass+" "+i.slideDuplicateNextClass+" "+i.slideDuplicatePrevClass),(e=o?t.$wrapperEl.find("."+i.slideClass+'[data-swiper-slide-index="'+n+'"]'):a.eq(n)).addClass(i.slideActiveClass),i.loop&&(e.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+r+'"]').addClass(i.slideDuplicateActiveClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+r+'"]').addClass(i.slideDuplicateActiveClass));var l=e.nextAll("."+i.slideClass).eq(0).addClass(i.slideNextClass);i.loop&&0===l.length&&(l=a.eq(0)).addClass(i.slideNextClass);var d=e.prevAll("."+i.slideClass).eq(0).addClass(i.slidePrevClass);i.loop&&0===d.length&&(d=a.eq(-1)).addClass(i.slidePrevClass),i.loop&&(l.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+l.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicateNextClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+l.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicateNextClass),d.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+d.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicatePrevClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+d.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicatePrevClass)),t.emitSlidesClasses()},updateActiveIndex:function(e){var t,a=this,i=a.rtlTranslate?a.translate:-a.translate,s=a.slidesGrid,n=a.snapGrid,r=a.params,o=a.activeIndex,l=a.realIndex,d=a.snapIndex,c=e;if(void 0===c){for(var u=0;u<s.length;u+=1)void 0!==s[u+1]?i>=s[u]&&i<s[u+1]-(s[u+1]-s[u])/2?c=u:i>=s[u]&&i<s[u+1]&&(c=u+1):i>=s[u]&&(c=u);r.normalizeSlideIndex&&(c<0||void 0===c)&&(c=0)}if(n.indexOf(i)>=0)t=n.indexOf(i);else{var h=Math.min(r.slidesPerGroupSkip,c);t=h+Math.floor((c-h)/r.slidesPerGroup)}if(t>=n.length&&(t=n.length-1),c!==o){var p=parseInt(a.slides.eq(c).attr("data-swiper-slide-index")||c,10);Me(a,{snapIndex:t,realIndex:p,previousIndex:o,activeIndex:c}),a.emit("activeIndexChange"),a.emit("snapIndexChange"),l!==p&&a.emit("realIndexChange"),(a.initialized||a.params.runCallbacksOnInit)&&a.emit("slideChange")}else t!==d&&(a.snapIndex=t,a.emit("snapIndexChange"))},updateClickedSlide:function(e){var t=this,a=t.params,i=ke(e.target).closest("."+a.slideClass)[0],s=!1;if(i)for(var n=0;n<t.slides.length;n+=1)t.slides[n]===i&&(s=!0);if(!i||!s)return t.clickedSlide=void 0,void(t.clickedIndex=void 0);t.clickedSlide=i,t.virtual&&t.params.virtual.enabled?t.clickedIndex=parseInt(ke(i).attr("data-swiper-slide-index"),10):t.clickedIndex=ke(i).index(),a.slideToClickedSlide&&void 0!==t.clickedIndex&&t.clickedIndex!==t.activeIndex&&t.slideToClickedSlide()}},translate:{getTranslate:function(e){void 0===e&&(e=this.isHorizontal()?"x":"y");var t=this,a=t.params,i=t.rtlTranslate,s=t.translate,n=t.$wrapperEl;if(a.virtualTranslate)return i?-s:s;if(a.cssMode)return s;var r=Ae(n[0],e);return i&&(r=-r),r||0},setTranslate:function(e,t){var a=this,i=a.rtlTranslate,s=a.params,n=a.$wrapperEl,r=a.wrapperEl,o=a.progress,l=0,d=0;a.isHorizontal()?l=i?-e:e:d=e,s.roundLengths&&(l=Math.floor(l),d=Math.floor(d)),s.cssMode?r[a.isHorizontal()?"scrollLeft":"scrollTop"]=a.isHorizontal()?-l:-d:s.virtualTranslate||n.transform("translate3d("+l+"px, "+d+"px, 0px)"),a.previousTranslate=a.translate,a.translate=a.isHorizontal()?l:d;var c=a.maxTranslate()-a.minTranslate();(0===c?0:(e-a.minTranslate())/c)!==o&&a.updateProgress(e),a.emit("setTranslate",a.translate,t)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]},translateTo:function(e,t,a,i,s){void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===a&&(a=!0),void 0===i&&(i=!0);var n=this,r=n.params,o=n.wrapperEl;if(n.animating&&r.preventInteractionOnTransition)return!1;var l,d=n.minTranslate(),c=n.maxTranslate();if(l=i&&e>d?d:i&&e<c?c:e,n.updateProgress(l),r.cssMode){var u,h=n.isHorizontal();return 0===t?o[h?"scrollLeft":"scrollTop"]=-l:o.scrollTo?o.scrollTo(((u={})[h?"left":"top"]=-l,u.behavior="smooth",u)):o[h?"scrollLeft":"scrollTop"]=-l,!0}return 0===t?(n.setTransition(0),n.setTranslate(l),a&&(n.emit("beforeTransitionStart",t,s),n.emit("transitionEnd"))):(n.setTransition(t),n.setTranslate(l),a&&(n.emit("beforeTransitionStart",t,s),n.emit("transitionStart")),n.animating||(n.animating=!0,n.onTranslateToWrapperTransitionEnd||(n.onTranslateToWrapperTransitionEnd=function(e){n&&!n.destroyed&&e.target===this&&(n.$wrapperEl[0].removeEventListener("transitionend",n.onTranslateToWrapperTransitionEnd),n.$wrapperEl[0].removeEventListener("webkitTransitionEnd",n.onTranslateToWrapperTransitionEnd),n.onTranslateToWrapperTransitionEnd=null,delete n.onTranslateToWrapperTransitionEnd,a&&n.emit("transitionEnd"))}),n.$wrapperEl[0].addEventListener("transitionend",n.onTranslateToWrapperTransitionEnd),n.$wrapperEl[0].addEventListener("webkitTransitionEnd",n.onTranslateToWrapperTransitionEnd))),!0}},transition:{setTransition:function(e,t){var a=this;a.params.cssMode||a.$wrapperEl.transition(e),a.emit("setTransition",e,t)},transitionStart:function(e,t){void 0===e&&(e=!0);var a=this,i=a.activeIndex,s=a.params,n=a.previousIndex;if(!s.cssMode){s.autoHeight&&a.updateAutoHeight();var r=t;if(r||(r=i>n?"next":i<n?"prev":"reset"),a.emit("transitionStart"),e&&i!==n){if("reset"===r)return void a.emit("slideResetTransitionStart");a.emit("slideChangeTransitionStart"),"next"===r?a.emit("slideNextTransitionStart"):a.emit("slidePrevTransitionStart")}}},transitionEnd:function(e,t){void 0===e&&(e=!0);var a=this,i=a.activeIndex,s=a.previousIndex,n=a.params;if(a.animating=!1,!n.cssMode){a.setTransition(0);var r=t;if(r||(r=i>s?"next":i<s?"prev":"reset"),a.emit("transitionEnd"),e&&i!==s){if("reset"===r)return void a.emit("slideResetTransitionEnd");a.emit("slideChangeTransitionEnd"),"next"===r?a.emit("slideNextTransitionEnd"):a.emit("slidePrevTransitionEnd")}}}},slide:{slideTo:function(e,t,a,i){if(void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===a&&(a=!0),"number"!=typeof e&&"string"!=typeof e)throw new Error("The 'index' argument cannot have type other than 'number' or 'string'. ["+typeof e+"] given.");if("string"==typeof e){var s=parseInt(e,10);if(!isFinite(s))throw new Error("The passed-in 'index' (string) couldn't be converted to 'number'. ["+e+"] given.");e=s}var n=this,r=e;r<0&&(r=0);var o=n.params,l=n.snapGrid,d=n.slidesGrid,c=n.previousIndex,u=n.activeIndex,h=n.rtlTranslate,p=n.wrapperEl;if(n.animating&&o.preventInteractionOnTransition)return!1;var m=Math.min(n.params.slidesPerGroupSkip,r),f=m+Math.floor((r-m)/n.params.slidesPerGroup);f>=l.length&&(f=l.length-1),(u||o.initialSlide||0)===(c||0)&&a&&n.emit("beforeSlideChangeStart");var g,v=-l[f];if(n.updateProgress(v),o.normalizeSlideIndex)for(var y=0;y<d.length;y+=1)-Math.floor(100*v)>=Math.floor(100*d[y])&&(r=y);if(n.initialized&&r!==u){if(!n.allowSlideNext&&v<n.translate&&v<n.minTranslate())return!1;if(!n.allowSlidePrev&&v>n.translate&&v>n.maxTranslate()&&(u||0)!==r)return!1}if(g=r>u?"next":r<u?"prev":"reset",h&&-v===n.translate||!h&&v===n.translate)return n.updateActiveIndex(r),o.autoHeight&&n.updateAutoHeight(),n.updateSlidesClasses(),"slide"!==o.effect&&n.setTranslate(v),"reset"!==g&&(n.transitionStart(a,g),n.transitionEnd(a,g)),!1;if(o.cssMode){var b,w=n.isHorizontal(),_=-v;return h&&(_=p.scrollWidth-p.offsetWidth-_),0===t?p[w?"scrollLeft":"scrollTop"]=_:p.scrollTo?p.scrollTo(((b={})[w?"left":"top"]=_,b.behavior="smooth",b)):p[w?"scrollLeft":"scrollTop"]=_,!0}return 0===t?(n.setTransition(0),n.setTranslate(v),n.updateActiveIndex(r),n.updateSlidesClasses(),n.emit("beforeTransitionStart",t,i),n.transitionStart(a,g),n.transitionEnd(a,g)):(n.setTransition(t),n.setTranslate(v),n.updateActiveIndex(r),n.updateSlidesClasses(),n.emit("beforeTransitionStart",t,i),n.transitionStart(a,g),n.animating||(n.animating=!0,n.onSlideToWrapperTransitionEnd||(n.onSlideToWrapperTransitionEnd=function(e){n&&!n.destroyed&&e.target===this&&(n.$wrapperEl[0].removeEventListener("transitionend",n.onSlideToWrapperTransitionEnd),n.$wrapperEl[0].removeEventListener("webkitTransitionEnd",n.onSlideToWrapperTransitionEnd),n.onSlideToWrapperTransitionEnd=null,delete n.onSlideToWrapperTransitionEnd,n.transitionEnd(a,g))}),n.$wrapperEl[0].addEventListener("transitionend",n.onSlideToWrapperTransitionEnd),n.$wrapperEl[0].addEventListener("webkitTransitionEnd",n.onSlideToWrapperTransitionEnd))),!0},slideToLoop:function(e,t,a,i){void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===a&&(a=!0);var s=this,n=e;return s.params.loop&&(n+=s.loopedSlides),s.slideTo(n,t,a,i)},slideNext:function(e,t,a){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);var i=this,s=i.params,n=i.animating,r=i.activeIndex<s.slidesPerGroupSkip?1:s.slidesPerGroup;if(s.loop){if(n&&s.loopPreventsSlide)return!1;i.loopFix(),i._clientLeft=i.$wrapperEl[0].clientLeft}return i.slideTo(i.activeIndex+r,e,t,a)},slidePrev:function(e,t,a){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);var i=this,s=i.params,n=i.animating,r=i.snapGrid,o=i.slidesGrid,l=i.rtlTranslate;if(s.loop){if(n&&s.loopPreventsSlide)return!1;i.loopFix(),i._clientLeft=i.$wrapperEl[0].clientLeft}function d(e){return e<0?-Math.floor(Math.abs(e)):Math.floor(e)}var c,u=d(l?i.translate:-i.translate),h=r.map((function(e){return d(e)})),p=(r[h.indexOf(u)],r[h.indexOf(u)-1]);return void 0===p&&s.cssMode&&r.forEach((function(e){!p&&u>=e&&(p=e)})),void 0!==p&&(c=o.indexOf(p))<0&&(c=i.activeIndex-1),i.slideTo(c,e,t,a)},slideReset:function(e,t,a){return void 0===e&&(e=this.params.speed),void 0===t&&(t=!0),this.slideTo(this.activeIndex,e,t,a)},slideToClosest:function(e,t,a,i){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0),void 0===i&&(i=.5);var s=this,n=s.activeIndex,r=Math.min(s.params.slidesPerGroupSkip,n),o=r+Math.floor((n-r)/s.params.slidesPerGroup),l=s.rtlTranslate?s.translate:-s.translate;if(l>=s.snapGrid[o]){var d=s.snapGrid[o];l-d>(s.snapGrid[o+1]-d)*i&&(n+=s.params.slidesPerGroup)}else{var c=s.snapGrid[o-1];l-c<=(s.snapGrid[o]-c)*i&&(n-=s.params.slidesPerGroup)}return n=Math.max(n,0),n=Math.min(n,s.slidesGrid.length-1),s.slideTo(n,e,t,a)},slideToClickedSlide:function(){var e,t=this,a=t.params,i=t.$wrapperEl,s="auto"===a.slidesPerView?t.slidesPerViewDynamic():a.slidesPerView,n=t.clickedIndex;if(a.loop){if(t.animating)return;e=parseInt(ke(t.clickedSlide).attr("data-swiper-slide-index"),10),a.centeredSlides?n<t.loopedSlides-s/2||n>t.slides.length-t.loopedSlides+s/2?(t.loopFix(),n=i.children("."+a.slideClass+'[data-swiper-slide-index="'+e+'"]:not(.'+a.slideDuplicateClass+")").eq(0).index(),Ee((function(){t.slideTo(n)}))):t.slideTo(n):n>t.slides.length-s?(t.loopFix(),n=i.children("."+a.slideClass+'[data-swiper-slide-index="'+e+'"]:not(.'+a.slideDuplicateClass+")").eq(0).index(),Ee((function(){t.slideTo(n)}))):t.slideTo(n)}else t.slideTo(n)}},loop:{loopCreate:function(){var e=this,t=ue(),a=e.params,i=e.$wrapperEl;i.children("."+a.slideClass+"."+a.slideDuplicateClass).remove();var s=i.children("."+a.slideClass);if(a.loopFillGroupWithBlank){var n=a.slidesPerGroup-s.length%a.slidesPerGroup;if(n!==a.slidesPerGroup){for(var r=0;r<n;r+=1){var o=ke(t.createElement("div")).addClass(a.slideClass+" "+a.slideBlankClass);i.append(o)}s=i.children("."+a.slideClass)}}"auto"!==a.slidesPerView||a.loopedSlides||(a.loopedSlides=s.length),e.loopedSlides=Math.ceil(parseFloat(a.loopedSlides||a.slidesPerView,10)),e.loopedSlides+=a.loopAdditionalSlides,e.loopedSlides>s.length&&(e.loopedSlides=s.length);var l=[],d=[];s.each((function(t,a){var i=ke(t);a<e.loopedSlides&&d.push(t),a<s.length&&a>=s.length-e.loopedSlides&&l.push(t),i.attr("data-swiper-slide-index",a)}));for(var c=0;c<d.length;c+=1)i.append(ke(d[c].cloneNode(!0)).addClass(a.slideDuplicateClass));for(var u=l.length-1;u>=0;u-=1)i.prepend(ke(l[u].cloneNode(!0)).addClass(a.slideDuplicateClass))},loopFix:function(){var e=this;e.emit("beforeLoopFix");var t,a=e.activeIndex,i=e.slides,s=e.loopedSlides,n=e.allowSlidePrev,r=e.allowSlideNext,o=e.snapGrid,l=e.rtlTranslate;e.allowSlidePrev=!0,e.allowSlideNext=!0;var d=-o[a]-e.getTranslate();a<s?(t=i.length-3*s+a,t+=s,e.slideTo(t,0,!1,!0)&&0!==d&&e.setTranslate((l?-e.translate:e.translate)-d)):a>=i.length-s&&(t=-i.length+a+s,t+=s,e.slideTo(t,0,!1,!0)&&0!==d&&e.setTranslate((l?-e.translate:e.translate)-d)),e.allowSlidePrev=n,e.allowSlideNext=r,e.emit("loopFix")},loopDestroy:function(){var e=this,t=e.$wrapperEl,a=e.params,i=e.slides;t.children("."+a.slideClass+"."+a.slideDuplicateClass+",."+a.slideClass+"."+a.slideBlankClass).remove(),i.removeAttr("data-swiper-slide-index")}},grabCursor:{setGrabCursor:function(e){var t=this;if(!(t.support.touch||!t.params.simulateTouch||t.params.watchOverflow&&t.isLocked||t.params.cssMode)){var a=t.el;a.style.cursor="move",a.style.cursor=e?"-webkit-grabbing":"-webkit-grab",a.style.cursor=e?"-moz-grabbin":"-moz-grab",a.style.cursor=e?"grabbing":"grab"}},unsetGrabCursor:function(){var e=this;e.support.touch||e.params.watchOverflow&&e.isLocked||e.params.cssMode||(e.el.style.cursor="")}},manipulation:{appendSlide:function(e){var t=this,a=t.$wrapperEl,i=t.params;if(i.loop&&t.loopDestroy(),"object"==typeof e&&"length"in e)for(var s=0;s<e.length;s+=1)e[s]&&a.append(e[s]);else a.append(e);i.loop&&t.loopCreate(),i.observer&&t.support.observer||t.update()},prependSlide:function(e){var t=this,a=t.params,i=t.$wrapperEl,s=t.activeIndex;a.loop&&t.loopDestroy();var n=s+1;if("object"==typeof e&&"length"in e){for(var r=0;r<e.length;r+=1)e[r]&&i.prepend(e[r]);n=s+e.length}else i.prepend(e);a.loop&&t.loopCreate(),a.observer&&t.support.observer||t.update(),t.slideTo(n,0,!1)},addSlide:function(e,t){var a=this,i=a.$wrapperEl,s=a.params,n=a.activeIndex;s.loop&&(n-=a.loopedSlides,a.loopDestroy(),a.slides=i.children("."+s.slideClass));var r=a.slides.length;if(e<=0)a.prependSlide(t);else if(e>=r)a.appendSlide(t);else{for(var o=n>e?n+1:n,l=[],d=r-1;d>=e;d-=1){var c=a.slides.eq(d);c.remove(),l.unshift(c)}if("object"==typeof t&&"length"in t){for(var u=0;u<t.length;u+=1)t[u]&&i.append(t[u]);o=n>e?n+t.length:n}else i.append(t);for(var h=0;h<l.length;h+=1)i.append(l[h]);s.loop&&a.loopCreate(),s.observer&&a.support.observer||a.update(),s.loop?a.slideTo(o+a.loopedSlides,0,!1):a.slideTo(o,0,!1)}},removeSlide:function(e){var t=this,a=t.params,i=t.$wrapperEl,s=t.activeIndex;a.loop&&(s-=t.loopedSlides,t.loopDestroy(),t.slides=i.children("."+a.slideClass));var n,r=s;if("object"==typeof e&&"length"in e){for(var o=0;o<e.length;o+=1)n=e[o],t.slides[n]&&t.slides.eq(n).remove(),n<r&&(r-=1);r=Math.max(r,0)}else n=e,t.slides[n]&&t.slides.eq(n).remove(),n<r&&(r-=1),r=Math.max(r,0);a.loop&&t.loopCreate(),a.observer&&t.support.observer||t.update(),a.loop?t.slideTo(r+t.loopedSlides,0,!1):t.slideTo(r,0,!1)},removeAllSlides:function(){for(var e=[],t=0;t<this.slides.length;t+=1)e.push(t);this.removeSlide(e)}},events:{attachEvents:function(){var e=this,t=ue(),a=e.params,i=e.touchEvents,s=e.el,n=e.wrapperEl,r=e.device,o=e.support;e.onTouchStart=je.bind(e),e.onTouchMove=qe.bind(e),e.onTouchEnd=Re.bind(e),a.cssMode&&(e.onScroll=Ge.bind(e)),e.onClick=Ne.bind(e);var l=!!a.nested;if(!o.touch&&o.pointerEvents)s.addEventListener(i.start,e.onTouchStart,!1),t.addEventListener(i.move,e.onTouchMove,l),t.addEventListener(i.end,e.onTouchEnd,!1);else{if(o.touch){var d=!("touchstart"!==i.start||!o.passiveListener||!a.passiveListeners)&&{passive:!0,capture:!1};s.addEventListener(i.start,e.onTouchStart,d),s.addEventListener(i.move,e.onTouchMove,o.passiveListener?{passive:!1,capture:l}:l),s.addEventListener(i.end,e.onTouchEnd,d),i.cancel&&s.addEventListener(i.cancel,e.onTouchEnd,d),We||(t.addEventListener("touchstart",Ve),We=!0)}(a.simulateTouch&&!r.ios&&!r.android||a.simulateTouch&&!o.touch&&r.ios)&&(s.addEventListener("mousedown",e.onTouchStart,!1),t.addEventListener("mousemove",e.onTouchMove,l),t.addEventListener("mouseup",e.onTouchEnd,!1))}(a.preventClicks||a.preventClicksPropagation)&&s.addEventListener("click",e.onClick,!0),a.cssMode&&n.addEventListener("scroll",e.onScroll),a.updateOnWindowResize?e.on(r.ios||r.android?"resize orientationchange observerUpdate":"resize observerUpdate",Fe,!0):e.on("observerUpdate",Fe,!0)},detachEvents:function(){var e=this,t=ue(),a=e.params,i=e.touchEvents,s=e.el,n=e.wrapperEl,r=e.device,o=e.support,l=!!a.nested;if(!o.touch&&o.pointerEvents)s.removeEventListener(i.start,e.onTouchStart,!1),t.removeEventListener(i.move,e.onTouchMove,l),t.removeEventListener(i.end,e.onTouchEnd,!1);else{if(o.touch){var d=!("onTouchStart"!==i.start||!o.passiveListener||!a.passiveListeners)&&{passive:!0,capture:!1};s.removeEventListener(i.start,e.onTouchStart,d),s.removeEventListener(i.move,e.onTouchMove,l),s.removeEventListener(i.end,e.onTouchEnd,d),i.cancel&&s.removeEventListener(i.cancel,e.onTouchEnd,d)}(a.simulateTouch&&!r.ios&&!r.android||a.simulateTouch&&!o.touch&&r.ios)&&(s.removeEventListener("mousedown",e.onTouchStart,!1),t.removeEventListener("mousemove",e.onTouchMove,l),t.removeEventListener("mouseup",e.onTouchEnd,!1))}(a.preventClicks||a.preventClicksPropagation)&&s.removeEventListener("click",e.onClick,!0),a.cssMode&&n.removeEventListener("scroll",e.onScroll),e.off(r.ios||r.android?"resize orientationchange observerUpdate":"resize observerUpdate",Fe)}},breakpoints:{setBreakpoint:function(){var e=this,t=e.activeIndex,a=e.initialized,i=e.loopedSlides,s=void 0===i?0:i,n=e.params,r=e.$el,o=n.breakpoints;if(o&&(!o||0!==Object.keys(o).length)){var l=e.getBreakpoint(o);if(l&&e.currentBreakpoint!==l){var d=l in o?o[l]:void 0;d&&["slidesPerView","spaceBetween","slidesPerGroup","slidesPerGroupSkip","slidesPerColumn"].forEach((function(e){var t=d[e];void 0!==t&&(d[e]="slidesPerView"!==e||"AUTO"!==t&&"auto"!==t?"slidesPerView"===e?parseFloat(t):parseInt(t,10):"auto")}));var c=d||e.originalParams,u=n.slidesPerColumn>1,h=c.slidesPerColumn>1;u&&!h?(r.removeClass(n.containerModifierClass+"multirow "+n.containerModifierClass+"multirow-column"),e.emitContainerClasses()):!u&&h&&(r.addClass(n.containerModifierClass+"multirow"),"column"===c.slidesPerColumnFill&&r.addClass(n.containerModifierClass+"multirow-column"),e.emitContainerClasses());var p=c.direction&&c.direction!==n.direction,m=n.loop&&(c.slidesPerView!==n.slidesPerView||p);p&&a&&e.changeDirection(),Me(e.params,c),Me(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),e.currentBreakpoint=l,e.emit("_beforeBreakpoint",c),m&&a&&(e.loopDestroy(),e.loopCreate(),e.updateSlides(),e.slideTo(t-s+e.loopedSlides,0,!1)),e.emit("breakpoint",c)}}},getBreakpoint:function(e){var t=pe();if(e){var a=!1,i=Object.keys(e).map((function(e){if("string"==typeof e&&0===e.indexOf("@")){var a=parseFloat(e.substr(1));return{value:t.innerHeight*a,point:e}}return{value:e,point:e}}));i.sort((function(e,t){return parseInt(e.value,10)-parseInt(t.value,10)}));for(var s=0;s<i.length;s+=1){var n=i[s],r=n.point;n.value<=t.innerWidth&&(a=r)}return a||"max"}}},checkOverflow:{checkOverflow:function(){var e=this,t=e.params,a=e.isLocked,i=e.slides.length>0&&t.slidesOffsetBefore+t.spaceBetween*(e.slides.length-1)+e.slides[0].offsetWidth*e.slides.length;t.slidesOffsetBefore&&t.slidesOffsetAfter&&i?e.isLocked=i<=e.size:e.isLocked=1===e.snapGrid.length,e.allowSlideNext=!e.isLocked,e.allowSlidePrev=!e.isLocked,a!==e.isLocked&&e.emit(e.isLocked?"lock":"unlock"),a&&a!==e.isLocked&&(e.isEnd=!1,e.navigation&&e.navigation.update())}},classes:{addClasses:function(){var e=this,t=e.classNames,a=e.params,i=e.rtl,s=e.$el,n=e.device,r=[];r.push("initialized"),r.push(a.direction),a.freeMode&&r.push("free-mode"),a.autoHeight&&r.push("autoheight"),i&&r.push("rtl"),a.slidesPerColumn>1&&(r.push("multirow"),"column"===a.slidesPerColumnFill&&r.push("multirow-column")),n.android&&r.push("android"),n.ios&&r.push("ios"),a.cssMode&&r.push("css-mode"),r.forEach((function(e){t.push(a.containerModifierClass+e)})),s.addClass(t.join(" ")),e.emitContainerClasses()},removeClasses:function(){var e=this,t=e.$el,a=e.classNames;t.removeClass(a.join(" ")),e.emitContainerClasses()}},images:{loadImage:function(e,t,a,i,s,n){var r,o=pe();function l(){n&&n()}ke(e).parent("picture")[0]||e.complete&&s?l():t?((r=new o.Image).onload=l,r.onerror=l,i&&(r.sizes=i),a&&(r.srcset=a),t&&(r.src=t)):l()},preloadImages:function(){var e=this;function t(){null!=e&&e&&!e.destroyed&&(void 0!==e.imagesLoaded&&(e.imagesLoaded+=1),e.imagesLoaded===e.imagesToLoad.length&&(e.params.updateOnImagesReady&&e.update(),e.emit("imagesReady")))}e.imagesToLoad=e.$el.find("img");for(var a=0;a<e.imagesToLoad.length;a+=1){var i=e.imagesToLoad[a];e.loadImage(i,i.currentSrc||i.getAttribute("src"),i.srcset||i.getAttribute("srcset"),i.sizes||i.getAttribute("sizes"),!0,t)}}}},Ye={},Ue=function(){function e(){for(var t,a,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];1===s.length&&s[0].constructor&&s[0].constructor===Object?a=s[0]:(t=s[0],a=s[1]),a||(a={}),a=Me({},a),t&&!a.el&&(a.el=t);var r=this;r.support=Oe(),r.device=$e({userAgent:a.userAgent}),r.browser=Be(),r.eventsListeners={},r.eventsAnyListeners=[],void 0===r.modules&&(r.modules={}),Object.keys(r.modules).forEach((function(e){var t=r.modules[e];if(t.params){var i=Object.keys(t.params)[0],s=t.params[i];if("object"!=typeof s||null===s)return;if(!(i in a)||!("enabled"in s))return;!0===a[i]&&(a[i]={enabled:!0}),"object"!=typeof a[i]||"enabled"in a[i]||(a[i].enabled=!0),a[i]||(a[i]={enabled:!1})}}));var o=Me({},Qe);r.useParams(o),r.params=Me({},o,Ye,a),r.originalParams=Me({},r.params),r.passedParams=Me({},a),r.params&&r.params.on&&Object.keys(r.params.on).forEach((function(e){r.on(e,r.params.on[e])})),r.params&&r.params.onAny&&r.onAny(r.params.onAny),r.$=ke;var l=ke(r.params.el);if(t=l[0]){if(l.length>1){var d=[];return l.each((function(t){var i=Me({},a,{el:t});d.push(new e(i))})),d}var c,u,h;return t.swiper=r,t&&t.shadowRoot&&t.shadowRoot.querySelector?(c=ke(t.shadowRoot.querySelector("."+r.params.wrapperClass))).children=function(e){return l.children(e)}:c=l.children("."+r.params.wrapperClass),Me(r,{$el:l,el:t,$wrapperEl:c,wrapperEl:c[0],classNames:[],slides:ke(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:function(){return"horizontal"===r.params.direction},isVertical:function(){return"vertical"===r.params.direction},rtl:"rtl"===t.dir.toLowerCase()||"rtl"===l.css("direction"),rtlTranslate:"horizontal"===r.params.direction&&("rtl"===t.dir.toLowerCase()||"rtl"===l.css("direction")),wrongRTL:"-webkit-box"===c.css("display"),activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:r.params.allowSlideNext,allowSlidePrev:r.params.allowSlidePrev,touchEvents:(u=["touchstart","touchmove","touchend","touchcancel"],h=["mousedown","mousemove","mouseup"],r.support.pointerEvents&&(h=["pointerdown","pointermove","pointerup"]),r.touchEventsTouch={start:u[0],move:u[1],end:u[2],cancel:u[3]},r.touchEventsDesktop={start:h[0],move:h[1],end:h[2]},r.support.touch||!r.params.simulateTouch?r.touchEventsTouch:r.touchEventsDesktop),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,formElements:"input, select, option, textarea, button, video, label",lastClickTime:Pe(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:r.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),r.useModules(),r.emit("_swiper"),r.params.init&&r.init(),r}}var t,a,i=e.prototype;return i.emitContainerClasses=function(){var e=this;if(e.params._emitClasses&&e.el){var t=e.el.className.split(" ").filter((function(t){return 0===t.indexOf("swiper-container")||0===t.indexOf(e.params.containerModifierClass)}));e.emit("_containerClasses",t.join(" "))}},i.getSlideClasses=function(e){var t=this;return e.className.split(" ").filter((function(e){return 0===e.indexOf("swiper-slide")||0===e.indexOf(t.params.slideClass)})).join(" ")},i.emitSlidesClasses=function(){var e=this;e.params._emitClasses&&e.el&&e.slides.each((function(t){var a=e.getSlideClasses(t);e.emit("_slideClass",t,a)}))},i.slidesPerViewDynamic=function(){var e=this,t=e.params,a=e.slides,i=e.slidesGrid,s=e.size,n=e.activeIndex,r=1;if(t.centeredSlides){for(var o,l=a[n].swiperSlideSize,d=n+1;d<a.length;d+=1)a[d]&&!o&&(r+=1,(l+=a[d].swiperSlideSize)>s&&(o=!0));for(var c=n-1;c>=0;c-=1)a[c]&&!o&&(r+=1,(l+=a[c].swiperSlideSize)>s&&(o=!0))}else for(var u=n+1;u<a.length;u+=1)i[u]-i[n]<s&&(r+=1);return r},i.update=function(){var e=this;if(e&&!e.destroyed){var t=e.snapGrid,a=e.params;a.breakpoints&&e.setBreakpoint(),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.params.freeMode?(i(),e.params.autoHeight&&e.updateAutoHeight()):(("auto"===e.params.slidesPerView||e.params.slidesPerView>1)&&e.isEnd&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0))||i(),a.watchOverflow&&t!==e.snapGrid&&e.checkOverflow(),e.emit("update")}function i(){var t=e.rtlTranslate?-1*e.translate:e.translate,a=Math.min(Math.max(t,e.maxTranslate()),e.minTranslate());e.setTranslate(a),e.updateActiveIndex(),e.updateSlidesClasses()}},i.changeDirection=function(e,t){void 0===t&&(t=!0);var a=this,i=a.params.direction;return e||(e="horizontal"===i?"vertical":"horizontal"),e===i||"horizontal"!==e&&"vertical"!==e||(a.$el.removeClass(""+a.params.containerModifierClass+i).addClass(""+a.params.containerModifierClass+e),a.emitContainerClasses(),a.params.direction=e,a.slides.each((function(t){"vertical"===e?t.style.width="":t.style.height=""})),a.emit("changeDirection"),t&&a.update()),a},i.init=function(){var e=this;e.initialized||(e.emit("beforeInit"),e.params.breakpoints&&e.setBreakpoint(),e.addClasses(),e.params.loop&&e.loopCreate(),e.updateSize(),e.updateSlides(),e.params.watchOverflow&&e.checkOverflow(),e.params.grabCursor&&e.setGrabCursor(),e.params.preloadImages&&e.preloadImages(),e.params.loop?e.slideTo(e.params.initialSlide+e.loopedSlides,0,e.params.runCallbacksOnInit):e.slideTo(e.params.initialSlide,0,e.params.runCallbacksOnInit),e.attachEvents(),e.initialized=!0,e.emit("init"),e.emit("afterInit"))},i.destroy=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var a,i=this,s=i.params,n=i.$el,r=i.$wrapperEl,o=i.slides;return void 0===i.params||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),s.loop&&i.loopDestroy(),t&&(i.removeClasses(),n.removeAttr("style"),r.removeAttr("style"),o&&o.length&&o.removeClass([s.slideVisibleClass,s.slideActiveClass,s.slideNextClass,s.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),i.emit("destroy"),Object.keys(i.eventsListeners).forEach((function(e){i.off(e)})),!1!==e&&(i.$el[0].swiper=null,a=i,Object.keys(a).forEach((function(e){try{a[e]=null}catch(e){}try{delete a[e]}catch(e){}}))),i.destroyed=!0),null},e.extendDefaults=function(e){Me(Ye,e)},e.installModule=function(t){e.prototype.modules||(e.prototype.modules={});var a=t.name||Object.keys(e.prototype.modules).length+"_"+Pe();e.prototype.modules[a]=t},e.use=function(t){return Array.isArray(t)?(t.forEach((function(t){return e.installModule(t)})),e):(e.installModule(t),e)},t=e,a=[{key:"extendedDefaults",get:function(){return Ye}},{key:"defaults",get:function(){return Qe}}],null&&re(t.prototype,null),a&&re(t,a),e}();Object.keys(Xe).forEach((function(e){Object.keys(Xe[e]).forEach((function(t){Ue.prototype[t]=Xe[e][t]}))})),Ue.use([He,De]);var Ke={update:function(e){var t=this,a=t.params,i=a.slidesPerView,s=a.slidesPerGroup,n=a.centeredSlides,r=t.params.virtual,o=r.addSlidesBefore,l=r.addSlidesAfter,d=t.virtual,c=d.from,u=d.to,h=d.slides,p=d.slidesGrid,m=d.renderSlide,f=d.offset;t.updateActiveIndex();var g,v,y,b=t.activeIndex||0;g=t.rtlTranslate?"right":t.isHorizontal()?"left":"top",n?(v=Math.floor(i/2)+s+l,y=Math.floor(i/2)+s+o):(v=i+(s-1)+l,y=s+o);var w=Math.max((b||0)-y,0),_=Math.min((b||0)+v,h.length-1),k=(t.slidesGrid[w]||0)-(t.slidesGrid[0]||0);function C(){t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),t.lazy&&t.params.lazy.enabled&&t.lazy.load()}if(Me(t.virtual,{from:w,to:_,offset:k,slidesGrid:t.slidesGrid}),c===w&&u===_&&!e)return t.slidesGrid!==p&&k!==f&&t.slides.css(g,k+"px"),void t.updateProgress();if(t.params.virtual.renderExternal)return t.params.virtual.renderExternal.call(t,{offset:k,from:w,to:_,slides:function(){for(var e=[],t=w;t<=_;t+=1)e.push(h[t]);return e}()}),void(t.params.virtual.renderExternalUpdate&&C());var x=[],S=[];if(e)t.$wrapperEl.find("."+t.params.slideClass).remove();else for(var T=c;T<=u;T+=1)(T<w||T>_)&&t.$wrapperEl.find("."+t.params.slideClass+'[data-swiper-slide-index="'+T+'"]').remove();for(var E=0;E<h.length;E+=1)E>=w&&E<=_&&(void 0===u||e?S.push(E):(E>u&&S.push(E),E<c&&x.push(E)));S.forEach((function(e){t.$wrapperEl.append(m(h[e],e))})),x.sort((function(e,t){return t-e})).forEach((function(e){t.$wrapperEl.prepend(m(h[e],e))})),t.$wrapperEl.children(".swiper-slide").css(g,k+"px"),C()},renderSlide:function(e,t){var a=this,i=a.params.virtual;if(i.cache&&a.virtual.cache[t])return a.virtual.cache[t];var s=i.renderSlide?ke(i.renderSlide.call(a,e,t)):ke('<div class="'+a.params.slideClass+'" data-swiper-slide-index="'+t+'">'+e+"</div>");return s.attr("data-swiper-slide-index")||s.attr("data-swiper-slide-index",t),i.cache&&(a.virtual.cache[t]=s),s},appendSlide:function(e){var t=this;if("object"==typeof e&&"length"in e)for(var a=0;a<e.length;a+=1)e[a]&&t.virtual.slides.push(e[a]);else t.virtual.slides.push(e);t.virtual.update(!0)},prependSlide:function(e){var t=this,a=t.activeIndex,i=a+1,s=1;if(Array.isArray(e)){for(var n=0;n<e.length;n+=1)e[n]&&t.virtual.slides.unshift(e[n]);i=a+e.length,s=e.length}else t.virtual.slides.unshift(e);if(t.params.virtual.cache){var r=t.virtual.cache,o={};Object.keys(r).forEach((function(e){var t=r[e],a=t.attr("data-swiper-slide-index");a&&t.attr("data-swiper-slide-index",parseInt(a,10)+1),o[parseInt(e,10)+s]=t})),t.virtual.cache=o}t.virtual.update(!0),t.slideTo(i,0)},removeSlide:function(e){var t=this;if(null!=e){var a=t.activeIndex;if(Array.isArray(e))for(var i=e.length-1;i>=0;i-=1)t.virtual.slides.splice(e[i],1),t.params.virtual.cache&&delete t.virtual.cache[e[i]],e[i]<a&&(a-=1),a=Math.max(a,0);else t.virtual.slides.splice(e,1),t.params.virtual.cache&&delete t.virtual.cache[e],e<a&&(a-=1),a=Math.max(a,0);t.virtual.update(!0),t.slideTo(a,0)}},removeAllSlides:function(){var e=this;e.virtual.slides=[],e.params.virtual.cache&&(e.virtual.cache={}),e.virtual.update(!0),e.slideTo(0,0)}},Je={name:"virtual",params:{virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}},create:function(){Ie(this,{virtual:oe(oe({},Ke),{},{slides:this.params.virtual.slides,cache:{}})})},on:{beforeInit:function(e){if(e.params.virtual.enabled){e.classNames.push(e.params.containerModifierClass+"virtual");var t={watchSlidesProgress:!0};Me(e.params,t),Me(e.originalParams,t),e.params.initialSlide||e.virtual.update()}},setTranslate:function(e){e.params.virtual.enabled&&e.virtual.update()}}},Ze={handle:function(e){var t=this,a=pe(),i=ue(),s=t.rtlTranslate,n=e;n.originalEvent&&(n=n.originalEvent);var r=n.keyCode||n.charCode,o=t.params.keyboard.pageUpDown,l=o&&33===r,d=o&&34===r,c=37===r,u=39===r,h=38===r,p=40===r;if(!t.allowSlideNext&&(t.isHorizontal()&&u||t.isVertical()&&p||d))return!1;if(!t.allowSlidePrev&&(t.isHorizontal()&&c||t.isVertical()&&h||l))return!1;if(!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey||i.activeElement&&i.activeElement.nodeName&&("input"===i.activeElement.nodeName.toLowerCase()||"textarea"===i.activeElement.nodeName.toLowerCase()))){if(t.params.keyboard.onlyInViewport&&(l||d||c||u||h||p)){var m=!1;if(t.$el.parents("."+t.params.slideClass).length>0&&0===t.$el.parents("."+t.params.slideActiveClass).length)return;var f=a.innerWidth,g=a.innerHeight,v=t.$el.offset();s&&(v.left-=t.$el[0].scrollLeft);for(var y=[[v.left,v.top],[v.left+t.width,v.top],[v.left,v.top+t.height],[v.left+t.width,v.top+t.height]],b=0;b<y.length;b+=1){var w=y[b];w[0]>=0&&w[0]<=f&&w[1]>=0&&w[1]<=g&&(m=!0)}if(!m)return}t.isHorizontal()?((l||d||c||u)&&(n.preventDefault?n.preventDefault():n.returnValue=!1),((d||u)&&!s||(l||c)&&s)&&t.slideNext(),((l||c)&&!s||(d||u)&&s)&&t.slidePrev()):((l||d||h||p)&&(n.preventDefault?n.preventDefault():n.returnValue=!1),(d||p)&&t.slideNext(),(l||h)&&t.slidePrev()),t.emit("keyPress",r)}},enable:function(){var e=this,t=ue();e.keyboard.enabled||(ke(t).on("keydown",e.keyboard.handle),e.keyboard.enabled=!0)},disable:function(){var e=this,t=ue();e.keyboard.enabled&&(ke(t).off("keydown",e.keyboard.handle),e.keyboard.enabled=!1)}},et={name:"keyboard",params:{keyboard:{enabled:!1,onlyInViewport:!0,pageUpDown:!0}},create:function(){Ie(this,{keyboard:oe({enabled:!1},Ze)})},on:{init:function(e){e.params.keyboard.enabled&&e.keyboard.enable()},destroy:function(e){e.keyboard.enabled&&e.keyboard.disable()}}},tt={lastScrollTime:Pe(),lastEventBeforeSnap:void 0,recentWheelEvents:[],event:function(){return pe().navigator.userAgent.indexOf("firefox")>-1?"DOMMouseScroll":function(){var e=ue(),t="onwheel",a=t in e;if(!a){var i=e.createElement("div");i.setAttribute(t,"return;"),a="function"==typeof i.onwheel}return!a&&e.implementation&&e.implementation.hasFeature&&!0!==e.implementation.hasFeature("","")&&(a=e.implementation.hasFeature("Events.wheel","3.0")),a}()?"wheel":"mousewheel"},normalize:function(e){var t=0,a=0,i=0,s=0;return"detail"in e&&(a=e.detail),"wheelDelta"in e&&(a=-e.wheelDelta/120),"wheelDeltaY"in e&&(a=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=a,a=0),i=10*t,s=10*a,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(i=e.deltaX),e.shiftKey&&!i&&(i=s,s=0),(i||s)&&e.deltaMode&&(1===e.deltaMode?(i*=40,s*=40):(i*=800,s*=800)),i&&!t&&(t=i<1?-1:1),s&&!a&&(a=s<1?-1:1),{spinX:t,spinY:a,pixelX:i,pixelY:s}},handleMouseEnter:function(){this.mouseEntered=!0},handleMouseLeave:function(){this.mouseEntered=!1},handle:function(e){var t=e,a=this,i=a.params.mousewheel;a.params.cssMode&&t.preventDefault();var s=a.$el;if("container"!==a.params.mousewheel.eventsTarget&&(s=ke(a.params.mousewheel.eventsTarget)),!a.mouseEntered&&!s[0].contains(t.target)&&!i.releaseOnEdges)return!0;t.originalEvent&&(t=t.originalEvent);var n=0,r=a.rtlTranslate?-1:1,o=tt.normalize(t);if(i.forceToAxis)if(a.isHorizontal()){if(!(Math.abs(o.pixelX)>Math.abs(o.pixelY)))return!0;n=-o.pixelX*r}else{if(!(Math.abs(o.pixelY)>Math.abs(o.pixelX)))return!0;n=-o.pixelY}else n=Math.abs(o.pixelX)>Math.abs(o.pixelY)?-o.pixelX*r:-o.pixelY;if(0===n)return!0;if(i.invert&&(n=-n),a.params.freeMode){var l={time:Pe(),delta:Math.abs(n),direction:Math.sign(n)},d=a.mousewheel.lastEventBeforeSnap,c=d&&l.time<d.time+500&&l.delta<=d.delta&&l.direction===d.direction;if(!c){a.mousewheel.lastEventBeforeSnap=void 0,a.params.loop&&a.loopFix();var u=a.getTranslate()+n*i.sensitivity,h=a.isBeginning,p=a.isEnd;if(u>=a.minTranslate()&&(u=a.minTranslate()),u<=a.maxTranslate()&&(u=a.maxTranslate()),a.setTransition(0),a.setTranslate(u),a.updateProgress(),a.updateActiveIndex(),a.updateSlidesClasses(),(!h&&a.isBeginning||!p&&a.isEnd)&&a.updateSlidesClasses(),a.params.freeModeSticky){clearTimeout(a.mousewheel.timeout),a.mousewheel.timeout=void 0;var m=a.mousewheel.recentWheelEvents;m.length>=15&&m.shift();var f=m.length?m[m.length-1]:void 0,g=m[0];if(m.push(l),f&&(l.delta>f.delta||l.direction!==f.direction))m.splice(0);else if(m.length>=15&&l.time-g.time<500&&g.delta-l.delta>=1&&l.delta<=6){var v=n>0?.8:.2;a.mousewheel.lastEventBeforeSnap=l,m.splice(0),a.mousewheel.timeout=Ee((function(){a.slideToClosest(a.params.speed,!0,void 0,v)}),0)}a.mousewheel.timeout||(a.mousewheel.timeout=Ee((function(){a.mousewheel.lastEventBeforeSnap=l,m.splice(0),a.slideToClosest(a.params.speed,!0,void 0,.5)}),500))}if(c||a.emit("scroll",t),a.params.autoplay&&a.params.autoplayDisableOnInteraction&&a.autoplay.stop(),u===a.minTranslate()||u===a.maxTranslate())return!0}}else{var y={time:Pe(),delta:Math.abs(n),direction:Math.sign(n),raw:e},b=a.mousewheel.recentWheelEvents;b.length>=2&&b.shift();var w=b.length?b[b.length-1]:void 0;if(b.push(y),w?(y.direction!==w.direction||y.delta>w.delta||y.time>w.time+150)&&a.mousewheel.animateSlider(y):a.mousewheel.animateSlider(y),a.mousewheel.releaseScroll(y))return!0}return t.preventDefault?t.preventDefault():t.returnValue=!1,!1},animateSlider:function(e){var t=this,a=pe();return!(this.params.mousewheel.thresholdDelta&&e.delta<this.params.mousewheel.thresholdDelta||this.params.mousewheel.thresholdTime&&Pe()-t.mousewheel.lastScrollTime<this.params.mousewheel.thresholdTime||!(e.delta>=6&&Pe()-t.mousewheel.lastScrollTime<60)&&(e.direction<0?t.isEnd&&!t.params.loop||t.animating||(t.slideNext(),t.emit("scroll",e.raw)):t.isBeginning&&!t.params.loop||t.animating||(t.slidePrev(),t.emit("scroll",e.raw)),t.mousewheel.lastScrollTime=(new a.Date).getTime(),1))},releaseScroll:function(e){var t=this,a=t.params.mousewheel;if(e.direction<0){if(t.isEnd&&!t.params.loop&&a.releaseOnEdges)return!0}else if(t.isBeginning&&!t.params.loop&&a.releaseOnEdges)return!0;return!1},enable:function(){var e=this,t=tt.event();if(e.params.cssMode)return e.wrapperEl.removeEventListener(t,e.mousewheel.handle),!0;if(!t)return!1;if(e.mousewheel.enabled)return!1;var a=e.$el;return"container"!==e.params.mousewheel.eventsTarget&&(a=ke(e.params.mousewheel.eventsTarget)),a.on("mouseenter",e.mousewheel.handleMouseEnter),a.on("mouseleave",e.mousewheel.handleMouseLeave),a.on(t,e.mousewheel.handle),e.mousewheel.enabled=!0,!0},disable:function(){var e=this,t=tt.event();if(e.params.cssMode)return e.wrapperEl.addEventListener(t,e.mousewheel.handle),!0;if(!t)return!1;if(!e.mousewheel.enabled)return!1;var a=e.$el;return"container"!==e.params.mousewheel.eventsTarget&&(a=ke(e.params.mousewheel.eventsTarget)),a.off(t,e.mousewheel.handle),e.mousewheel.enabled=!1,!0}},at={update:function(){var e=this,t=e.params.navigation;if(!e.params.loop){var a=e.navigation,i=a.$nextEl,s=a.$prevEl;s&&s.length>0&&(e.isBeginning?s.addClass(t.disabledClass):s.removeClass(t.disabledClass),s[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](t.lockClass)),i&&i.length>0&&(e.isEnd?i.addClass(t.disabledClass):i.removeClass(t.disabledClass),i[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](t.lockClass))}},onPrevClick:function(e){var t=this;e.preventDefault(),t.isBeginning&&!t.params.loop||t.slidePrev()},onNextClick:function(e){var t=this;e.preventDefault(),t.isEnd&&!t.params.loop||t.slideNext()},init:function(){var e,t,a=this,i=a.params.navigation;(i.nextEl||i.prevEl)&&(i.nextEl&&(e=ke(i.nextEl),a.params.uniqueNavElements&&"string"==typeof i.nextEl&&e.length>1&&1===a.$el.find(i.nextEl).length&&(e=a.$el.find(i.nextEl))),i.prevEl&&(t=ke(i.prevEl),a.params.uniqueNavElements&&"string"==typeof i.prevEl&&t.length>1&&1===a.$el.find(i.prevEl).length&&(t=a.$el.find(i.prevEl))),e&&e.length>0&&e.on("click",a.navigation.onNextClick),t&&t.length>0&&t.on("click",a.navigation.onPrevClick),Me(a.navigation,{$nextEl:e,nextEl:e&&e[0],$prevEl:t,prevEl:t&&t[0]}))},destroy:function(){var e=this,t=e.navigation,a=t.$nextEl,i=t.$prevEl;a&&a.length&&(a.off("click",e.navigation.onNextClick),a.removeClass(e.params.navigation.disabledClass)),i&&i.length&&(i.off("click",e.navigation.onPrevClick),i.removeClass(e.params.navigation.disabledClass))}},it={update:function(){var e=this,t=e.rtl,a=e.params.pagination;if(a.el&&e.pagination.el&&e.pagination.$el&&0!==e.pagination.$el.length){var i,s=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,n=e.pagination.$el,r=e.params.loop?Math.ceil((s-2*e.loopedSlides)/e.params.slidesPerGroup):e.snapGrid.length;if(e.params.loop?((i=Math.ceil((e.activeIndex-e.loopedSlides)/e.params.slidesPerGroup))>s-1-2*e.loopedSlides&&(i-=s-2*e.loopedSlides),i>r-1&&(i-=r),i<0&&"bullets"!==e.params.paginationType&&(i=r+i)):i=void 0!==e.snapIndex?e.snapIndex:e.activeIndex||0,"bullets"===a.type&&e.pagination.bullets&&e.pagination.bullets.length>0){var o,l,d,c=e.pagination.bullets;if(a.dynamicBullets&&(e.pagination.bulletSize=c.eq(0)[e.isHorizontal()?"outerWidth":"outerHeight"](!0),n.css(e.isHorizontal()?"width":"height",e.pagination.bulletSize*(a.dynamicMainBullets+4)+"px"),a.dynamicMainBullets>1&&void 0!==e.previousIndex&&(e.pagination.dynamicBulletIndex+=i-e.previousIndex,e.pagination.dynamicBulletIndex>a.dynamicMainBullets-1?e.pagination.dynamicBulletIndex=a.dynamicMainBullets-1:e.pagination.dynamicBulletIndex<0&&(e.pagination.dynamicBulletIndex=0)),o=i-e.pagination.dynamicBulletIndex,d=((l=o+(Math.min(c.length,a.dynamicMainBullets)-1))+o)/2),c.removeClass(a.bulletActiveClass+" "+a.bulletActiveClass+"-next "+a.bulletActiveClass+"-next-next "+a.bulletActiveClass+"-prev "+a.bulletActiveClass+"-prev-prev "+a.bulletActiveClass+"-main"),n.length>1)c.each((function(e){var t=ke(e),s=t.index();s===i&&t.addClass(a.bulletActiveClass),a.dynamicBullets&&(s>=o&&s<=l&&t.addClass(a.bulletActiveClass+"-main"),s===o&&t.prev().addClass(a.bulletActiveClass+"-prev").prev().addClass(a.bulletActiveClass+"-prev-prev"),s===l&&t.next().addClass(a.bulletActiveClass+"-next").next().addClass(a.bulletActiveClass+"-next-next"))}));else{var u=c.eq(i),h=u.index();if(u.addClass(a.bulletActiveClass),a.dynamicBullets){for(var p=c.eq(o),m=c.eq(l),f=o;f<=l;f+=1)c.eq(f).addClass(a.bulletActiveClass+"-main");if(e.params.loop)if(h>=c.length-a.dynamicMainBullets){for(var g=a.dynamicMainBullets;g>=0;g-=1)c.eq(c.length-g).addClass(a.bulletActiveClass+"-main");c.eq(c.length-a.dynamicMainBullets-1).addClass(a.bulletActiveClass+"-prev")}else p.prev().addClass(a.bulletActiveClass+"-prev").prev().addClass(a.bulletActiveClass+"-prev-prev"),m.next().addClass(a.bulletActiveClass+"-next").next().addClass(a.bulletActiveClass+"-next-next");else p.prev().addClass(a.bulletActiveClass+"-prev").prev().addClass(a.bulletActiveClass+"-prev-prev"),m.next().addClass(a.bulletActiveClass+"-next").next().addClass(a.bulletActiveClass+"-next-next")}}if(a.dynamicBullets){var v=Math.min(c.length,a.dynamicMainBullets+4),y=(e.pagination.bulletSize*v-e.pagination.bulletSize)/2-d*e.pagination.bulletSize,b=t?"right":"left";c.css(e.isHorizontal()?b:"top",y+"px")}}if("fraction"===a.type&&(n.find("."+a.currentClass).text(a.formatFractionCurrent(i+1)),n.find("."+a.totalClass).text(a.formatFractionTotal(r))),"progressbar"===a.type){var w;w=a.progressbarOpposite?e.isHorizontal()?"vertical":"horizontal":e.isHorizontal()?"horizontal":"vertical";var _=(i+1)/r,k=1,C=1;"horizontal"===w?k=_:C=_,n.find("."+a.progressbarFillClass).transform("translate3d(0,0,0) scaleX("+k+") scaleY("+C+")").transition(e.params.speed)}"custom"===a.type&&a.renderCustom?(n.html(a.renderCustom(e,i+1,r)),e.emit("paginationRender",n[0])):e.emit("paginationUpdate",n[0]),n[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](a.lockClass)}},render:function(){var e=this,t=e.params.pagination;if(t.el&&e.pagination.el&&e.pagination.$el&&0!==e.pagination.$el.length){var a=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,i=e.pagination.$el,s="";if("bullets"===t.type){for(var n=e.params.loop?Math.ceil((a-2*e.loopedSlides)/e.params.slidesPerGroup):e.snapGrid.length,r=0;r<n;r+=1)t.renderBullet?s+=t.renderBullet.call(e,r,t.bulletClass):s+="<"+t.bulletElement+' class="'+t.bulletClass+'"></'+t.bulletElement+">";i.html(s),e.pagination.bullets=i.find("."+t.bulletClass)}"fraction"===t.type&&(s=t.renderFraction?t.renderFraction.call(e,t.currentClass,t.totalClass):'<span class="'+t.currentClass+'"></span> / <span class="'+t.totalClass+'"></span>',i.html(s)),"progressbar"===t.type&&(s=t.renderProgressbar?t.renderProgressbar.call(e,t.progressbarFillClass):'<span class="'+t.progressbarFillClass+'"></span>',i.html(s)),"custom"!==t.type&&e.emit("paginationRender",e.pagination.$el[0])}},init:function(){var e=this,t=e.params.pagination;if(t.el){var a=ke(t.el);0!==a.length&&(e.params.uniqueNavElements&&"string"==typeof t.el&&a.length>1&&(a=e.$el.find(t.el)),"bullets"===t.type&&t.clickable&&a.addClass(t.clickableClass),a.addClass(t.modifierClass+t.type),"bullets"===t.type&&t.dynamicBullets&&(a.addClass(""+t.modifierClass+t.type+"-dynamic"),e.pagination.dynamicBulletIndex=0,t.dynamicMainBullets<1&&(t.dynamicMainBullets=1)),"progressbar"===t.type&&t.progressbarOpposite&&a.addClass(t.progressbarOppositeClass),t.clickable&&a.on("click","."+t.bulletClass,(function(t){t.preventDefault();var a=ke(this).index()*e.params.slidesPerGroup;e.params.loop&&(a+=e.loopedSlides),e.slideTo(a)})),Me(e.pagination,{$el:a,el:a[0]}))}},destroy:function(){var e=this,t=e.params.pagination;if(t.el&&e.pagination.el&&e.pagination.$el&&0!==e.pagination.$el.length){var a=e.pagination.$el;a.removeClass(t.hiddenClass),a.removeClass(t.modifierClass+t.type),e.pagination.bullets&&e.pagination.bullets.removeClass(t.bulletActiveClass),t.clickable&&a.off("click","."+t.bulletClass)}}},st={setTranslate:function(){var e=this;if(e.params.scrollbar.el&&e.scrollbar.el){var t=e.scrollbar,a=e.rtlTranslate,i=e.progress,s=t.dragSize,n=t.trackSize,r=t.$dragEl,o=t.$el,l=e.params.scrollbar,d=s,c=(n-s)*i;a?(c=-c)>0?(d=s-c,c=0):-c+s>n&&(d=n+c):c<0?(d=s+c,c=0):c+s>n&&(d=n-c),e.isHorizontal()?(r.transform("translate3d("+c+"px, 0, 0)"),r[0].style.width=d+"px"):(r.transform("translate3d(0px, "+c+"px, 0)"),r[0].style.height=d+"px"),l.hide&&(clearTimeout(e.scrollbar.timeout),o[0].style.opacity=1,e.scrollbar.timeout=setTimeout((function(){o[0].style.opacity=0,o.transition(400)}),1e3))}},setTransition:function(e){var t=this;t.params.scrollbar.el&&t.scrollbar.el&&t.scrollbar.$dragEl.transition(e)},updateSize:function(){var e=this;if(e.params.scrollbar.el&&e.scrollbar.el){var t=e.scrollbar,a=t.$dragEl,i=t.$el;a[0].style.width="",a[0].style.height="";var s,n=e.isHorizontal()?i[0].offsetWidth:i[0].offsetHeight,r=e.size/e.virtualSize,o=r*(n/e.size);s="auto"===e.params.scrollbar.dragSize?n*r:parseInt(e.params.scrollbar.dragSize,10),e.isHorizontal()?a[0].style.width=s+"px":a[0].style.height=s+"px",i[0].style.display=r>=1?"none":"",e.params.scrollbar.hide&&(i[0].style.opacity=0),Me(t,{trackSize:n,divider:r,moveDivider:o,dragSize:s}),t.$el[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](e.params.scrollbar.lockClass)}},getPointerPosition:function(e){return this.isHorizontal()?"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].clientX:e.clientX:"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].clientY:e.clientY},setDragPosition:function(e){var t,a=this,i=a.scrollbar,s=a.rtlTranslate,n=i.$el,r=i.dragSize,o=i.trackSize,l=i.dragStartPos;t=(i.getPointerPosition(e)-n.offset()[a.isHorizontal()?"left":"top"]-(null!==l?l:r/2))/(o-r),t=Math.max(Math.min(t,1),0),s&&(t=1-t);var d=a.minTranslate()+(a.maxTranslate()-a.minTranslate())*t;a.updateProgress(d),a.setTranslate(d),a.updateActiveIndex(),a.updateSlidesClasses()},onDragStart:function(e){var t=this,a=t.params.scrollbar,i=t.scrollbar,s=t.$wrapperEl,n=i.$el,r=i.$dragEl;t.scrollbar.isTouched=!0,t.scrollbar.dragStartPos=e.target===r[0]||e.target===r?i.getPointerPosition(e)-e.target.getBoundingClientRect()[t.isHorizontal()?"left":"top"]:null,e.preventDefault(),e.stopPropagation(),s.transition(100),r.transition(100),i.setDragPosition(e),clearTimeout(t.scrollbar.dragTimeout),n.transition(0),a.hide&&n.css("opacity",1),t.params.cssMode&&t.$wrapperEl.css("scroll-snap-type","none"),t.emit("scrollbarDragStart",e)},onDragMove:function(e){var t=this,a=t.scrollbar,i=t.$wrapperEl,s=a.$el,n=a.$dragEl;t.scrollbar.isTouched&&(e.preventDefault?e.preventDefault():e.returnValue=!1,a.setDragPosition(e),i.transition(0),s.transition(0),n.transition(0),t.emit("scrollbarDragMove",e))},onDragEnd:function(e){var t=this,a=t.params.scrollbar,i=t.scrollbar,s=t.$wrapperEl,n=i.$el;t.scrollbar.isTouched&&(t.scrollbar.isTouched=!1,t.params.cssMode&&(t.$wrapperEl.css("scroll-snap-type",""),s.transition("")),a.hide&&(clearTimeout(t.scrollbar.dragTimeout),t.scrollbar.dragTimeout=Ee((function(){n.css("opacity",0),n.transition(400)}),1e3)),t.emit("scrollbarDragEnd",e),a.snapOnRelease&&t.slideToClosest())},enableDraggable:function(){var e=this;if(e.params.scrollbar.el){var t=ue(),a=e.scrollbar,i=e.touchEventsTouch,s=e.touchEventsDesktop,n=e.params,r=e.support,o=a.$el[0],l=!(!r.passiveListener||!n.passiveListeners)&&{passive:!1,capture:!1},d=!(!r.passiveListener||!n.passiveListeners)&&{passive:!0,capture:!1};r.touch?(o.addEventListener(i.start,e.scrollbar.onDragStart,l),o.addEventListener(i.move,e.scrollbar.onDragMove,l),o.addEventListener(i.end,e.scrollbar.onDragEnd,d)):(o.addEventListener(s.start,e.scrollbar.onDragStart,l),t.addEventListener(s.move,e.scrollbar.onDragMove,l),t.addEventListener(s.end,e.scrollbar.onDragEnd,d))}},disableDraggable:function(){var e=this;if(e.params.scrollbar.el){var t=ue(),a=e.scrollbar,i=e.touchEventsTouch,s=e.touchEventsDesktop,n=e.params,r=e.support,o=a.$el[0],l=!(!r.passiveListener||!n.passiveListeners)&&{passive:!1,capture:!1},d=!(!r.passiveListener||!n.passiveListeners)&&{passive:!0,capture:!1};r.touch?(o.removeEventListener(i.start,e.scrollbar.onDragStart,l),o.removeEventListener(i.move,e.scrollbar.onDragMove,l),o.removeEventListener(i.end,e.scrollbar.onDragEnd,d)):(o.removeEventListener(s.start,e.scrollbar.onDragStart,l),t.removeEventListener(s.move,e.scrollbar.onDragMove,l),t.removeEventListener(s.end,e.scrollbar.onDragEnd,d))}},init:function(){var e=this;if(e.params.scrollbar.el){var t=e.scrollbar,a=e.$el,i=e.params.scrollbar,s=ke(i.el);e.params.uniqueNavElements&&"string"==typeof i.el&&s.length>1&&1===a.find(i.el).length&&(s=a.find(i.el));var n=s.find("."+e.params.scrollbar.dragClass);0===n.length&&(n=ke('<div class="'+e.params.scrollbar.dragClass+'"></div>'),s.append(n)),Me(t,{$el:s,el:s[0],$dragEl:n,dragEl:n[0]}),i.draggable&&t.enableDraggable()}},destroy:function(){this.scrollbar.disableDraggable()}},nt={setTransform:function(e,t){var a=this.rtl,i=ke(e),s=a?-1:1,n=i.attr("data-swiper-parallax")||"0",r=i.attr("data-swiper-parallax-x"),o=i.attr("data-swiper-parallax-y"),l=i.attr("data-swiper-parallax-scale"),d=i.attr("data-swiper-parallax-opacity");if(r||o?(r=r||"0",o=o||"0"):this.isHorizontal()?(r=n,o="0"):(o=n,r="0"),r=r.indexOf("%")>=0?parseInt(r,10)*t*s+"%":r*t*s+"px",o=o.indexOf("%")>=0?parseInt(o,10)*t+"%":o*t+"px",null!=d){var c=d-(d-1)*(1-Math.abs(t));i[0].style.opacity=c}if(null==l)i.transform("translate3d("+r+", "+o+", 0px)");else{var u=l-(l-1)*(1-Math.abs(t));i.transform("translate3d("+r+", "+o+", 0px) scale("+u+")")}},setTranslate:function(){var e=this,t=e.$el,a=e.slides,i=e.progress,s=e.snapGrid;t.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]").each((function(t){e.parallax.setTransform(t,i)})),a.each((function(t,a){var n=t.progress;e.params.slidesPerGroup>1&&"auto"!==e.params.slidesPerView&&(n+=Math.ceil(a/2)-i*(s.length-1)),n=Math.min(Math.max(n,-1),1),ke(t).find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]").each((function(t){e.parallax.setTransform(t,n)}))}))},setTransition:function(e){void 0===e&&(e=this.params.speed),this.$el.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]").each((function(t){var a=ke(t),i=parseInt(a.attr("data-swiper-parallax-duration"),10)||e;0===e&&(i=0),a.transition(i)}))}},rt={getDistanceBetweenTouches:function(e){if(e.targetTouches.length<2)return 1;var t=e.targetTouches[0].pageX,a=e.targetTouches[0].pageY,i=e.targetTouches[1].pageX,s=e.targetTouches[1].pageY;return Math.sqrt(Math.pow(i-t,2)+Math.pow(s-a,2))},onGestureStart:function(e){var t=this,a=t.support,i=t.params.zoom,s=t.zoom,n=s.gesture;if(s.fakeGestureTouched=!1,s.fakeGestureMoved=!1,!a.gestures){if("touchstart"!==e.type||"touchstart"===e.type&&e.targetTouches.length<2)return;s.fakeGestureTouched=!0,n.scaleStart=rt.getDistanceBetweenTouches(e)}n.$slideEl&&n.$slideEl.length||(n.$slideEl=ke(e.target).closest("."+t.params.slideClass),0===n.$slideEl.length&&(n.$slideEl=t.slides.eq(t.activeIndex)),n.$imageEl=n.$slideEl.find("img, svg, canvas, picture, .swiper-zoom-target"),n.$imageWrapEl=n.$imageEl.parent("."+i.containerClass),n.maxRatio=n.$imageWrapEl.attr("data-swiper-zoom")||i.maxRatio,0!==n.$imageWrapEl.length)?(n.$imageEl&&n.$imageEl.transition(0),t.zoom.isScaling=!0):n.$imageEl=void 0},onGestureChange:function(e){var t=this,a=t.support,i=t.params.zoom,s=t.zoom,n=s.gesture;if(!a.gestures){if("touchmove"!==e.type||"touchmove"===e.type&&e.targetTouches.length<2)return;s.fakeGestureMoved=!0,n.scaleMove=rt.getDistanceBetweenTouches(e)}n.$imageEl&&0!==n.$imageEl.length?(a.gestures?s.scale=e.scale*s.currentScale:s.scale=n.scaleMove/n.scaleStart*s.currentScale,s.scale>n.maxRatio&&(s.scale=n.maxRatio-1+Math.pow(s.scale-n.maxRatio+1,.5)),s.scale<i.minRatio&&(s.scale=i.minRatio+1-Math.pow(i.minRatio-s.scale+1,.5)),n.$imageEl.transform("translate3d(0,0,0) scale("+s.scale+")")):"gesturechange"===e.type&&s.onGestureStart(e)},onGestureEnd:function(e){var t=this,a=t.device,i=t.support,s=t.params.zoom,n=t.zoom,r=n.gesture;if(!i.gestures){if(!n.fakeGestureTouched||!n.fakeGestureMoved)return;if("touchend"!==e.type||"touchend"===e.type&&e.changedTouches.length<2&&!a.android)return;n.fakeGestureTouched=!1,n.fakeGestureMoved=!1}r.$imageEl&&0!==r.$imageEl.length&&(n.scale=Math.max(Math.min(n.scale,r.maxRatio),s.minRatio),r.$imageEl.transition(t.params.speed).transform("translate3d(0,0,0) scale("+n.scale+")"),n.currentScale=n.scale,n.isScaling=!1,1===n.scale&&(r.$slideEl=void 0))},onTouchStart:function(e){var t=this.device,a=this.zoom,i=a.gesture,s=a.image;i.$imageEl&&0!==i.$imageEl.length&&(s.isTouched||(t.android&&e.cancelable&&e.preventDefault(),s.isTouched=!0,s.touchesStart.x="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,s.touchesStart.y="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY))},onTouchMove:function(e){var t=this,a=t.zoom,i=a.gesture,s=a.image,n=a.velocity;if(i.$imageEl&&0!==i.$imageEl.length&&(t.allowClick=!1,s.isTouched&&i.$slideEl)){s.isMoved||(s.width=i.$imageEl[0].offsetWidth,s.height=i.$imageEl[0].offsetHeight,s.startX=Ae(i.$imageWrapEl[0],"x")||0,s.startY=Ae(i.$imageWrapEl[0],"y")||0,i.slideWidth=i.$slideEl[0].offsetWidth,i.slideHeight=i.$slideEl[0].offsetHeight,i.$imageWrapEl.transition(0),t.rtl&&(s.startX=-s.startX,s.startY=-s.startY));var r=s.width*a.scale,o=s.height*a.scale;if(!(r<i.slideWidth&&o<i.slideHeight)){if(s.minX=Math.min(i.slideWidth/2-r/2,0),s.maxX=-s.minX,s.minY=Math.min(i.slideHeight/2-o/2,0),s.maxY=-s.minY,s.touchesCurrent.x="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,s.touchesCurrent.y="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,!s.isMoved&&!a.isScaling){if(t.isHorizontal()&&(Math.floor(s.minX)===Math.floor(s.startX)&&s.touchesCurrent.x<s.touchesStart.x||Math.floor(s.maxX)===Math.floor(s.startX)&&s.touchesCurrent.x>s.touchesStart.x))return void(s.isTouched=!1);if(!t.isHorizontal()&&(Math.floor(s.minY)===Math.floor(s.startY)&&s.touchesCurrent.y<s.touchesStart.y||Math.floor(s.maxY)===Math.floor(s.startY)&&s.touchesCurrent.y>s.touchesStart.y))return void(s.isTouched=!1)}e.cancelable&&e.preventDefault(),e.stopPropagation(),s.isMoved=!0,s.currentX=s.touchesCurrent.x-s.touchesStart.x+s.startX,s.currentY=s.touchesCurrent.y-s.touchesStart.y+s.startY,s.currentX<s.minX&&(s.currentX=s.minX+1-Math.pow(s.minX-s.currentX+1,.8)),s.currentX>s.maxX&&(s.currentX=s.maxX-1+Math.pow(s.currentX-s.maxX+1,.8)),s.currentY<s.minY&&(s.currentY=s.minY+1-Math.pow(s.minY-s.currentY+1,.8)),s.currentY>s.maxY&&(s.currentY=s.maxY-1+Math.pow(s.currentY-s.maxY+1,.8)),n.prevPositionX||(n.prevPositionX=s.touchesCurrent.x),n.prevPositionY||(n.prevPositionY=s.touchesCurrent.y),n.prevTime||(n.prevTime=Date.now()),n.x=(s.touchesCurrent.x-n.prevPositionX)/(Date.now()-n.prevTime)/2,n.y=(s.touchesCurrent.y-n.prevPositionY)/(Date.now()-n.prevTime)/2,Math.abs(s.touchesCurrent.x-n.prevPositionX)<2&&(n.x=0),Math.abs(s.touchesCurrent.y-n.prevPositionY)<2&&(n.y=0),n.prevPositionX=s.touchesCurrent.x,n.prevPositionY=s.touchesCurrent.y,n.prevTime=Date.now(),i.$imageWrapEl.transform("translate3d("+s.currentX+"px, "+s.currentY+"px,0)")}}},onTouchEnd:function(){var e=this.zoom,t=e.gesture,a=e.image,i=e.velocity;if(t.$imageEl&&0!==t.$imageEl.length){if(!a.isTouched||!a.isMoved)return a.isTouched=!1,void(a.isMoved=!1);a.isTouched=!1,a.isMoved=!1;var s=300,n=300,r=i.x*s,o=a.currentX+r,l=i.y*n,d=a.currentY+l;0!==i.x&&(s=Math.abs((o-a.currentX)/i.x)),0!==i.y&&(n=Math.abs((d-a.currentY)/i.y));var c=Math.max(s,n);a.currentX=o,a.currentY=d;var u=a.width*e.scale,h=a.height*e.scale;a.minX=Math.min(t.slideWidth/2-u/2,0),a.maxX=-a.minX,a.minY=Math.min(t.slideHeight/2-h/2,0),a.maxY=-a.minY,a.currentX=Math.max(Math.min(a.currentX,a.maxX),a.minX),a.currentY=Math.max(Math.min(a.currentY,a.maxY),a.minY),t.$imageWrapEl.transition(c).transform("translate3d("+a.currentX+"px, "+a.currentY+"px,0)")}},onTransitionEnd:function(){var e=this,t=e.zoom,a=t.gesture;a.$slideEl&&e.previousIndex!==e.activeIndex&&(a.$imageEl&&a.$imageEl.transform("translate3d(0,0,0) scale(1)"),a.$imageWrapEl&&a.$imageWrapEl.transform("translate3d(0,0,0)"),t.scale=1,t.currentScale=1,a.$slideEl=void 0,a.$imageEl=void 0,a.$imageWrapEl=void 0)},toggle:function(e){var t=this.zoom;t.scale&&1!==t.scale?t.out():t.in(e)},in:function(e){var t,a,i,s,n,r,o,l,d,c,u,h,p,m,f,g,v=this,y=v.zoom,b=v.params.zoom,w=y.gesture,_=y.image;w.$slideEl||(v.params.virtual&&v.params.virtual.enabled&&v.virtual?w.$slideEl=v.$wrapperEl.children("."+v.params.slideActiveClass):w.$slideEl=v.slides.eq(v.activeIndex),w.$imageEl=w.$slideEl.find("img, svg, canvas, picture, .swiper-zoom-target"),w.$imageWrapEl=w.$imageEl.parent("."+b.containerClass)),w.$imageEl&&0!==w.$imageEl.length&&(w.$slideEl.addClass(""+b.zoomedSlideClass),void 0===_.touchesStart.x&&e?(t="touchend"===e.type?e.changedTouches[0].pageX:e.pageX,a="touchend"===e.type?e.changedTouches[0].pageY:e.pageY):(t=_.touchesStart.x,a=_.touchesStart.y),y.scale=w.$imageWrapEl.attr("data-swiper-zoom")||b.maxRatio,y.currentScale=w.$imageWrapEl.attr("data-swiper-zoom")||b.maxRatio,e?(f=w.$slideEl[0].offsetWidth,g=w.$slideEl[0].offsetHeight,i=w.$slideEl.offset().left+f/2-t,s=w.$slideEl.offset().top+g/2-a,o=w.$imageEl[0].offsetWidth,l=w.$imageEl[0].offsetHeight,d=o*y.scale,c=l*y.scale,p=-(u=Math.min(f/2-d/2,0)),m=-(h=Math.min(g/2-c/2,0)),(n=i*y.scale)<u&&(n=u),n>p&&(n=p),(r=s*y.scale)<h&&(r=h),r>m&&(r=m)):(n=0,r=0),w.$imageWrapEl.transition(300).transform("translate3d("+n+"px, "+r+"px,0)"),w.$imageEl.transition(300).transform("translate3d(0,0,0) scale("+y.scale+")"))},out:function(){var e=this,t=e.zoom,a=e.params.zoom,i=t.gesture;i.$slideEl||(e.params.virtual&&e.params.virtual.enabled&&e.virtual?i.$slideEl=e.$wrapperEl.children("."+e.params.slideActiveClass):i.$slideEl=e.slides.eq(e.activeIndex),i.$imageEl=i.$slideEl.find("img, svg, canvas, picture, .swiper-zoom-target"),i.$imageWrapEl=i.$imageEl.parent("."+a.containerClass)),i.$imageEl&&0!==i.$imageEl.length&&(t.scale=1,t.currentScale=1,i.$imageWrapEl.transition(300).transform("translate3d(0,0,0)"),i.$imageEl.transition(300).transform("translate3d(0,0,0) scale(1)"),i.$slideEl.removeClass(""+a.zoomedSlideClass),i.$slideEl=void 0)},toggleGestures:function(e){var t=this,a=t.zoom,i=a.slideSelector,s=a.passiveListener;t.$wrapperEl[e]("gesturestart",i,a.onGestureStart,s),t.$wrapperEl[e]("gesturechange",i,a.onGestureChange,s),t.$wrapperEl[e]("gestureend",i,a.onGestureEnd,s)},enableGestures:function(){this.zoom.gesturesEnabled||(this.zoom.gesturesEnabled=!0,this.zoom.toggleGestures("on"))},disableGestures:function(){this.zoom.gesturesEnabled&&(this.zoom.gesturesEnabled=!1,this.zoom.toggleGestures("off"))},enable:function(){var e=this,t=e.support,a=e.zoom;if(!a.enabled){a.enabled=!0;var i=!("touchstart"!==e.touchEvents.start||!t.passiveListener||!e.params.passiveListeners)&&{passive:!0,capture:!1},s=!t.passiveListener||{passive:!1,capture:!0},n="."+e.params.slideClass;e.zoom.passiveListener=i,e.zoom.slideSelector=n,t.gestures?(e.$wrapperEl.on(e.touchEvents.start,e.zoom.enableGestures,i),e.$wrapperEl.on(e.touchEvents.end,e.zoom.disableGestures,i)):"touchstart"===e.touchEvents.start&&(e.$wrapperEl.on(e.touchEvents.start,n,a.onGestureStart,i),e.$wrapperEl.on(e.touchEvents.move,n,a.onGestureChange,s),e.$wrapperEl.on(e.touchEvents.end,n,a.onGestureEnd,i),e.touchEvents.cancel&&e.$wrapperEl.on(e.touchEvents.cancel,n,a.onGestureEnd,i)),e.$wrapperEl.on(e.touchEvents.move,"."+e.params.zoom.containerClass,a.onTouchMove,s)}},disable:function(){var e=this,t=e.zoom;if(t.enabled){var a=e.support;e.zoom.enabled=!1;var i=!("touchstart"!==e.touchEvents.start||!a.passiveListener||!e.params.passiveListeners)&&{passive:!0,capture:!1},s=!a.passiveListener||{passive:!1,capture:!0},n="."+e.params.slideClass;a.gestures?(e.$wrapperEl.off(e.touchEvents.start,e.zoom.enableGestures,i),e.$wrapperEl.off(e.touchEvents.end,e.zoom.disableGestures,i)):"touchstart"===e.touchEvents.start&&(e.$wrapperEl.off(e.touchEvents.start,n,t.onGestureStart,i),e.$wrapperEl.off(e.touchEvents.move,n,t.onGestureChange,s),e.$wrapperEl.off(e.touchEvents.end,n,t.onGestureEnd,i),e.touchEvents.cancel&&e.$wrapperEl.off(e.touchEvents.cancel,n,t.onGestureEnd,i)),e.$wrapperEl.off(e.touchEvents.move,"."+e.params.zoom.containerClass,t.onTouchMove,s)}}},ot={loadInSlide:function(e,t){void 0===t&&(t=!0);var a=this,i=a.params.lazy;if(void 0!==e&&0!==a.slides.length){var s=a.virtual&&a.params.virtual.enabled?a.$wrapperEl.children("."+a.params.slideClass+'[data-swiper-slide-index="'+e+'"]'):a.slides.eq(e),n=s.find("."+i.elementClass+":not(."+i.loadedClass+"):not(."+i.loadingClass+")");!s.hasClass(i.elementClass)||s.hasClass(i.loadedClass)||s.hasClass(i.loadingClass)||n.push(s[0]),0!==n.length&&n.each((function(e){var n=ke(e);n.addClass(i.loadingClass);var r=n.attr("data-background"),o=n.attr("data-src"),l=n.attr("data-srcset"),d=n.attr("data-sizes"),c=n.parent("picture");a.loadImage(n[0],o||r,l,d,!1,(function(){if(null!=a&&a&&(!a||a.params)&&!a.destroyed){if(r?(n.css("background-image",'url("'+r+'")'),n.removeAttr("data-background")):(l&&(n.attr("srcset",l),n.removeAttr("data-srcset")),d&&(n.attr("sizes",d),n.removeAttr("data-sizes")),c.length&&c.children("source").each((function(e){var t=ke(e);t.attr("data-srcset")&&(t.attr("srcset",t.attr("data-srcset")),t.removeAttr("data-srcset"))})),o&&(n.attr("src",o),n.removeAttr("data-src"))),n.addClass(i.loadedClass).removeClass(i.loadingClass),s.find("."+i.preloaderClass).remove(),a.params.loop&&t){var e=s.attr("data-swiper-slide-index");if(s.hasClass(a.params.slideDuplicateClass)){var u=a.$wrapperEl.children('[data-swiper-slide-index="'+e+'"]:not(.'+a.params.slideDuplicateClass+")");a.lazy.loadInSlide(u.index(),!1)}else{var h=a.$wrapperEl.children("."+a.params.slideDuplicateClass+'[data-swiper-slide-index="'+e+'"]');a.lazy.loadInSlide(h.index(),!1)}}a.emit("lazyImageReady",s[0],n[0]),a.params.autoHeight&&a.updateAutoHeight()}})),a.emit("lazyImageLoad",s[0],n[0])}))}},load:function(){var e=this,t=e.$wrapperEl,a=e.params,i=e.slides,s=e.activeIndex,n=e.virtual&&a.virtual.enabled,r=a.lazy,o=a.slidesPerView;function l(e){if(n){if(t.children("."+a.slideClass+'[data-swiper-slide-index="'+e+'"]').length)return!0}else if(i[e])return!0;return!1}function d(e){return n?ke(e).attr("data-swiper-slide-index"):ke(e).index()}if("auto"===o&&(o=0),e.lazy.initialImageLoaded||(e.lazy.initialImageLoaded=!0),e.params.watchSlidesVisibility)t.children("."+a.slideVisibleClass).each((function(t){var a=n?ke(t).attr("data-swiper-slide-index"):ke(t).index();e.lazy.loadInSlide(a)}));else if(o>1)for(var c=s;c<s+o;c+=1)l(c)&&e.lazy.loadInSlide(c);else e.lazy.loadInSlide(s);if(r.loadPrevNext)if(o>1||r.loadPrevNextAmount&&r.loadPrevNextAmount>1){for(var u=r.loadPrevNextAmount,h=o,p=Math.min(s+h+Math.max(u,h),i.length),m=Math.max(s-Math.max(h,u),0),f=s+o;f<p;f+=1)l(f)&&e.lazy.loadInSlide(f);for(var g=m;g<s;g+=1)l(g)&&e.lazy.loadInSlide(g)}else{var v=t.children("."+a.slideNextClass);v.length>0&&e.lazy.loadInSlide(d(v));var y=t.children("."+a.slidePrevClass);y.length>0&&e.lazy.loadInSlide(d(y))}}},lt={LinearSpline:function(e,t){var a,i,s,n,r;return this.x=e,this.y=t,this.lastIndex=e.length-1,this.interpolate=function(e){return e?(r=function(e,t){for(i=-1,a=e.length;a-i>1;)e[s=a+i>>1]<=t?i=s:a=s;return a}(this.x,e),n=r-1,(e-this.x[n])*(this.y[r]-this.y[n])/(this.x[r]-this.x[n])+this.y[n]):0},this},getInterpolateFunction:function(e){var t=this;t.controller.spline||(t.controller.spline=t.params.loop?new lt.LinearSpline(t.slidesGrid,e.slidesGrid):new lt.LinearSpline(t.snapGrid,e.snapGrid))},setTranslate:function(e,t){var a,i,s=this,n=s.controller.control,r=s.constructor;function o(e){var t=s.rtlTranslate?-s.translate:s.translate;"slide"===s.params.controller.by&&(s.controller.getInterpolateFunction(e),i=-s.controller.spline.interpolate(-t)),i&&"container"!==s.params.controller.by||(a=(e.maxTranslate()-e.minTranslate())/(s.maxTranslate()-s.minTranslate()),i=(t-s.minTranslate())*a+e.minTranslate()),s.params.controller.inverse&&(i=e.maxTranslate()-i),e.updateProgress(i),e.setTranslate(i,s),e.updateActiveIndex(),e.updateSlidesClasses()}if(Array.isArray(n))for(var l=0;l<n.length;l+=1)n[l]!==t&&n[l]instanceof r&&o(n[l]);else n instanceof r&&t!==n&&o(n)},setTransition:function(e,t){var a,i=this,s=i.constructor,n=i.controller.control;function r(t){t.setTransition(e,i),0!==e&&(t.transitionStart(),t.params.autoHeight&&Ee((function(){t.updateAutoHeight()})),t.$wrapperEl.transitionEnd((function(){n&&(t.params.loop&&"slide"===i.params.controller.by&&t.loopFix(),t.transitionEnd())})))}if(Array.isArray(n))for(a=0;a<n.length;a+=1)n[a]!==t&&n[a]instanceof s&&r(n[a]);else n instanceof s&&t!==n&&r(n)}},dt={getRandomNumber:function(e){return void 0===e&&(e=16),"x".repeat(e).replace(/x/g,(function(){return Math.round(16*Math.random()).toString(16)}))},makeElFocusable:function(e){return e.attr("tabIndex","0"),e},makeElNotFocusable:function(e){return e.attr("tabIndex","-1"),e},addElRole:function(e,t){return e.attr("role",t),e},addElRoleDescription:function(e,t){return e.attr("aria-role-description",t),e},addElControls:function(e,t){return e.attr("aria-controls",t),e},addElLabel:function(e,t){return e.attr("aria-label",t),e},addElId:function(e,t){return e.attr("id",t),e},addElLive:function(e,t){return e.attr("aria-live",t),e},disableEl:function(e){return e.attr("aria-disabled",!0),e},enableEl:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){var t=this,a=t.params.a11y;if(13===e.keyCode){var i=ke(e.target);t.navigation&&t.navigation.$nextEl&&i.is(t.navigation.$nextEl)&&(t.isEnd&&!t.params.loop||t.slideNext(),t.isEnd?t.a11y.notify(a.lastSlideMessage):t.a11y.notify(a.nextSlideMessage)),t.navigation&&t.navigation.$prevEl&&i.is(t.navigation.$prevEl)&&(t.isBeginning&&!t.params.loop||t.slidePrev(),t.isBeginning?t.a11y.notify(a.firstSlideMessage):t.a11y.notify(a.prevSlideMessage)),t.pagination&&i.is("."+t.params.pagination.bulletClass)&&i[0].click()}},notify:function(e){var t=this.a11y.liveRegion;0!==t.length&&(t.html(""),t.html(e))},updateNavigation:function(){var e=this;if(!e.params.loop&&e.navigation){var t=e.navigation,a=t.$nextEl,i=t.$prevEl;i&&i.length>0&&(e.isBeginning?(e.a11y.disableEl(i),e.a11y.makeElNotFocusable(i)):(e.a11y.enableEl(i),e.a11y.makeElFocusable(i))),a&&a.length>0&&(e.isEnd?(e.a11y.disableEl(a),e.a11y.makeElNotFocusable(a)):(e.a11y.enableEl(a),e.a11y.makeElFocusable(a)))}},updatePagination:function(){var e=this,t=e.params.a11y;e.pagination&&e.params.pagination.clickable&&e.pagination.bullets&&e.pagination.bullets.length&&e.pagination.bullets.each((function(a){var i=ke(a);e.a11y.makeElFocusable(i),e.params.pagination.renderBullet||(e.a11y.addElRole(i,"button"),e.a11y.addElLabel(i,t.paginationBulletMessage.replace(/\{\{index\}\}/,i.index()+1)))}))},init:function(){var e=this,t=e.params.a11y;e.$el.append(e.a11y.liveRegion);var a=e.$el;t.containerRoleDescriptionMessage&&e.a11y.addElRoleDescription(a,t.containerRoleDescriptionMessage),t.containerMessage&&e.a11y.addElLabel(a,t.containerMessage);var i,s,n,r=e.$wrapperEl,o=r.attr("id")||"swiper-wrapper-"+e.a11y.getRandomNumber(16);e.a11y.addElId(r,o),i=e.params.autoplay&&e.params.autoplay.enabled?"off":"polite",e.a11y.addElLive(r,i),t.itemRoleDescriptionMessage&&e.a11y.addElRoleDescription(ke(e.slides),t.itemRoleDescriptionMessage),e.a11y.addElRole(ke(e.slides),"group"),e.slides.each((function(t){var a=ke(t);e.a11y.addElLabel(a,a.index()+1+" / "+e.slides.length)})),e.navigation&&e.navigation.$nextEl&&(s=e.navigation.$nextEl),e.navigation&&e.navigation.$prevEl&&(n=e.navigation.$prevEl),s&&s.length&&(e.a11y.makeElFocusable(s),"BUTTON"!==s[0].tagName&&(e.a11y.addElRole(s,"button"),s.on("keydown",e.a11y.onEnterKey)),e.a11y.addElLabel(s,t.nextSlideMessage),e.a11y.addElControls(s,o)),n&&n.length&&(e.a11y.makeElFocusable(n),"BUTTON"!==n[0].tagName&&(e.a11y.addElRole(n,"button"),n.on("keydown",e.a11y.onEnterKey)),e.a11y.addElLabel(n,t.prevSlideMessage),e.a11y.addElControls(n,o)),e.pagination&&e.params.pagination.clickable&&e.pagination.bullets&&e.pagination.bullets.length&&e.pagination.$el.on("keydown","."+e.params.pagination.bulletClass,e.a11y.onEnterKey)},destroy:function(){var e,t,a=this;a.a11y.liveRegion&&a.a11y.liveRegion.length>0&&a.a11y.liveRegion.remove(),a.navigation&&a.navigation.$nextEl&&(e=a.navigation.$nextEl),a.navigation&&a.navigation.$prevEl&&(t=a.navigation.$prevEl),e&&e.off("keydown",a.a11y.onEnterKey),t&&t.off("keydown",a.a11y.onEnterKey),a.pagination&&a.params.pagination.clickable&&a.pagination.bullets&&a.pagination.bullets.length&&a.pagination.$el.off("keydown","."+a.params.pagination.bulletClass,a.a11y.onEnterKey)}},ct={init:function(){var e=this,t=pe();if(e.params.history){if(!t.history||!t.history.pushState)return e.params.history.enabled=!1,void(e.params.hashNavigation.enabled=!0);var a=e.history;a.initialized=!0,a.paths=ct.getPathValues(e.params.url),(a.paths.key||a.paths.value)&&(a.scrollToSlide(0,a.paths.value,e.params.runCallbacksOnInit),e.params.history.replaceState||t.addEventListener("popstate",e.history.setHistoryPopState))}},destroy:function(){var e=pe();this.params.history.replaceState||e.removeEventListener("popstate",this.history.setHistoryPopState)},setHistoryPopState:function(){var e=this;e.history.paths=ct.getPathValues(e.params.url),e.history.scrollToSlide(e.params.speed,e.history.paths.value,!1)},getPathValues:function(e){var t=pe(),a=(e?new URL(e):t.location).pathname.slice(1).split("/").filter((function(e){return""!==e})),i=a.length;return{key:a[i-2],value:a[i-1]}},setHistory:function(e,t){var a=this,i=pe();if(a.history.initialized&&a.params.history.enabled){var s;s=a.params.url?new URL(a.params.url):i.location;var n=a.slides.eq(t),r=ct.slugify(n.attr("data-history"));s.pathname.includes(e)||(r=e+"/"+r);var o=i.history.state;o&&o.value===r||(a.params.history.replaceState?i.history.replaceState({value:r},null,r):i.history.pushState({value:r},null,r))}},slugify:function(e){return e.toString().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},scrollToSlide:function(e,t,a){var i=this;if(t)for(var s=0,n=i.slides.length;s<n;s+=1){var r=i.slides.eq(s);if(ct.slugify(r.attr("data-history"))===t&&!r.hasClass(i.params.slideDuplicateClass)){var o=r.index();i.slideTo(o,e,a)}}else i.slideTo(0,e,a)}},ut={onHashCange:function(){var e=this,t=ue();e.emit("hashChange");var a=t.location.hash.replace("#","");if(a!==e.slides.eq(e.activeIndex).attr("data-hash")){var i=e.$wrapperEl.children("."+e.params.slideClass+'[data-hash="'+a+'"]').index();if(void 0===i)return;e.slideTo(i)}},setHash:function(){var e=this,t=pe(),a=ue();if(e.hashNavigation.initialized&&e.params.hashNavigation.enabled)if(e.params.hashNavigation.replaceState&&t.history&&t.history.replaceState)t.history.replaceState(null,null,"#"+e.slides.eq(e.activeIndex).attr("data-hash")||0),e.emit("hashSet");else{var i=e.slides.eq(e.activeIndex),s=i.attr("data-hash")||i.attr("data-history");a.location.hash=s||"",e.emit("hashSet")}},init:function(){var e=this,t=ue(),a=pe();if(!(!e.params.hashNavigation.enabled||e.params.history&&e.params.history.enabled)){e.hashNavigation.initialized=!0;var i=t.location.hash.replace("#","");if(i)for(var s=0,n=e.slides.length;s<n;s+=1){var r=e.slides.eq(s);if((r.attr("data-hash")||r.attr("data-history"))===i&&!r.hasClass(e.params.slideDuplicateClass)){var o=r.index();e.slideTo(o,0,e.params.runCallbacksOnInit,!0)}}e.params.hashNavigation.watchState&&ke(a).on("hashchange",e.hashNavigation.onHashCange)}},destroy:function(){var e=pe();this.params.hashNavigation.watchState&&ke(e).off("hashchange",this.hashNavigation.onHashCange)}},ht={run:function(){var e=this,t=e.slides.eq(e.activeIndex),a=e.params.autoplay.delay;t.attr("data-swiper-autoplay")&&(a=t.attr("data-swiper-autoplay")||e.params.autoplay.delay),clearTimeout(e.autoplay.timeout),e.autoplay.timeout=Ee((function(){var t;e.params.autoplay.reverseDirection?e.params.loop?(e.loopFix(),t=e.slidePrev(e.params.speed,!0,!0),e.emit("autoplay")):e.isBeginning?e.params.autoplay.stopOnLastSlide?e.autoplay.stop():(t=e.slideTo(e.slides.length-1,e.params.speed,!0,!0),e.emit("autoplay")):(t=e.slidePrev(e.params.speed,!0,!0),e.emit("autoplay")):e.params.loop?(e.loopFix(),t=e.slideNext(e.params.speed,!0,!0),e.emit("autoplay")):e.isEnd?e.params.autoplay.stopOnLastSlide?e.autoplay.stop():(t=e.slideTo(0,e.params.speed,!0,!0),e.emit("autoplay")):(t=e.slideNext(e.params.speed,!0,!0),e.emit("autoplay")),(e.params.cssMode&&e.autoplay.running||!1===t)&&e.autoplay.run()}),a)},start:function(){var e=this;return void 0===e.autoplay.timeout&&!e.autoplay.running&&(e.autoplay.running=!0,e.emit("autoplayStart"),e.autoplay.run(),!0)},stop:function(){var e=this;return!!e.autoplay.running&&void 0!==e.autoplay.timeout&&(e.autoplay.timeout&&(clearTimeout(e.autoplay.timeout),e.autoplay.timeout=void 0),e.autoplay.running=!1,e.emit("autoplayStop"),!0)},pause:function(e){var t=this;t.autoplay.running&&(t.autoplay.paused||(t.autoplay.timeout&&clearTimeout(t.autoplay.timeout),t.autoplay.paused=!0,0!==e&&t.params.autoplay.waitForTransition?(t.$wrapperEl[0].addEventListener("transitionend",t.autoplay.onTransitionEnd),t.$wrapperEl[0].addEventListener("webkitTransitionEnd",t.autoplay.onTransitionEnd)):(t.autoplay.paused=!1,t.autoplay.run())))},onVisibilityChange:function(){var e=this,t=ue();"hidden"===t.visibilityState&&e.autoplay.running&&e.autoplay.pause(),"visible"===t.visibilityState&&e.autoplay.paused&&(e.autoplay.run(),e.autoplay.paused=!1)},onTransitionEnd:function(e){var t=this;t&&!t.destroyed&&t.$wrapperEl&&e.target===t.$wrapperEl[0]&&(t.$wrapperEl[0].removeEventListener("transitionend",t.autoplay.onTransitionEnd),t.$wrapperEl[0].removeEventListener("webkitTransitionEnd",t.autoplay.onTransitionEnd),t.autoplay.paused=!1,t.autoplay.running?t.autoplay.run():t.autoplay.stop())}},pt={setTranslate:function(){for(var e=this,t=e.slides,a=0;a<t.length;a+=1){var i=e.slides.eq(a),s=-i[0].swiperSlideOffset;e.params.virtualTranslate||(s-=e.translate);var n=0;e.isHorizontal()||(n=s,s=0);var r=e.params.fadeEffect.crossFade?Math.max(1-Math.abs(i[0].progress),0):1+Math.min(Math.max(i[0].progress,-1),0);i.css({opacity:r}).transform("translate3d("+s+"px, "+n+"px, 0px)")}},setTransition:function(e){var t=this,a=t.slides,i=t.$wrapperEl;if(a.transition(e),t.params.virtualTranslate&&0!==e){var s=!1;a.transitionEnd((function(){if(!s&&t&&!t.destroyed){s=!0,t.animating=!1;for(var e=["webkitTransitionEnd","transitionend"],a=0;a<e.length;a+=1)i.trigger(e[a])}}))}}},mt={setTranslate:function(){var e,t=this,a=t.$el,i=t.$wrapperEl,s=t.slides,n=t.width,r=t.height,o=t.rtlTranslate,l=t.size,d=t.browser,c=t.params.cubeEffect,u=t.isHorizontal(),h=t.virtual&&t.params.virtual.enabled,p=0;c.shadow&&(u?(0===(e=i.find(".swiper-cube-shadow")).length&&(e=ke('<div class="swiper-cube-shadow"></div>'),i.append(e)),e.css({height:n+"px"})):0===(e=a.find(".swiper-cube-shadow")).length&&(e=ke('<div class="swiper-cube-shadow"></div>'),a.append(e)));for(var m=0;m<s.length;m+=1){var f=s.eq(m),g=m;h&&(g=parseInt(f.attr("data-swiper-slide-index"),10));var v=90*g,y=Math.floor(v/360);o&&(v=-v,y=Math.floor(-v/360));var b=Math.max(Math.min(f[0].progress,1),-1),w=0,_=0,k=0;g%4==0?(w=4*-y*l,k=0):(g-1)%4==0?(w=0,k=4*-y*l):(g-2)%4==0?(w=l+4*y*l,k=l):(g-3)%4==0&&(w=-l,k=3*l+4*l*y),o&&(w=-w),u||(_=w,w=0);var C="rotateX("+(u?0:-v)+"deg) rotateY("+(u?v:0)+"deg) translate3d("+w+"px, "+_+"px, "+k+"px)";if(b<=1&&b>-1&&(p=90*g+90*b,o&&(p=90*-g-90*b)),f.transform(C),c.slideShadows){var x=u?f.find(".swiper-slide-shadow-left"):f.find(".swiper-slide-shadow-top"),S=u?f.find(".swiper-slide-shadow-right"):f.find(".swiper-slide-shadow-bottom");0===x.length&&(x=ke('<div class="swiper-slide-shadow-'+(u?"left":"top")+'"></div>'),f.append(x)),0===S.length&&(S=ke('<div class="swiper-slide-shadow-'+(u?"right":"bottom")+'"></div>'),f.append(S)),x.length&&(x[0].style.opacity=Math.max(-b,0)),S.length&&(S[0].style.opacity=Math.max(b,0))}}if(i.css({"-webkit-transform-origin":"50% 50% -"+l/2+"px","-moz-transform-origin":"50% 50% -"+l/2+"px","-ms-transform-origin":"50% 50% -"+l/2+"px","transform-origin":"50% 50% -"+l/2+"px"}),c.shadow)if(u)e.transform("translate3d(0px, "+(n/2+c.shadowOffset)+"px, "+-n/2+"px) rotateX(90deg) rotateZ(0deg) scale("+c.shadowScale+")");else{var T=Math.abs(p)-90*Math.floor(Math.abs(p)/90),E=1.5-(Math.sin(2*T*Math.PI/360)/2+Math.cos(2*T*Math.PI/360)/2),P=c.shadowScale,A=c.shadowScale/E,L=c.shadowOffset;e.transform("scale3d("+P+", 1, "+A+") translate3d(0px, "+(r/2+L)+"px, "+-r/2/A+"px) rotateX(-90deg)")}var M=d.isSafari||d.isWebView?-l/2:0;i.transform("translate3d(0px,0,"+M+"px) rotateX("+(t.isHorizontal()?0:p)+"deg) rotateY("+(t.isHorizontal()?-p:0)+"deg)")},setTransition:function(e){var t=this,a=t.$el;t.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),t.params.cubeEffect.shadow&&!t.isHorizontal()&&a.find(".swiper-cube-shadow").transition(e)}},ft={setTranslate:function(){for(var e=this,t=e.slides,a=e.rtlTranslate,i=0;i<t.length;i+=1){var s=t.eq(i),n=s[0].progress;e.params.flipEffect.limitRotation&&(n=Math.max(Math.min(s[0].progress,1),-1));var r=-180*n,o=0,l=-s[0].swiperSlideOffset,d=0;if(e.isHorizontal()?a&&(r=-r):(d=l,l=0,o=-r,r=0),s[0].style.zIndex=-Math.abs(Math.round(n))+t.length,e.params.flipEffect.slideShadows){var c=e.isHorizontal()?s.find(".swiper-slide-shadow-left"):s.find(".swiper-slide-shadow-top"),u=e.isHorizontal()?s.find(".swiper-slide-shadow-right"):s.find(".swiper-slide-shadow-bottom");0===c.length&&(c=ke('<div class="swiper-slide-shadow-'+(e.isHorizontal()?"left":"top")+'"></div>'),s.append(c)),0===u.length&&(u=ke('<div class="swiper-slide-shadow-'+(e.isHorizontal()?"right":"bottom")+'"></div>'),s.append(u)),c.length&&(c[0].style.opacity=Math.max(-n,0)),u.length&&(u[0].style.opacity=Math.max(n,0))}s.transform("translate3d("+l+"px, "+d+"px, 0px) rotateX("+o+"deg) rotateY("+r+"deg)")}},setTransition:function(e){var t=this,a=t.slides,i=t.activeIndex,s=t.$wrapperEl;if(a.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),t.params.virtualTranslate&&0!==e){var n=!1;a.eq(i).transitionEnd((function(){if(!n&&t&&!t.destroyed){n=!0,t.animating=!1;for(var e=["webkitTransitionEnd","transitionend"],a=0;a<e.length;a+=1)s.trigger(e[a])}}))}}},gt={setTranslate:function(){for(var e=this,t=e.width,a=e.height,i=e.slides,s=e.slidesSizesGrid,n=e.params.coverflowEffect,r=e.isHorizontal(),o=e.translate,l=r?t/2-o:a/2-o,d=r?n.rotate:-n.rotate,c=n.depth,u=0,h=i.length;u<h;u+=1){var p=i.eq(u),m=s[u],f=(l-p[0].swiperSlideOffset-m/2)/m*n.modifier,g=r?d*f:0,v=r?0:d*f,y=-c*Math.abs(f),b=n.stretch;"string"==typeof b&&-1!==b.indexOf("%")&&(b=parseFloat(n.stretch)/100*m);var w=r?0:b*f,_=r?b*f:0,k=1-(1-n.scale)*Math.abs(f);Math.abs(_)<.001&&(_=0),Math.abs(w)<.001&&(w=0),Math.abs(y)<.001&&(y=0),Math.abs(g)<.001&&(g=0),Math.abs(v)<.001&&(v=0),Math.abs(k)<.001&&(k=0);var C="translate3d("+_+"px,"+w+"px,"+y+"px)  rotateX("+v+"deg) rotateY("+g+"deg) scale("+k+")";if(p.transform(C),p[0].style.zIndex=1-Math.abs(Math.round(f)),n.slideShadows){var x=r?p.find(".swiper-slide-shadow-left"):p.find(".swiper-slide-shadow-top"),S=r?p.find(".swiper-slide-shadow-right"):p.find(".swiper-slide-shadow-bottom");0===x.length&&(x=ke('<div class="swiper-slide-shadow-'+(r?"left":"top")+'"></div>'),p.append(x)),0===S.length&&(S=ke('<div class="swiper-slide-shadow-'+(r?"right":"bottom")+'"></div>'),p.append(S)),x.length&&(x[0].style.opacity=f>0?f:0),S.length&&(S[0].style.opacity=-f>0?-f:0)}}},setTransition:function(e){this.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}},vt={init:function(){var e=this,t=e.params.thumbs;if(e.thumbs.initialized)return!1;e.thumbs.initialized=!0;var a=e.constructor;return t.swiper instanceof a?(e.thumbs.swiper=t.swiper,Me(e.thumbs.swiper.originalParams,{watchSlidesProgress:!0,slideToClickedSlide:!1}),Me(e.thumbs.swiper.params,{watchSlidesProgress:!0,slideToClickedSlide:!1})):Le(t.swiper)&&(e.thumbs.swiper=new a(Me({},t.swiper,{watchSlidesVisibility:!0,watchSlidesProgress:!0,slideToClickedSlide:!1})),e.thumbs.swiperCreated=!0),e.thumbs.swiper.$el.addClass(e.params.thumbs.thumbsContainerClass),e.thumbs.swiper.on("tap",e.thumbs.onThumbClick),!0},onThumbClick:function(){var e=this,t=e.thumbs.swiper;if(t){var a=t.clickedIndex,i=t.clickedSlide;if(!(i&&ke(i).hasClass(e.params.thumbs.slideThumbActiveClass)||null==a)){var s;if(s=t.params.loop?parseInt(ke(t.clickedSlide).attr("data-swiper-slide-index"),10):a,e.params.loop){var n=e.activeIndex;e.slides.eq(n).hasClass(e.params.slideDuplicateClass)&&(e.loopFix(),e._clientLeft=e.$wrapperEl[0].clientLeft,n=e.activeIndex);var r=e.slides.eq(n).prevAll('[data-swiper-slide-index="'+s+'"]').eq(0).index(),o=e.slides.eq(n).nextAll('[data-swiper-slide-index="'+s+'"]').eq(0).index();s=void 0===r?o:void 0===o?r:o-n<n-r?o:r}e.slideTo(s)}}},update:function(e){var t=this,a=t.thumbs.swiper;if(a){var i="auto"===a.params.slidesPerView?a.slidesPerViewDynamic():a.params.slidesPerView,s=t.params.thumbs.autoScrollOffset,n=s&&!a.params.loop;if(t.realIndex!==a.realIndex||n){var r,o,l=a.activeIndex;if(a.params.loop){a.slides.eq(l).hasClass(a.params.slideDuplicateClass)&&(a.loopFix(),a._clientLeft=a.$wrapperEl[0].clientLeft,l=a.activeIndex);var d=a.slides.eq(l).prevAll('[data-swiper-slide-index="'+t.realIndex+'"]').eq(0).index(),c=a.slides.eq(l).nextAll('[data-swiper-slide-index="'+t.realIndex+'"]').eq(0).index();r=void 0===d?c:void 0===c?d:c-l==l-d?l:c-l<l-d?c:d,o=t.activeIndex>t.previousIndex?"next":"prev"}else o=(r=t.realIndex)>t.previousIndex?"next":"prev";n&&(r+="next"===o?s:-1*s),a.visibleSlidesIndexes&&a.visibleSlidesIndexes.indexOf(r)<0&&(a.params.centeredSlides?r=r>l?r-Math.floor(i/2)+1:r+Math.floor(i/2)-1:r>l&&(r=r-i+1),a.slideTo(r,e?0:void 0))}var u=1,h=t.params.thumbs.slideThumbActiveClass;if(t.params.slidesPerView>1&&!t.params.centeredSlides&&(u=t.params.slidesPerView),t.params.thumbs.multipleActiveThumbs||(u=1),u=Math.floor(u),a.slides.removeClass(h),a.params.loop||a.params.virtual&&a.params.virtual.enabled)for(var p=0;p<u;p+=1)a.$wrapperEl.children('[data-swiper-slide-index="'+(t.realIndex+p)+'"]').addClass(h);else for(var m=0;m<u;m+=1)a.slides.eq(t.realIndex+m).addClass(h)}}},yt=[Je,et,{name:"mousewheel",params:{mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarget:"container",thresholdDelta:null,thresholdTime:null}},create:function(){Ie(this,{mousewheel:{enabled:!1,lastScrollTime:Pe(),lastEventBeforeSnap:void 0,recentWheelEvents:[],enable:tt.enable,disable:tt.disable,handle:tt.handle,handleMouseEnter:tt.handleMouseEnter,handleMouseLeave:tt.handleMouseLeave,animateSlider:tt.animateSlider,releaseScroll:tt.releaseScroll}})},on:{init:function(e){!e.params.mousewheel.enabled&&e.params.cssMode&&e.mousewheel.disable(),e.params.mousewheel.enabled&&e.mousewheel.enable()},destroy:function(e){e.params.cssMode&&e.mousewheel.enable(),e.mousewheel.enabled&&e.mousewheel.disable()}}},{name:"navigation",params:{navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock"}},create:function(){Ie(this,{navigation:oe({},at)})},on:{init:function(e){e.navigation.init(),e.navigation.update()},toEdge:function(e){e.navigation.update()},fromEdge:function(e){e.navigation.update()},destroy:function(e){e.navigation.destroy()},click:function(e,t){var a,i=e.navigation,s=i.$nextEl,n=i.$prevEl;!e.params.navigation.hideOnClick||ke(t.target).is(n)||ke(t.target).is(s)||(s?a=s.hasClass(e.params.navigation.hiddenClass):n&&(a=n.hasClass(e.params.navigation.hiddenClass)),!0===a?e.emit("navigationShow"):e.emit("navigationHide"),s&&s.toggleClass(e.params.navigation.hiddenClass),n&&n.toggleClass(e.params.navigation.hiddenClass))}}},{name:"pagination",params:{pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:function(e){return e},formatFractionTotal:function(e){return e},bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",modifierClass:"swiper-pagination-",currentClass:"swiper-pagination-current",totalClass:"swiper-pagination-total",hiddenClass:"swiper-pagination-hidden",progressbarFillClass:"swiper-pagination-progressbar-fill",progressbarOppositeClass:"swiper-pagination-progressbar-opposite",clickableClass:"swiper-pagination-clickable",lockClass:"swiper-pagination-lock"}},create:function(){Ie(this,{pagination:oe({dynamicBulletIndex:0},it)})},on:{init:function(e){e.pagination.init(),e.pagination.render(),e.pagination.update()},activeIndexChange:function(e){(e.params.loop||void 0===e.snapIndex)&&e.pagination.update()},snapIndexChange:function(e){e.params.loop||e.pagination.update()},slidesLengthChange:function(e){e.params.loop&&(e.pagination.render(),e.pagination.update())},snapGridLengthChange:function(e){e.params.loop||(e.pagination.render(),e.pagination.update())},destroy:function(e){e.pagination.destroy()},click:function(e,t){e.params.pagination.el&&e.params.pagination.hideOnClick&&e.pagination.$el.length>0&&!ke(t.target).hasClass(e.params.pagination.bulletClass)&&(!0===e.pagination.$el.hasClass(e.params.pagination.hiddenClass)?e.emit("paginationShow"):e.emit("paginationHide"),e.pagination.$el.toggleClass(e.params.pagination.hiddenClass))}}},{name:"scrollbar",params:{scrollbar:{el:null,dragSize:"auto",hide:!1,draggable:!1,snapOnRelease:!0,lockClass:"swiper-scrollbar-lock",dragClass:"swiper-scrollbar-drag"}},create:function(){Ie(this,{scrollbar:oe({isTouched:!1,timeout:null,dragTimeout:null},st)})},on:{init:function(e){e.scrollbar.init(),e.scrollbar.updateSize(),e.scrollbar.setTranslate()},update:function(e){e.scrollbar.updateSize()},resize:function(e){e.scrollbar.updateSize()},observerUpdate:function(e){e.scrollbar.updateSize()},setTranslate:function(e){e.scrollbar.setTranslate()},setTransition:function(e,t){e.scrollbar.setTransition(t)},destroy:function(e){e.scrollbar.destroy()}}},{name:"parallax",params:{parallax:{enabled:!1}},create:function(){Ie(this,{parallax:oe({},nt)})},on:{beforeInit:function(e){e.params.parallax.enabled&&(e.params.watchSlidesProgress=!0,e.originalParams.watchSlidesProgress=!0)},init:function(e){e.params.parallax.enabled&&e.parallax.setTranslate()},setTranslate:function(e){e.params.parallax.enabled&&e.parallax.setTranslate()},setTransition:function(e,t){e.params.parallax.enabled&&e.parallax.setTransition(t)}}},{name:"zoom",params:{zoom:{enabled:!1,maxRatio:3,minRatio:1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}},create:function(){var e=this;Ie(e,{zoom:oe({enabled:!1,scale:1,currentScale:1,isScaling:!1,gesture:{$slideEl:void 0,slideWidth:void 0,slideHeight:void 0,$imageEl:void 0,$imageWrapEl:void 0,maxRatio:3},image:{isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},velocity:{x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0}},rt)});var t=1;Object.defineProperty(e.zoom,"scale",{get:function(){return t},set:function(a){if(t!==a){var i=e.zoom.gesture.$imageEl?e.zoom.gesture.$imageEl[0]:void 0,s=e.zoom.gesture.$slideEl?e.zoom.gesture.$slideEl[0]:void 0;e.emit("zoomChange",a,i,s)}t=a}})},on:{init:function(e){e.params.zoom.enabled&&e.zoom.enable()},destroy:function(e){e.zoom.disable()},touchStart:function(e,t){e.zoom.enabled&&e.zoom.onTouchStart(t)},touchEnd:function(e,t){e.zoom.enabled&&e.zoom.onTouchEnd(t)},doubleTap:function(e,t){e.params.zoom.enabled&&e.zoom.enabled&&e.params.zoom.toggle&&e.zoom.toggle(t)},transitionEnd:function(e){e.zoom.enabled&&e.params.zoom.enabled&&e.zoom.onTransitionEnd()},slideChange:function(e){e.zoom.enabled&&e.params.zoom.enabled&&e.params.cssMode&&e.zoom.onTransitionEnd()}}},{name:"lazy",params:{lazy:{enabled:!1,loadPrevNext:!1,loadPrevNextAmount:1,loadOnTransitionStart:!1,elementClass:"swiper-lazy",loadingClass:"swiper-lazy-loading",loadedClass:"swiper-lazy-loaded",preloaderClass:"swiper-lazy-preloader"}},create:function(){Ie(this,{lazy:oe({initialImageLoaded:!1},ot)})},on:{beforeInit:function(e){e.params.lazy.enabled&&e.params.preloadImages&&(e.params.preloadImages=!1)},init:function(e){e.params.lazy.enabled&&!e.params.loop&&0===e.params.initialSlide&&e.lazy.load()},scroll:function(e){e.params.freeMode&&!e.params.freeModeSticky&&e.lazy.load()},resize:function(e){e.params.lazy.enabled&&e.lazy.load()},scrollbarDragMove:function(e){e.params.lazy.enabled&&e.lazy.load()},transitionStart:function(e){e.params.lazy.enabled&&(e.params.lazy.loadOnTransitionStart||!e.params.lazy.loadOnTransitionStart&&!e.lazy.initialImageLoaded)&&e.lazy.load()},transitionEnd:function(e){e.params.lazy.enabled&&!e.params.lazy.loadOnTransitionStart&&e.lazy.load()},slideChange:function(e){e.params.lazy.enabled&&e.params.cssMode&&e.lazy.load()}}},{name:"controller",params:{controller:{control:void 0,inverse:!1,by:"slide"}},create:function(){Ie(this,{controller:oe({control:this.params.controller.control},lt)})},on:{update:function(e){e.controller.control&&e.controller.spline&&(e.controller.spline=void 0,delete e.controller.spline)},resize:function(e){e.controller.control&&e.controller.spline&&(e.controller.spline=void 0,delete e.controller.spline)},observerUpdate:function(e){e.controller.control&&e.controller.spline&&(e.controller.spline=void 0,delete e.controller.spline)},setTranslate:function(e,t,a){e.controller.control&&e.controller.setTranslate(t,a)},setTransition:function(e,t,a){e.controller.control&&e.controller.setTransition(t,a)}}},{name:"a11y",params:{a11y:{enabled:!0,notificationClass:"swiper-notification",prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",containerMessage:null,containerRoleDescriptionMessage:null,itemRoleDescriptionMessage:null}},create:function(){Ie(this,{a11y:oe(oe({},dt),{},{liveRegion:ke('<span class="'+this.params.a11y.notificationClass+'" aria-live="assertive" aria-atomic="true"></span>')})})},on:{afterInit:function(e){e.params.a11y.enabled&&(e.a11y.init(),e.a11y.updateNavigation())},toEdge:function(e){e.params.a11y.enabled&&e.a11y.updateNavigation()},fromEdge:function(e){e.params.a11y.enabled&&e.a11y.updateNavigation()},paginationUpdate:function(e){e.params.a11y.enabled&&e.a11y.updatePagination()},destroy:function(e){e.params.a11y.enabled&&e.a11y.destroy()}}},{name:"history",params:{history:{enabled:!1,replaceState:!1,key:"slides"}},create:function(){Ie(this,{history:oe({},ct)})},on:{init:function(e){e.params.history.enabled&&e.history.init()},destroy:function(e){e.params.history.enabled&&e.history.destroy()},transitionEnd:function(e){e.history.initialized&&e.history.setHistory(e.params.history.key,e.activeIndex)},slideChange:function(e){e.history.initialized&&e.params.cssMode&&e.history.setHistory(e.params.history.key,e.activeIndex)}}},{name:"hash-navigation",params:{hashNavigation:{enabled:!1,replaceState:!1,watchState:!1}},create:function(){Ie(this,{hashNavigation:oe({initialized:!1},ut)})},on:{init:function(e){e.params.hashNavigation.enabled&&e.hashNavigation.init()},destroy:function(e){e.params.hashNavigation.enabled&&e.hashNavigation.destroy()},transitionEnd:function(e){e.hashNavigation.initialized&&e.hashNavigation.setHash()},slideChange:function(e){e.hashNavigation.initialized&&e.params.cssMode&&e.hashNavigation.setHash()}}},{name:"autoplay",params:{autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!0,stopOnLastSlide:!1,reverseDirection:!1}},create:function(){Ie(this,{autoplay:oe(oe({},ht),{},{running:!1,paused:!1})})},on:{init:function(e){e.params.autoplay.enabled&&(e.autoplay.start(),ue().addEventListener("visibilitychange",e.autoplay.onVisibilityChange))},beforeTransitionStart:function(e,t,a){e.autoplay.running&&(a||!e.params.autoplay.disableOnInteraction?e.autoplay.pause(t):e.autoplay.stop())},sliderFirstMove:function(e){e.autoplay.running&&(e.params.autoplay.disableOnInteraction?e.autoplay.stop():e.autoplay.pause())},touchEnd:function(e){e.params.cssMode&&e.autoplay.paused&&!e.params.autoplay.disableOnInteraction&&e.autoplay.run()},destroy:function(e){e.autoplay.running&&e.autoplay.stop(),ue().removeEventListener("visibilitychange",e.autoplay.onVisibilityChange)}}},{name:"effect-fade",params:{fadeEffect:{crossFade:!1}},create:function(){Ie(this,{fadeEffect:oe({},pt)})},on:{beforeInit:function(e){if("fade"===e.params.effect){e.classNames.push(e.params.containerModifierClass+"fade");var t={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!0};Me(e.params,t),Me(e.originalParams,t)}},setTranslate:function(e){"fade"===e.params.effect&&e.fadeEffect.setTranslate()},setTransition:function(e,t){"fade"===e.params.effect&&e.fadeEffect.setTransition(t)}}},{name:"effect-cube",params:{cubeEffect:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94}},create:function(){Ie(this,{cubeEffect:oe({},mt)})},on:{beforeInit:function(e){if("cube"===e.params.effect){e.classNames.push(e.params.containerModifierClass+"cube"),e.classNames.push(e.params.containerModifierClass+"3d");var t={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,resistanceRatio:0,spaceBetween:0,centeredSlides:!1,virtualTranslate:!0};Me(e.params,t),Me(e.originalParams,t)}},setTranslate:function(e){"cube"===e.params.effect&&e.cubeEffect.setTranslate()},setTransition:function(e,t){"cube"===e.params.effect&&e.cubeEffect.setTransition(t)}}},{name:"effect-flip",params:{flipEffect:{slideShadows:!0,limitRotation:!0}},create:function(){Ie(this,{flipEffect:oe({},ft)})},on:{beforeInit:function(e){if("flip"===e.params.effect){e.classNames.push(e.params.containerModifierClass+"flip"),e.classNames.push(e.params.containerModifierClass+"3d");var t={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!0};Me(e.params,t),Me(e.originalParams,t)}},setTranslate:function(e){"flip"===e.params.effect&&e.flipEffect.setTranslate()},setTransition:function(e,t){"flip"===e.params.effect&&e.flipEffect.setTransition(t)}}},{name:"effect-coverflow",params:{coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}},create:function(){Ie(this,{coverflowEffect:oe({},gt)})},on:{beforeInit:function(e){"coverflow"===e.params.effect&&(e.classNames.push(e.params.containerModifierClass+"coverflow"),e.classNames.push(e.params.containerModifierClass+"3d"),e.params.watchSlidesProgress=!0,e.originalParams.watchSlidesProgress=!0)},setTranslate:function(e){"coverflow"===e.params.effect&&e.coverflowEffect.setTranslate()},setTransition:function(e,t){"coverflow"===e.params.effect&&e.coverflowEffect.setTransition(t)}}},{name:"thumbs",params:{thumbs:{swiper:null,multipleActiveThumbs:!0,autoScrollOffset:0,slideThumbActiveClass:"swiper-slide-thumb-active",thumbsContainerClass:"swiper-container-thumbs"}},create:function(){Ie(this,{thumbs:oe({swiper:null,initialized:!1},vt)})},on:{beforeInit:function(e){var t=e.params.thumbs;t&&t.swiper&&(e.thumbs.init(),e.thumbs.update(!0))},slideChange:function(e){e.thumbs.swiper&&e.thumbs.update()},update:function(e){e.thumbs.swiper&&e.thumbs.update()},resize:function(e){e.thumbs.swiper&&e.thumbs.update()},observerUpdate:function(e){e.thumbs.swiper&&e.thumbs.update()},setTransition:function(e,t){var a=e.thumbs.swiper;a&&a.setTransition(t)},beforeDestroy:function(e){var t=e.thumbs.swiper;t&&e.thumbs.swiperCreated&&t&&t.destroy()}}}];Ue.use(yt);const bt=Ue;I.register("music-app",class extends V{async onSpawn(){if(n().enforceSingleton("music-app",this))return;const t=window.localStorage.getItem("lang")||"en";"en"===Router.currentLang&&"en"!==t&&Router.setLang(t),this.callbacks={appReady:{fns:[],done:0}},this.modal=e,this.boundOnPlayerStateChange=this.onPlayerStateChange.bind(this),Bridge.ipcListen("option-change",this.boundOnOptionChange),Player.on("stateChange",this.boundOnPlayerStateChange),n(".tooltip").on("mouseover",n("music-app").el(),$)}async onBuild(){await this.preLoadQueries(),this.registerEventHandlers(),await this.autoConnectOrLock()&&(this.innerHTML=await h("/elements/music-app/music-app.html"))}async onLoad(){this.isConnectionLockScreenShowing()||await this.loadApp()}onRemoved(){this.removeCommonEventHandlers(),Bridge.removeListener("option-change",this.boundOnOptionChange),Player.off("stateChange",this.boundOnPlayerStateChange)}async preLoadQueries(){await this.injectCustomCss(),await this.setColors()}async loadApp(){"darwin"===n(this).attr("os")&&this.registerMediaKeyListeners(),setTimeout((()=>{this._appIsReady()}),0)}async _appIsReady(){this.setMainDotMenuItems();let e=window.localStorage.getItem("start_page")||"/explore-music";window.Router.go(e,!0);for(let e of this.callbacks.appReady.fns)e();this.injectFavoriteGenres(),Bridge.wsListen("server-to-client-instruction",(e=>{"remote-playback-control"===e.instruction&&Player[e.command]()})),this.sendStateToServer()}registerEventHandlers(){this.registerCommonEventHandlers(),n(".slidetoggle .label").on("click",this,(function(e){n(this).closest(".slidetoggle").toggleClass("open")}))}getContextMenuItems(){let e=[{group:y("music-app.context-menu.group-name"),items:{[y("music-app.context-menu.settings")]:{cb:e=>{n("music-settings").el().openSettingsPanel(),ContextMenu.closeAllContextMenus()}}}}];return n(this).hasClass("developer-mode")&&e.push({group:"Developer",items:{[y("context-menu.toggle-dev-tools")]:{cb:e=>{if("electron"!==n("#app").attr("env"))return console.warn("Developer tools only supported in Electron");Bridge.ipcSay("open-dev-tools","mainPlayer"),ContextMenu.closeAllContextMenus()}},[y("context-menu.inspect-element")]:{cb:e=>{if("electron"!==n("#app").attr("env"))return console.warn("Developer tools only supported in Electron");let t=n(e).position();Bridge.ipcSay("dev-tools-inspect",{x:Math.round(t.x),y:Math.round(t.y)}),ContextMenu.closeAllContextMenus()}}}}),e}setMainDotMenuItems(){n("#main-dot-menu").el().addMenuItems("start",{group:y("app-name"),items:{[y("system-menu.check-for-updates")]:{icon:"parachute-box",cb:(e,t)=>{if("electron"!==n("#app").attr("env"))return console.warn("Updating only supported in Electron");Bridge.ipcSay("check-for-updates-and-prompt"),ContextMenu.closeAllContextMenus()}}}})}async registerMediaKeyListeners(){return"electron"!==n("#app").attr("env")||(!!await Bridge.ipcAsk("register-media-key-listeners")||(console.log("%cMedia key listeners could not be registered","color:#d24848;"),this.notify({id:"media-key-accessibility-dialogue",title:y("media-keys-need-permission.notification.title"),message:`${y("media-keys-need-permission.notification.message")}`,onClick:async()=>{Bridge.ipcSay("ask-for-accessibility-permission")}}),!1))}on(e,t){this.callbacks[e].done?t():this.callbacks[e].fns.push(t)}notify(e){!function(e){let t="",a="level-1";"id"in e&&(t=e.id),"level"in e&&(a=`level-${e.level}`),n("#theme-notifications").prependHtml(`\n    <div id="${t}" class="theme-notification ${a}">\n      <button class="body">\n        <div tabindex="-1">\n          <p class="title">${e.title}</p>\n          <div class="message">${e.message}</div>\n        </div>\n      </button>\n      <button class="remove"><i class="fas fa-times-circle" tabindex="-1"></i></button>\n    </div>\n  `);let i=n("#theme-notifications").firstChild();"onClick"in e&&i.el().addEventListener("click",(t=>{e.onClick(t)})),i.find("button.remove").el().addEventListener("click",(e=>{e.stopPropagation(),n(e.target).closest(".theme-notification").remove()}))}(e)}onPlayerStateChange(e){this.sendStateToServer()}async injectFavoriteGenres(e=[]){if(e.length||(e=await Bridge.ipcAsk("get-option","favorite_genres")),Array.isArray(e)){let t=n(this).find(".favorite-genres");t.html("");for(let a of e)t.appendHtml(`<genre-tag genreid="${a}" small></genre-tag>`)}}async showOpenSource(){B(this,await h("/elements/music-app/modals/open-source.html"))}async showAbout(){let e=await Bridge.ipcAsk("get-app-package"),t={name:y(e.name),version:"v"+e.version,description:e.description,homepage:e.homepage};B(this,await h("/elements/music-app/modals/about.html",t))}sendStateToServer(){let e=Player.getCurrentPlaybackTime(),t=n("playback-controls .current").attr("data-seconds"),a=n("playback-controls .current").el().innerText;"number"==typeof e&&(t=e,a=n().convertSecondsToHHMMSS(Math.floor(e)));let i={mode:Player.mode,track:Player.trackObj,currentSeconds:t,currentTime:a,totalTime:"0:00",muted:Player.muted,state:Player.state,repeat:Player.repeat,shuffle:Player.shuffle,queue:Player.queue};"playing"!==Player.state&&"paused"!==Player.state||(i.totalTime=Player.trackObj.track_duration_formatted),console.log("Sending client state to server",i),Bridge.wsSay("client-to-server-state-update",i)}}),I.register("server-connect",class extends I{async onSpawn(){this.formSelector="form#create-server-connection",this.defaultServer=await n("music-app").el().getDefaultServer();let e=await new v({table:"servers",itemsPerPage:-1,mode:"ipc",prefix:"music_"});this.allServers=e.results}async onBuild(){this.innerHTML=await h("/elements/server-connect/server-connect.html")}async onLoad(){X(this.querySelector("#create-server-connection")),n(this.formSelector).el().addEventListener("submit",this.onConnectionFormSubmit.bind(this)),n(this).attr("message")&&this.setMessage(n(this).attr("message")),this.autoFillForm()}async onRemoved(){}autoFillForm(){if(!this.defaultServer)return;let e=this.allServers.filter((e=>e.id===this.defaultServer.id));e.length&&(e=e[0],n(this).find('input[name="host"]').value(e.server_host),n(this).find('input[name="port"]').value(e.server_port_http))}async onConnectionFormSubmit(e){if(e.preventDefault(),this.hideMessage(),!function(e){let t=!0,a=[];if(n(e).each((e=>{e.matches("form")?(n(e).find(".submission-error").remove(),n(e).find("input, select, textarea").each((e=>{a.push(e)}))):a.push(e)})),!a.length)return null;for(let e of a){let a=n(e),s=a.closest(".field"),r=!0;s.hasClass(Q)?t=!1:a.hasClass("req")&&(e.matches("textarea")&&""===a.value().trim()&&(r=!1),e.matches("select")&&""===a.value().trim()&&(r=!1),e.matches("input")&&"text"===a.attr("type")&&""===a.value().trim()&&(r=!1),e.matches("input")&&"file"===a.attr("type")&&(e.files&&e.files.length||(r=!1)),r||(s.addClass(Q),(e.matches("textarea")||e.matches('input[type="text"]'))&&e.addEventListener("blur",i),t=!1))}function i(e){n(e.target).value()&&(n(e.target).closest(".validation-error").removeClass(Q),e.target.removeEventListener("blur",i))}return t}(this.formSelector))return;n(this.formSelector).addClass("loading");const t=function(e){let t={};if(n(e).find("input, select, textarea").each((e=>{t[n(e).attr("name")]=n(e).value()})),n(e).find('input[name="date-dd"]').els.length&&n(e).find('input[name="date-mm"]').els.length&&n(e).find('input[name="date-yyyy"]').els.length){let a=n(e).find('input[name="date-dd"]').value(),i=n(e).find('input[name="date-mm"]').value(),s=n(e).find('input[name="date-yyyy"]').value();a&&i&&s&&(t["date-ms"]=Date.parse(`${s}-${i}-${a}`),t["date-dd-mm-yyyy"]=`${a}-${i}-${s}`)}for(let[e,a]of Object.entries(t))if(a instanceof FileList)for(let i=0;i<a.length;i++){let s=a.item(i);t[e]=s.path}return t}(n(this.formSelector).el()),a=document.querySelector("music-app");if(console.log(`Attempting to connect to server at ${t.host}:${t.port}`),!await a.connectToServer(t.host,t.port))return console.log("Connection failed"),n(this.formSelector).removeClass("loading"),void this.setMessage("connection-failed");let i,s=await new v({table:"servers",columns:{server_host:t.host,server_port_http:t.port},mode:"ipc",prefix:"music_"});s.results.length?i=s.results[0].id:(i=(await this.saveServerDetails(t.host,t.port)).id,console.log("Saved server details in database")),console.log("server-connect using server ID",i),await a.getDefaultServer()||await Bridge.ipcAsk("set-option",{option:"default_server",value:i}),n(this.formSelector).removeClass("loading").addClass("success"),setTimeout((()=>{this.reloadApp()}),1e3)}async saveServerDetails(e,t){return await Bridge.ipcAsk("db-api",{fn:"createRow",args:["servers",{server_name:null,server_host:e,server_port_http:t,server_port_websockets:parseInt(t)+1,server_first_connected:Date.now(),server_last_connected:Date.now()}]})}reloadApp(){console.log("Reloading app after successful server connection"),document.querySelector("music-app").render()}setMessage(e){switch(this.hideMessage(),e){case"autoconnect-failed":n(this).find(".autoconnect-failed-message").show();break;case"connection-failed":n(this).find(".connection-failed-message").show()}}hideMessage(){n(this).find(".message").hide()}}),I.register("music-settings",class extends te{onSpawn(){n().enforceSingleton("music-settings",this)||(this.boundEscKeyHandler=this.onEscKey.bind(this))}async onBuild(){let e=this.getFieldTemplates();this.innerHTML=await h("/elements/music-settings/music-settings.html",e)}async onLoad(){this.setMainDotMenuItems(),this.tabs=new Y({selector:".settings-panel .tabs"}),this.formSetup(),this.querySelector(".close").addEventListener("click",(()=>{this.close()})),n("[data-settings]").on("click",this.closest("music-app"),this.boundOnDataSettingsAttrClick),window.addEventListener("keyup",this.boundEscKeyHandler)}onRemoved(){window.removeEventListener("keyup",this.boundEscKeyHandler)}setMainDotMenuItems(){document.querySelector("#main-dot-menu")&&n("#main-dot-menu").el().addMenuItems("start",{group:y("app-name"),items:{[y("settings.main-dot-menu")]:{icon:"atom",cb:(e,t)=>{this.openSettingsPanel(),ContextMenu.closeAllContextMenus()}}}})}onEscKey(e){"Escape"===e.key&&n(this).find(".settings-panel").hasClass("open")&&this.close()}close(){n("music-app").removeClass("settings-open"),n(".settings-panel").removeClass("open");for(let e of this._callbacks.onClose)e();n().releaseFocus()}}),I.register("context-menu",ie),window.ContextMenu=ie,I.register("search-bar",class extends I{async onBuild(){this.innerHTML=await h("/elements/search-bar/search-bar.html")}onLoad(){this.registerEventListeners(),this.querySelector('input[type="search"]').addEventListener("focus",(e=>{n(e.target).parents(".input-outer").addClass("focused")})),this.querySelector('input[type="search"]').addEventListener("blur",(e=>{n(e.target).parents(".input-outer").removeClass("focused")}))}registerEventListeners(){let e=this.querySelector('input[type="search"]');e.addEventListener("keyup",(async t=>{let a=e.value.trim();if(""===a||a.length<2)return void this.restoreDefaultSidebarState();let i=await this.query(a);this.renderResults(i)})),e.addEventListener("focus",(e=>{n("#nav-pillar #search-typing-results .results, #nav-pillar #search-typing-results .no-results").els.length&&n("#nav-pillar").addClass("showing-search-results");const t=e=>{e.target.matches("search-bar")||e.target.closest("search-bar")||e.target.matches("#search-typing-results")||e.target.closest("#search-typing-results")||(n("#nav-pillar").removeClass("showing-search-results"),document.removeEventListener("mousedown",t))};document.addEventListener("mousedown",t)})),n(this).find("form#search").on("submit",(e=>{e.preventDefault()}))}async query(e){let t=await Bridge.httpApi(`/search?q=${e}`);if(200===t.status)return t.response;console.warn("Something went wrong when searching.")}restoreDefaultSidebarState(){n("#nav-pillar").removeClass("showing-search-results"),n("#nav-pillar #search-typing-results").html("")}renderResults(e){const t=n("#nav-pillar"),a=t.find("#search-typing-results");t.addClass("showing-search-results"),a.html("");let i=!0;for(let t in e)Array.isArray(e[t])&&e[t].length&&(i=!1);if(i)return void a.appendHtml(`<h5 class="no-results">${y("search.no-results")}</h5>`);const s=["genres","artists","musicReleases","playlists","tracks"];for(let t of s)if(Array.isArray(e[t])&&e[t].length){a.appendHtml(`\n        <div class="results" data-group="${t}">\n          <h5 class="group-title">${y(`search.group-title.${t}`)}</h5>\n        </div>\n      `);for(let a of e[t])this._injectSingleResult(a,t)}}_injectSingleResult(e,t){let a=n(`#search-typing-results .results[data-group="${t}"]`);switch(t){case"artists":a.appendHtml(`\n          <p class="result">\n            <a href="/artist/${e.id}" class="router-link">\n              <span tabindex="-1">${e.artist_name}</span>\n            </a>\n          </p>\n        `);break;case"musicReleases":a.appendHtml(`\n          <p class="result">\n            <a href="/music-release/${e.id}" class="router-link">\n              <span tabindex="-1">${e.release_title}</span>\n            </a>\n          </p>\n        `);break;case"tracks":a.appendHtml(`\n          <p class="result">\n            <a href="/music-release/${e.track_release_id}" class="router-link">\n              <span tabindex="-1">${e.track_title}</span>\n            </a>\n          </p>\n        `);break;case"genres":a.appendHtml(`\n          <genre-tag genreid="${e.id}" small></genre-tag>\n        `);break;case"playlists":a.appendHtml(`\n          <p class="result">\n            <a href="/playlist/${e.id}" class="router-link">\n              <span tabindex="-1">${e.playlist_name}</span>\n            </a>\n          </p>\n        `)}}}),I.register("dot-menu",class extends I{shouldBuild(){return!0}async onSpawn(){this.items=[]}async onBuild(){n(this).removeClass("open"),this.innerHTML=await h("/elements/dot-menu/dot-menu.html"),this.registerEventHandlers()}registerEventHandlers(){this.addEventListener("click",(e=>{this.handleClick(e)})),this.addEventListener("keydown",(e=>{"Space"===e.code&&(e.preventDefault(),this.handleClick(e,!0))})),this.querySelector(".dot._1").addEventListener("animationend",(e=>{let t=n(e.target).closest("dot-menu");t.removeClass("orbit"),t.hasClass("open")&&setTimeout((()=>{t.addClass("orbit")}),0)}))}async handleClick(e,t=!1){if(n(this).hasClass("open")&&e.path.includes(this))return;n("context-menu").els.length&&(n("dot-menu.open").removeClass("open"),n("context-menu").remove()),n(this).hasClass("animates")&&this.startAnimation();let a=n(this).position(),i=n(this).attr("position")||"top-left",s=await this.getContextMenuObject();a.x=a.x+.5*this.offsetWidth,a.y=a.y+.5*this.offsetHeight;let r="",o=n(this).attr("id");o&&(r="context-menu-for-"+o);let l=["dot-menu-dropdown"],d=n(this).attr("context-menu-classes");d&&d.split(" ").forEach((e=>{l.push(e)})),await ContextMenu.create(e,{id:r,classes:l.join(" "),position:a,items:s,origin:i}),n("context-menu.dot-menu-dropdown").el().dotMenuReference=this,n(this).addClass("open");const c=e=>{let t=["context-menu","dot-menu"],a=!0;for(let i of t)(n(e.target).parents(i).els.length||e.target.matches(i))&&(a=!1);a&&(ContextMenu.closeAllContextMenus(".dot-menu-dropdown"),document.removeEventListener("click",c),n("dot-menu").removeClass("open"))};document.addEventListener("click",c),t&&n(".dot-menu-dropdown").find(".context-menu-item").els[0].focus()}startAnimation(){n(this).addClass("orbit")}async getContextMenuObject(){let e={};if(this.items)for(let t of this.items)t.group in e?e[t.group]={...e[t.group],...t.items}:e[t.group]=t.items;return n(this).hasClass("standalone")||(e={...await ContextMenu.buildAncestralMenuItemsObject(this),...e}),e}addMenuItems(e,t){"start"===e?this.items.unshift(t):"end"===e&&this.items.push(t)}removeMenuItem(e){for(let t in this.items)this.items[t].callbackName===e&&this.items.splice(t,1)}mainDotMenuSettings(){n("music-settings").el().invokeModal()}}),I.register("playback-controls",class extends I{async onSpawn(){this._currentTimeInterval=null,this._updatesPerSecond=4,this._waveformDelay=2e3,this._currentWaveformTimeout=null,Player.on("stateChange",(e=>{this.changeState(e)})),Player.on("trackChange",(e=>{this.onTrackChange(e)}))}async onBuild(){this.innerHTML=await h("/elements/playback-controls/playback-controls.html")}onLoad(){this._currentlyPlayingDiv=this.querySelector(".currently-playing"),this._scrubberButtonEl=this.querySelector("button.scrubber"),this._repeatButtonEl=this.querySelector("button.repeat"),this._shuffleButtonEl=this.querySelector("button.shuffle"),this._previousButtonEl=this.querySelector("button.-previous"),this._nextButtonEl=this.querySelector("button.-next"),this._playPauseButtonEl=this.querySelector("button.-playPause"),this._muteButtonEl=this.querySelector("button.mute"),this._currentPlaybackTimeEl=this.querySelector(".time .current"),this._trackDurationEl=this.querySelector(".time .duration"),this._queueButtonEl=this.querySelector("button.queue"),this._progressBarEl=this.querySelector(".progress"),this._waveformContainerEl=this.querySelector(".waveform-container"),this.registerButtonCallbacks(),this.changeState(Player.state)}async changeState(e){switch(n(this).removeClass("playing","paused","stopped","loading"),e){case"playing":if(!Player.trackObj)throw new Error("global Player object is missing trackObj property");n(this._currentlyPlayingDiv).find("track-block").attr("trackid")!==Player.currentlyPlayingId&&this.setCurrentlyPlayingTrackBlock(),n(this._trackDurationEl).html(n().convertSecondsToHHMMSS(Player.trackObj.track_duration,!0,!0)),n(this).addClass("playing"),this.syncPlayButton(),this.beginTimeUpdating();break;case"paused":n(this).addClass("paused"),this.syncPlayButton();break;case"stopped":n(this).addClass("stopped"),this.syncPlayButton(),this.removeCurrentlyPlayingTrackBlock(),n(this._currentlyPlayingDiv).html(""),n(this._currentPlaybackTimeEl).html("0:00"),n(this._trackDurationEl).html("0:00"),n(this._progressBarEl).removeAttr("style"),clearInterval(this._currentTimeInterval);break;case"loading":this.setCurrentlyPlayingTrackBlock(),n(this).addClass("loading"),this.syncPlayButton()}}async onTrackChange(e){if("stopped"!==Player.state){if(!Player.trackObj)throw new Error("global Player object is missing trackObj property");n(this._trackDurationEl).html(n().convertSecondsToHHMMSS(Player.trackObj.track_duration,!0,!0)),this.beginTimeUpdating(),clearTimeout(this._currentWaveformTimeout),n(this._waveformContainerEl).find("canvas").els.length&&n(this._waveformContainerEl).find("canvas").remove()}}setCurrentlyPlayingTrackBlock(){let e=n(this).find(".currently-playing track-block");e.els.length?e.attr("trackid",Player.currentlyPlayingId):n(this._currentlyPlayingDiv).html(`<track-block trackid="${Player.currentlyPlayingId}" class="readonly xs"></track-block>`)}removeCurrentlyPlayingTrackBlock(){n(this._currentlyPlayingDiv).find("track-block").remove()}syncPlayButton(){"playing"===Player.state?n(this._playPauseButtonEl).find("i").removeClass("fa-play").addClass("fa-pause"):("paused"===Player.state||"loading"===Player.state||"stopped"===Player.state)&&n(this._playPauseButtonEl).find("i").removeClass("fa-pause").addClass("fa-play")}registerButtonCallbacks(){this._playPauseButtonEl.addEventListener("click",(e=>{"playing"===Player.state?Player.pause():("paused"===Player.state||"stopped"===Player.state&&Player.queue.length)&&Player.play()})),this._previousButtonEl.addEventListener("click",(e=>{Player.previous()})),this._nextButtonEl.addEventListener("click",(e=>{Player.next()})),this._shuffleButtonEl.addEventListener("click",(e=>{Player.shuffle?(n(this).removeClass("shuffle-on"),Player.setShuffle(!1)):(n(this).addClass("shuffle-on"),Player.setShuffle(!0))})),this._repeatButtonEl.addEventListener("click",(e=>{!1===Player.repeat?(Player.setRepeat("track"),n(this).removeClass("repeat-track","repeat-queue"),n(this).addClass("repeat-track")):"track"===Player.repeat?(Player.setRepeat("queue"),n(this).removeClass("repeat-track","repeat-queue"),n(this).addClass("repeat-queue")):"queue"===Player.repeat&&(Player.setRepeat(!1),n(this).removeClass("repeat-track","repeat-queue"))})),this._muteButtonEl.addEventListener("click",(e=>{Player.muted?(n(this).removeClass("muted"),Player.unmute()):(n(this).addClass("muted"),Player.mute())})),this._queueButtonEl.addEventListener("click",(e=>{n("music-app").toggleClass("queue-open")})),this._scrubberButtonEl.addEventListener("mousedown",(e=>{if(1!==e.which)return;if("stopped"===Player.state)return;let t=n(this).position().x;const a=e=>{this.stopTimeUpdating();let a=e.x-t;this._scrubberButtonEl.classList.add("dragging"),this._progressBarEl.setAttribute("style",`width:${a}px`);let i=Player.trackObj.track_duration,s=i*(a/this._scrubberButtonEl.clientWidth);this.querySelector(".scrubber-time").innerHTML=`\n          <span class="drag-time" data-seconds="${s}">\n            ${n().convertSecondsToHHMMSS(s)} / ${n().convertSecondsToHHMMSS(i)}\n          </span>`},i=e=>{if(n(e.target).parents(".scrubber").els.length){let e=this._scrubberButtonEl.querySelector(".drag-time");if(e){let t=e.getAttribute("data-seconds");Player.seek(t)}}this.beginTimeUpdating(),n(this._scrubberButtonEl).removeClass("expanded","dragging"),document.removeEventListener("mouseup",i),this._scrubberButtonEl.removeEventListener("mousemove",a)};n(this._scrubberButtonEl).addClass("expanded"),this._scrubberButtonEl.addEventListener("mousemove",a),document.addEventListener("mouseup",i)}))}beginTimeUpdating(){let e=this._currentPlaybackTimeEl;this.stopTimeUpdating(),this._currentTimeInterval=setInterval((()=>{if("stopped"===Player.state)throw new Error("Interval should be destroyed when the music is stopped, find your bug.");if(!Player.trackObj)return void console.log("<playback-controls> time updating interval is waiting for track to load");let t=Player.getCurrentPlaybackTime();n(e).attr("data-seconds",t),n(e).html(n().convertSecondsToHHMMSS(Math.floor(t)));let a=t/Player.trackObj.track_duration*100;a=a.toFixed(4),n(this._progressBarEl).css({width:`${a}%`})}),1e3/this._updatesPerSecond)}stopTimeUpdating(){clearInterval(this._currentTimeInterval)}drawWaveform(e){this._waveformContainerEl.innerHTML='<canvas class="waveform"></canvas>';const t=this._waveformContainerEl.querySelector("canvas");let a=0,i=0;a=t.closest("div").clientWidth,i=60,t.width=a,t.height=60;const s=t.getContext("2d");s.translate(0,30);const n=a/e.length;function r(e,t,a,i){let s=Math.abs(i*a);e.beginPath(),e.lineWidth=1,e.strokeStyle="#8b8b8b",e.moveTo(t,0),e.lineTo(t,s),e.moveTo(t,0),e.lineTo(t,"-"+s),e.stroke()}for(let t=0;t<e.length;t++)r(s,n*t,e[t],60)}}),I.register("playback-queue",class extends I{async onSpawn(){Player.on("stateChange",(e=>{"stopped"===e&&this.buildQueue()})),Player.on("trackChange",(e=>{this._needToRebuildQueueItems()&&this.buildQueue(),this.setQueueItemClasses(),this.setQueueItemCountAndDuration()})),Player.on("controlChange",(()=>{this._onPlayerControlChange()})),Player.on("queueChange",(()=>{this.buildQueue()}))}async onBuild(){this.innerHTML=await h("/elements/playback-queue/playback-queue.html")}async onLoad(){this.registerEventHandlers(),this.buildQueue()}setQueueItemContextMenuItems(){n(this).find(".queue li").each((e=>{e.getContextMenuItems=()=>[{group:y("queue.context-menu.group-name"),items:{[y("queue.context-menu.remove-from-queue")]:{cb:async(e,t)=>{let a=e.matches("playback-queue .queue li")?e:e.closest("playback-queue .queue li"),i=n(a).attr("data-index");Player.remove(i),ContextMenu.closeAllContextMenus()}}}}],e.classList.add("has-context-menu-items")}))}registerEventHandlers(){n(this).find("button.clear").on("click",(()=>{Player.clearQueue()}))}registerQueueItemEventHandlers(e){se({dragEl:e,dragoverEl:e,dropEl:e,dragImage:e.querySelector("track-block"),onDrag:e=>{if(Player.shuffle)return e.preventDefault(),!1},onDrop:(e,t)=>{let a=n(t);a.removeClass("current-item","previous-item","upcoming-item");let i=a.before();(i.hasClass("upcoming-item")||i.hasClass("current-item"))&&a.addClass("upcoming-item"),this.registerQueueItemEventHandlers(a.el()),this.syncPlayerOrderWithQueueOrder(),this.setQueueItemIndexes()}}),e.addEventListener("dblclick",(t=>{if(1!==t.which)return;let a=n(e).find("track-block").attr("trackid");Player.playItemInQueue(Player.queue.indexOf(a))}))}syncPlayerOrderWithQueueOrder(){let e=[];n(this).find(".queue li").each((t=>{e.push(n(t).find("track-block").attr("trackid"))})),Player.silentlyUpdateQueue(e)}setQueueItemIndexes(){let e=0;n(this).find(".queue li").each((t=>{n(t).attr("data-index",e),e++}))}async getTracksDuration(e){let t=0,a=await new v({table:"music_tracks",itemsPerPage:-1,columns:{id:e},equalityOperator:"IN"});if(!a.results.length)throw new Error("<playback-queue> could not find tracks in database.");for(let e of a.results)t=e.track_duration+t;return t}async getUpcomingTracksDuration(){let e=[];return n(this).find(".upcoming-item track-block").each((t=>{e.push(n(t).attr("trackid"))})),e.length?await this.getTracksDuration(e):0}_onPlayerControlChange(){this._maybeSetShuffleMode(),this.setQueueItemCountAndDuration()}_maybeSetShuffleMode(){Player.shuffle?(n(this).addClass("shuffling"),this.scrollToCurrentTrack()):n(this).removeClass("shuffling")}_needToRebuildQueueItems(){let e=!1,t=n(this).find(".queue li track-block");return!t.els.length&&0!==Player.queue.length||(t.each(((t,a)=>{Player.queue[a]!==n(t).attr("trackid")&&(e=!0)})),e)}scrollToCurrentTrack(){let e=this.querySelector("li.current-item");if(!e)return;let t=e.offsetTop-this.querySelector(".queue").offsetHeight/2+40;t<0&&(t=0),this.querySelector(".queue").scrollTo(0,t)}setQueueItemClasses(){if(n(this).find("li").removeClass("previous-item","current-item","upcoming-item"),"stopped"===Player.state)return void n(this).find(".queue li").addClass("upcoming-item");n(this).find(`.queue li:nth-of-type(${Player.currentQueueItemIndex+1})`).addClass("current-item");let e=!1;n(this).find(".queue li").each((t=>{let a=n(t);a.hasClass("current-item")?e=!0:e?e&&a.addClass("upcoming-item"):a.addClass("previous-item")})),Player.shuffle&&this.scrollToCurrentTrack()}async setQueueItemCountAndDuration(){let e=n(this).find(".num-tracks"),t=n(this).find(".queue-duration"),a=n(this).find(".upcoming-item").els.length,i="";if(Player.shuffle||Player.repeat)Player.shuffle&&(i=1===Player.queue.length?y("queue.num-in-queue-singular"):y("queue.num-in-queue"),e.html(i.replace("{{n}}",Player.queue.length)),t.addClass("hidden"));else{let s=await this.getUpcomingTracksDuration();i=y(1===a?"queue.num-in-queue-singular":"queue.num-in-queue"),e.html(i.replace("{{n}}",a)),t.html(n().convertSecondsToHHMMSS(s)),t.removeClass("hidden")}}buildQueue(){if(!Player.queue.length)return n(this).addClass("empty"),void n(this).find(".queue").html("");let e=Player.queue;n(this).removeClass("empty"),n(this).find(".queue").html("");for(let t of e)n(this).find(".queue").appendHtml(`\n        <li draggable="true">\n          <div class="borders">\n            <track-block trackid="${t}" lazy-render class="has-duration show-content-loading"></track-block>\n          </div>\n        </li>\n      `);this.setQueueItemClasses(),this.setQueueItemCountAndDuration(),this.setQueueItemContextMenuItems(),this.setQueueItemIndexes(),n(this).find("ol.queue li").each((e=>{this.registerQueueItemEventHandlers(e)}))}}),I.register("system-menu",class extends I{async onSpawn(){this.clickOutsideToCloseListener=this.clickOutsideToClose.bind(this),this.type=n(this).attr("type"),this.watchAttr(["type"],(()=>this.render()))}async onBuild(){this.innerHTML=await h("/elements/system-menu/system-menu.html");let e=JSON.parse(await Bridge.ipcAsk("get-system-menu")),t=n(this).find("ul.system-menu");for(let a of e){let e=n(this).getTemplate(".top-level-item");n(e).find(".label").text(a.label);for(let t of a.submenu)if(!1!==t.visible)if("separator"===t.type){let t=n(this).getTemplate(".sep");n(e).find(".second-level-menu").appendHtml(t)}else{let a=n(this).getTemplate(".second-level-item");t.label&&n(a).find(".label").text(t.label);let i=t["win32-accelerator-label"]||t.accelerator||null;i&&n(a).find(".accelerator").text(i),n(a).find("li.second-level-item").attr("menu-item-id",t.id||""),n(e).find(".second-level-menu").appendHtml(a)}t.appendHtml(e)}this.registerEventListeners()}async onLoad(){}async onRemoved(){n("music-app").el().removeEventListener("click",this.clickOutsideToCloseListener)}clickOutsideToClose(e){if(n(e.target).parents("system-menu").els.length)return;let t=n(this).find(".top-level-item.open");t.els.length&&t.removeClass("open")}registerEventListeners(){n("music-app").el().addEventListener("click",this.clickOutsideToCloseListener),n(this).find(".top-level-item").each((e=>{e.addEventListener("keyup",(function(e){console.log("keyup",e),"Tab"!==e.key&&"Shift"!==e.key&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),n(this).closest("system-menu").el().closeAll(),"Space"===e.code&&n(this).addClass("open"))})),e.addEventListener("click",(function(e){n(this).toggleClass("open")})),e.addEventListener("mouseenter",(function(e){let t=n(this).closest("system-menu");t.find(".top-level-item.open").els.length&&(t.el().closeAll(),n(this).addClass("open"))}))})),n(this).find(".second-level-item[menu-item-id]").each((e=>{e.addEventListener("click",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();let t=n(this).attr("menu-item-id");Bridge.ipcSay("trigger-system-menu-item",t),n(this).closest("system-menu").el().closeAll()})),e.addEventListener("keyup",(function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),"Tab"===e.key||"Shift"===e.key)return;let t=n(this).attr("menu-item-id");Bridge.ipcSay("trigger-system-menu-item",t)}))}))}closeAll(){n(this).find(".top-level-item.open").removeClass("open")}}),I.register("play-button",class extends I{async onSpawn(){this.boundPlaybackChangeHandler=this.syncWithPlayback.bind(this),Player.on("stateChange",this.boundPlaybackChangeHandler),Player.on("trackChange",this.boundPlaybackChangeHandler)}async onBuild(){this.innerHTML=await h("/elements/play-button/play-button.html")}onLoad(){this.registerEventHandlers(),this.syncWithPlayback()}onRemoved(){Player.off("stateChange",this.boundPlaybackChangeHandler),Player.off("trackChange",this.boundPlaybackChangeHandler)}registerEventHandlers(){this.addEventListener("click",(e=>{let t=n(this).attr("state");"playing"!==t?"paused"!==t?"simple"!==n(this).attr("mode")?n(this).attr("trackid")?this.playTrack():n(this).attr("albumid")?this.playAlbum():n(this).attr("artistid")?this.playArtist():n(this).attr("playlistid")?this.playPlaylist():n(this).attr("ids")&&this.playIds():this.closest("track-block").play():Player.resume():Player.pause()}))}playTrack(){let e=n(this).attr("trackid");Player.play([e])}async playAlbum(){let e=n(this).attr("albumid"),t=await new v({table:"music_tracks",itemsPerPage:-1,columns:{track_release_id:e},orderBy:{track_disc:"ASC",track_num:"ASC"}}),a={},i=[];for(let e of t.results){let t="object"==typeof e.trackdisk&&"no"in e.trackdisk&&null!==e.trackdisk.no?e.trackdisk.no:1;t in a||(a[t]=[]),a[t].push(e.id)}for(let[e,t]of Object.entries(a))t.forEach((e=>i.push(e)));Player.play(i)}async playArtist(){let e=n(this).attr("artistid"),t=(await new v({table:"music_tracks",itemsPerPage:-1,columns:{track_artist_id:e},orderBy:{track_date:"DESC",track_num:"ASC"}})).results.map((e=>e.id));Player.play(t)}async playPlaylist(){let e=n(this).attr("playlistId"),t=await new v({table:"music_playlists",columns:{id:e}});if(!t.results.length)throw new Error(`<play-button> could not find playlist with ID ${e} in the database.`);let a=t.results[0];!a.playlist_track_ids||Array.isArray(a.playlist_track_ids)&&!a.playlist_track_ids.length||Player.play(a.playlist_track_ids)}playIds(){let e=n(this).attr("ids");Player.play(e)}async syncWithPlayback(){let e;if("stopped"===Player.state||"loading"===Player.state)e=!1;else if(n(this).attr("albumid"))n(this).attr("albumid")===Player.trackObj.track_release_id&&(e=!0);else if(n(this).attr("playlistid")){let t=n(this).attr("playlistid"),a=await new v({table:"music_playlists",columns:{id:t}});if(!a.results.length)throw new Error("<play-button> could not find the playlist in the database.");JSON.stringify(a.results[0].trackids)===JSON.stringify(Player.queue)&&(e=!0)}else n(this).attr("trackid")&&(e=n(this).attr("trackid")===Player.currentlyPlayingId);e?n(this).attr("state",Player.state):n(this).removeAttr("state")}}),I.register("control-group",class extends I{onSpawn(){n(this).attr("active",!1),n(this).watchAttrs(["items"],(()=>{this.render()}))}async onBuild(){this.innerHTML=await h("/elements/control-group/control-group.html");let e=n(this).attr("items");if("object"==typeof e)for(let t of e)switch(t.type){case"buttons":n(this).appendHtml(`<p class="label">${t.label}</p>`),n(this).appendHtml(`<ul data-group="${t.group}" data-aria-change-announcement="${t.ariaAssertiveChangeMessage}"></ul>`);for(let e in t.buttons){let a=n(this).find("template.li-item").getTemplate();n(a).find("li").attr("data-value",e),n(a).find("li button").html(t.buttons[e]),n(this).find(`ul[data-group="${t.group}"]`).appendHtml(a)}break;case"cycle-button":let e=n(this).find(".icon-item").getTemplate();n(e).find("button").attr("title",t.title).attr("data-cycle",t.cycle).attr("data-current-icon",t.cycle[0].icon).attr("data-current-values",t.cycle[0].values),n(e).find("i").addClass("fas",`fa-${t.cycle[0].icon}`),n(this).appendHtml(e)}}onLoad(){this.registerEventListeners(),this.setKeyboardListeners()}registerEventListeners(){n(this).find("li").each((e=>{e.addEventListener("mouseup",(e=>{let t=e.target.closest("[data-group]");this.handleTextualButtonClick(e,t)}))})),n(this).find("button.icon-button").each((e=>{let t=this;e.addEventListener("mousedown",(function(e){2!==e.button&&n(this).addClass("mousedown")})),e.addEventListener("mouseup",(function(e){2!==e.button&&(n(this).removeClass("mousedown"),n(t).attr("last-used-icon-button-values",n(this).attr("data-current-values")),t.cycleIconButton(this),t.sendControlStateToAllBeingControlled(this))})),e.addEventListener("mouseleave",(function(e){n(this).removeClass("mousedown")}))}))}setKeyboardListeners(){n(this).find("li button").each((e=>{e.addEventListener("keydown",(e=>{"Space"===e.code&&n(e.target.closest("li")).trigger("mouseup")}))}))}handleTextualButtonClick(e,t){if(2===e.button)return;if(n(e.target).hasClass("active")){n(e.target).removeClass("active"),this.sendControlStateToAllBeingControlled();let a=n(t).closest("[data-group]").attr("data-group");return void this.ariaAnnounce(y("aria.announcement.control-group.all-buttons-unclicked").replace("{{group}}",a))}n(t).find(".active").removeClass("active"),n(e.target).addClass("active"),this.sendControlStateToAllBeingControlled();let a=n(e.target).attr("data-value"),i=n(t).attr("data-aria-change-announcement").replace("{{order}}",a);this.ariaAnnounce(i)}cycleIconButton(e){let t,a,i=n(e).attr("data-current-icon"),s=n(e).attr("data-cycle");s.forEach(((e,a)=>{e.icon===i&&(t=a)})),a=t+1===s.length?s[0]:s[t+1],n(e).html(`<div class="animated rotateIn"><i tabindex="-1" class="fas fa-${a.icon}"></div>`),n(e).attr("data-current-icon",a.icon),n(e).attr("data-current-values",a.values);let r=s[t].ariaAssertiveChangeMessage;this.ariaAnnounce(r)}sendControlStateToAllBeingControlled(){let e=n(n(this).attr("for")),t=this.getState();e.each((e=>{for(let a in t)n(e).attr(a,t[a])}))}getState(){let e={};n(this).find("[data-group]").each((t=>{let a,i=n(t).attr("data-group"),s=n(t).find(".active");a=s.els.length?s.attr("data-value"):"",e[i]=a}));let t=n(this).attr("last-used-icon-button-values");for(let a in t)e[a]=t[a];return e}ariaAnnounce(e){n(this).find(".aria-control-announcer").html(e)}}),I.register("track-table",class extends I{async onSpawn(){this.boundNewTrackListener=this.onNewTrack.bind(this),this.boundColumnHeaderClick=this.onColumnHeaderClick.bind(this),this.boundTableRowPlay=this.onTableRowPlay.bind(this),this.pageIsLoading=!1,Bridge.ipcListen("new-track",this.boundNewTrackListener),this.Query=await new v(this.buildQueryObj()),this.watchAttr(["ids","cols","order","orderby"],(async e=>{n(this).attr("data-pages-loaded",0),this.Query=await new v(this.buildQueryObj()),this.build()}))}async onBuild(){if(this.innerHTML=await h("/elements/track-table/track-table.html"),n(this).find("tbody").html(""),n(this).removeAttr("data-pages-loaded"),this.renderTableHead(),!this.Query.results.length)return;this.insertBodyTracks(this.Query.results),n(this).attr("data-pages-loaded",1);let e=n(this).find("tbody tr:first-of-type").height();n(".track-table-outer").removeAttr("style"),n(".track-table-outer").css({"min-height":e*this.Query.totalResults}),n(".view-content").el().scrollTop=0}onLoad(){this.registerEventListeners(),this.attachEventHandlersToAllExistingChildren()}onRemoved(){Bridge.removeListener("new-track",this.boundNewTrackListener)}buildQueryObj(){let e=n(this).attr("orderby"),t=n(this).attr("order"),a={table:"music_tracks",itemsPerPage:175,page:(n(this).attr("data-pages-loaded")||Number(0))+1,join:[{table:"music_artists",on:{track_artist_id:"id"}},{table:"music_releases",on:{track_release_id:"id"}}]};return e&&(a.orderBy={[e]:t||"ASC"}),a}registerEventListeners(){this.supportInfiniteScroll((()=>{this.onInfiniteScroll()}),".view-content")}attachEventHandlersToAllExistingChildren(){n(this).find("thead th").each((e=>{e.addEventListener("click",this.boundColumnHeaderClick)}))}async onNewTrack(e,t){let a=await new v({table:"music_releases",itemsPerPage:-1,columns:{id:e.track_release_id}}),i=await new v({table:"music_artists",itemsPerPage:-1,columns:{id:e.track_artist_id}});a.results.length&&(e={...a.results[0],...e}),i.results.length&&(e={...i.results[0],...e}),this._insertTbodyRow(e,"top")}getSortableColName(e){return"track_title"===e?"track_plaintext_title":"trackartist_name"===e?"artist_plaintext_name":"trackrelease_title"===e?"release_plaintext_title":"track_duration_formatted"===e?"track_duration":e}onColumnHeaderClick(e){if(n(e.target).hasClass("noclick"))return;let t=n(e.target).attr("data-col");n(this).find("thead .asc, thead .desc").removeClass("asc","desc"),t=this.getSortableColName(t);let a,i=n(this).attr("order");a=i&&""!==i&&"DESC"!==i?"DESC":"ASC",n(this).attr("order",a).attr("orderby",t)}onTableRowPlay(e){console.log("DBL CLICK");let t=e.target;e.target.matches("tr")||(t=e.target.closest("tr")),Player.play([n(t).attr("data-id")])}async onInfiniteScroll(){if(this.pageIsLoading)return;this.pageIsLoading=!0;let e=n(this).attr("data-pages-loaded")+1;e>this.Query.pages||(await this.Query.goToPage(e),this.insertBodyTracks(this.Query.results),n(this).attr("data-pages-loaded",e)),this.pageIsLoading=!1}determineTableCols(){let e=n(this).attr("cols");return Array.isArray(e)?e:["track_title","track_duration_formatted","artist_name","release_title","track_source"]}renderTableHead(){let e=this.determineTableCols(),t=n(this).find("table thead"),a=!1;void 0!==n(this).attr("orderby")&&(a=!0),t.html("<tr></tr>");let i=t.find("tr");for(let t of e){let e=this._filterCol(t),s=[];if(e.clickable||s.push("noclick"),""!==e.name&&(e.name=`<span>${e.name}</span>`),a){let e=n(this).attr("order");n(this).attr("orderby")===this.getSortableColName(t)&&s.push(e.toLowerCase())}i.appendHtml(`<th class="${s.join(" ")}" data-col="${t}">${e.name}</th>`).on("click",this.boundColumnHeaderClick)}}insertBodyTracks(e){for(let t of e)this._insertTbodyRow(t)}_insertTbodyRow(e,t="bottom"){let a=n(this).find("table tbody"),i=this.determineTableCols();if(a.find(`tr[data-id="${e.id}"]`).els.length)return;let s,r=`<tr data-id="${e.id}"></tr>`;"top"===t?s=a.prependHtml(r):"bottom"===t&&(s=a.appendHtml(r));for(let t of i){let a=this._morphCellContent(t,e[t]);s.appendHtml(`<td title="${a.title}" data-col="${t}">${a.content}</td>`)}s.on("dblclick",this.boundTableRowPlay)}_filterCol(e){let t={name:e,clickable:!0};switch(e){case"track_num":"*"===n(this).attr("ids")?(t.name="",t.clickable=!1):t.name="";break;default:t.name=y(`column.${e}`)}return t}_morphCellContent(e,t){let a,i;switch(e){case"track_source":"local"===t&&(a=`<i class="fas fa-hdd" title="${y("source-icon.local.title")}"></i>`,i=t);break;default:a=t,i=t}return{content:a,title:i}}}),I.register("track-list",class extends I{async shouldBuild(){return!!this.isFavoritesList||null===this.firstElementChild}async onSpawn(){this.isFavoritesList="favorites"===n(this).attr("mode"),this.isFavoritesList&&(this.boundOnFavoriteChange=this.onFavoriteChange.bind(this),Bridge.wsListen("announcements:favorite-added",this.boundOnFavoriteChange),Bridge.wsListen("announcements:favorite-removed",this.boundOnFavoriteChange)),this.watchAttr(["ids","mode","playlistid"],(e=>{this.render()}))}async onBuild(){let e,t=n(this).attr("ids"),a=n(this).attr("albumid"),i=n(this).attr("playlistid");if(t?e=t:a?e=await this.getAlbumTracks():i?e=await this.getPlaylistTracks():this.isFavoritesList&&(e=await this.getFavorites()),Array.isArray(e)&&(e={1:e}),!e||!Object.keys(e).length||!e[1].length)return this.innerHTML=await h("/elements/track-list/track-list.html"),void n(this).addClass("no-tracks");n(this).removeClass("no-tracks"),t?await this._renderAsSimpleTrackList(e):a?await this._renderAsAlbumTrackList(e):i?(await this._renderAsPlaylistTrackList(e),this.renderPlaylistStats()):this.isFavoritesList&&await this._renderAsFavoritesTrackList(e)}onLoad(){n(this).find(".track-list-item").each((e=>{this.registerTrackListItemEventListeners(e)}))}onFavoriteChange(e){this.build()}onRemoved(){Bridge.removeWsListener("announcements:favorite-added",this.boundOnFavoriteChange),Bridge.removeWsListener("announcements:favorite-removed",this.boundOnFavoriteChange)}registerTrackListItemEventListeners(e){n(this).attr("playlistid")&&se({dragEl:e,dragoverEl:e,dropEl:e,onDrop:(e,t)=>{this.registerTrackListItemEventListeners(t),this.updateTrackNumsInPlaylist(),this.updatePlaylistInDatabase()}})}onFavoriteChange(e){this.render()}async getFavorites(){let e=n(this).attr("artistid"),t=await Bridge.httpApi("/favorites/music-track");if(2!==t.statusRange)return console.warn("Could not load favorites"),[];if(!t.response.length)return[];let a=await new v({table:"music_tracks",columns:[{track_artist_id:e},{id:t.response.map((e=>e.favorite_thing_id)),equalityOperator:"IN"}]});return a.results.length?a.results.map((e=>e.id)):[]}async getAlbumTracks(){let e=await new v({table:"music_tracks",itemsPerPage:-1,columns:{track_release_id:n(this).attr("albumid")},orderBy:{track_num:"ASC"}});if(!e.results.length)throw new Error("This album somehow has no tracks");let t={};for(let a of e.results){let e=1;a.track_disc&&(e=a.track_disc),e in t||(t[e]=[]),t[e].push(a.id)}return t}async getPlaylistTracks(){let e=n(this).attr("playlistid"),t=await new v({table:"music_playlists",columns:{id:e}});return t.results.length?t.results[0].playlist_track_ids:[]}renderTitle(){n(this).find(".title-row").remove();let e=null;n(this).attr("titlei18nkey")&&(e=y(n(this).attr("titlei18nkey"))),"favorites"===n(this).attr("mode")&&(e=y("view.artist.favorite-tracks.title")),e&&n(this).prependHtml(`<div class="title-row"><h3 class="title">${e}</h3></div>`)}async _renderAsSimpleTrackList(e){this.innerHTML=await h("/elements/track-list/track-list.html"),this.renderTitle();for(let[t,a]of Object.entries(e))for(let e of a)n(this).find(".tracks").appendHtml(`\n          <track-block trackid="${e}" mode="expanded" playbutton="permanent"></track-block>\n        `)}async _renderAsAlbumTrackList(e){this.innerHTML=await h("/elements/track-list/track-list.html"),this.renderTitle(),n(this).attr("discs",Object.keys(e).length);for(let[t,a]of Object.entries(e)){n(this).find(".tracks").appendHtml(`<div class="disc disc-${t}"><h3 class="disc-title">${y("disc")} ${t}</h3></div>`);for(let e of a)n(this).find(`.tracks .disc-${t}`).appendHtml(`\n          <track-block trackid="${e}" mode="expanded"></track-block>\n        `)}}async _renderAsFavoritesTrackList(){let e=await this.getFavorites(),t=n(this).find("track-block");t.els.length||(this.innerHTML=await h("/elements/track-list/track-list.html"),this.renderTitle());let a=[];for(let t of e){let i=n(this).find(`track-block[trackid="${t}"]`),s=`<track-block trackid="${t}" mode="expanded" playbutton="permanent"></track-block>`,r=0===e.indexOf(t)?null:e[e.indexOf(t)-1];i.els.length||(null===r?n(this).find(".tracks").appendHtml(s):n(this).find(`track-block[trackid="${r}"]`).after(s)),a.push(t)}t.each((e=>{a.includes(n(e).attr("trackid"))||n(e).remove()}))}async _renderAsPlaylistTrackList(e){this.innerHTML=await h("/elements/track-list/track-list.html"),this.renderTitle();for(let[t,a]of Object.entries(e))for(let e of a)n(this).find(".tracks").appendHtml(`\n          <div class="track-list-item" draggable="true">\n            <track-block trackid="${e}" mode="expanded"></track-block>\n          </div>\n        `);this.updateTrackNumsInPlaylist()}updateTrackNumsInPlaylist(){let e=1;n(this).find("track-block").each((t=>{n(t).attr("num",e),e++}))}async updatePlaylistInDatabase(){let e=[];n(this).find("track-block").each((t=>{e.push(n(t).attr("trackid"))})),2!==(await Bridge.httpApi("/db-api","POST",{fn:"update",args:["music_playlists",n(this).attr("playlistid"),{playlist_track_ids:e}]})).statusRange&&console.warn("Error updating playlist")}async renderPlaylistStats(){let e=[],t=n(this).find("track-block");if(!t.els.length)return;t.each((t=>{e.push(n(t).attr("trackid"))}));let a=await new v({table:"music_tracks",columns:{id:e,equalityOperator:"IN"}});if(!a.results.length)throw new Error("<track-list> could not find playlist tracks in the database.");let i=a.results.length,s=0;for(let e of a.results)s+=e.track_duration;let r=y(1===i?"track-table.playlist-stats.tracks-singular":"track-table.playlist-stats.tracks");n(this).find(".playlist-stats").els.length?(n(this).find(".playlist-stats .num-tracks").html(r.replace("{{n}}",i)),n(this).find(".playlist-stats .duration").html(n().convertSecondsToHHMMSS(s))):n(".title-row").appendHtml(`\n        <div class="playlist-stats pill-bar">\n          <div class="inner">\n            <span class="num-tracks">${r.replace("{{n}}",i)}</span>\n            <span class="duration">${n().convertSecondsToHHMMSS(s)}</span>\n          </div>\n        </div>\n      `)}}),I.register("track-block",class extends I{async onSpawn(){this.boundTrackChangeSubscriber=this.onTrackChange.bind(this),this.watchAttr(["trackid","mode"],(async e=>{this.render(),this.setPlayingStatus()})),this.watchAttr(["num"],(async e=>{let t=n(this).attr("num");n(this).find(".track-num").html(t)}));let e=n(this).attr("trackid");if(this.trackId=e,this.trackObj=null,this.releaseObj=null,this.artistObj=null,this.favoriteClass="is-favorite",!e)throw new Error("Cannot render <track-block> without trackid attribute");Player.on("trackChange",this.boundTrackChangeSubscriber)}async onBuild(){n(this).addClass("loading"),void 0===n(this).attr("mode")||"simple"===n(this).attr("mode")?await this._renderAsSimpleBlock():"expanded"===n(this).attr("mode")&&await this._renderAsExpandedBlock(),n(this).removeClass("loading")}async onLoad(){this.trackObj||await this._setInternalObjects(),this.refreshFavoriteStatus(),this.classList.add("has-context-menu-items"),this.registerEventListeners(),this.setPlayingStatus(),await this.setPlayCount(),this.supportInteractingState()}onRemoved(){Player.off("trackChange",this.boundTrackChangeSubscriber)}getContextMenuItems(){let e=n(this).attr("trackid"),t=[{group:this.trackObj.track_title,items:{[y("track-block.context-menu.play-track")]:{cb:(t,a)=>{Player.play(e),ContextMenu.closeAllContextMenus()}},[y("track-block.context-menu.play-next")]:{cb:(t,a)=>{"stopped"===Player.state?Player.add(e,0):Player.add(e,Player.currentQueueItemIndex),ContextMenu.closeAllContextMenus()}},[y("track-block.context-menu.add-to-queue")]:{cb:(t,a)=>{Player.add(e),ContextMenu.closeAllContextMenus()}},[y("track-block.context-menu.add-to-playlist")]:{class:"dropdown-item",cb:async(t,a)=>{ContextMenu.renderSpecialItem("addToPlaylist",{el:a,idsToAdd:[e]})}}}}];return n(this).closest("track-list[playlistid]").els.length&&(t[0].items[y("track-block.context-menu.remove-from-playlist")]={attrs:{"data-hover":"danger"},cb:async(e,t)=>{let a=n(this).attr("trackid"),i=n(this).closest("track-list[playlistid]").attr("playlistid"),s=await new v({table:"music_playlists",columns:{id:i}});if(!s.results.length)throw new Error(`Could not find playlist with ID ${i} in the database.`);let r=s.results[0].playlist_track_ids,o=s.results[0].playlist_track_ids.indexOf(a);if(r.splice(o,1),!await Bridge.httpApi("/db-api","POST",{fn:"update",args:["music_playlists",i,{playlist_track_ids:r}]}))throw new Error("Error updating database with new playlist tracks");{let e=n(this).closest("track-list");ContextMenu.closeAllContextMenus(),await n(this).animate("fadeOut"),n(this).closest(".track-list-item").remove(),e.el().updateTrackNumsInPlaylist(),e.el().renderPlaylistStats()}}}),t}_renderAsSimpleBlock(){return new Promise((async(e,t)=>{this.innerHTML=await h("/elements/track-block/track-block-simple.html"),await this._setInternalObjects(),null===this.releaseObj?(console.warn("Why is this sometimes (rarely) null?"),console.log(this)):null!==this.releaseObj.artwork?n(this).find(".art").attr("style",`background-image:url('${n().__doubleSlashesOnWindowsOnly(this.releaseObj.artwork.thumbs[75].thumb_file)}');`):n(this).find(".art").addClass("no-art"),n(this).find(".art a").attr("href",`/music-release/${this.releaseObj.id}`),this.props.trackName=this.trackObj.track_title,this.props.artistName=this.artistObj.artist_name,this.props.duration=n().convertSecondsToHHMMSS(this.trackObj.track_duration),n(this).find(".meta .artist a").attr("href",`/artist/${this.artistObj.id}`),e()}))}_renderAsExpandedBlock(){return new Promise((async(e,t)=>{this.refreshFavoriteStatus(),await this._setInternalObjects(),this.innerHTML=await h("/elements/track-block/track-block-expanded.html",this.trackObj),n(this).find(".play-col").appendHtml(`<play-button trackid="${this.trackObj.id}" mode="simple"></play-button>`);let a=n(this).attr("num");a?n(this).find(".play-col .track-num").html(a):n(this).find(".play-col .track-num").html(this.trackObj.track_num),n(this).find(".track-name").appendHtml(`<span title="${this.trackObj.track_title}">${this.trackObj.track_title}</span>`),n(this).find(".album-name").appendHtml(`\n        <a href="/music-release/${this.releaseObj.id}" class="router-link" title="${this.releaseObj.release_title}">\n          <span tabindex="-1">${this.releaseObj.release_title}</span>\n        </a>\n      `),n(this).find(".artist-name").appendHtml(`\n        <a href="/artist/${this.artistObj.id}" class="router-link" title="${this.artistObj.artist_name}">\n          <span tabindex="-1">${this.artistObj.artist_name}</span>\n        </a>\n      `),n(this).find(".duration").html(n().convertSecondsToHHMMSS(this.trackObj.track_duration)),"local"===this.trackObj.track_source&&n(this).find(".source-col").html(`<i class="fas fa-hdd" title="${y("source-icon.local.title")}"></i>`),e()}))}registerEventListeners(){"expanded"===n(this).attr("mode")&&this._registerEventListenersForExpandedBlock()}_registerEventListenersForExpandedBlock(){this.querySelector("button.toggle-favorite").addEventListener("dblclick",(e=>{e.stopPropagation()})),this.querySelector("play-button").addEventListener("dblclick",(e=>{e.stopPropagation()})),this.querySelector("button.toggle-favorite").addEventListener("click",(async e=>{1===e.which&&(await this.isFavorite()?await this.removeTrackFromFavorites():await this.addTrackToFavorites())})),this.addEventListener("dblclick",(e=>{this.play()}))}onTrackChange(){this.setPlayingStatus(),n(this).attr("trackid")===Player.currentlyPlayingId&&(this.props.playCount=parseInt(this.props.playCount)+1)}setPlayingStatus(){n(this).attr("trackid")===Player.currentlyPlayingId?n(this).addClass("is-playing"):n(this).removeClass("is-playing")}async refreshFavoriteStatus(){await this.isFavorite()?n(this).addClass(this.favoriteClass):n(this).removeClass(this.favoriteClass)}async isFavorite(){let e=await this.getFavorites();if(!e.length)return!1;let t=n(this).attr("trackid");return!!e.map((e=>e.favorite_thing_id)).includes(t)||void 0}async getFavorites(){let e=await Bridge.httpApi("/favorites/music-track");return 2!==e.statusRange?(console.warn("Could not load favorites from server"),[]):e.response}async addTrackToFavorites(){let e=this.getAttribute("trackid");2===(await Bridge.httpApi("/favorites","POST",{favorite_thing_id:e,favorite_thing_type:"music-track",favorite_date_added:Date.now()})).statusRange?n(`track-block[trackid="${e}"]`).addClass(this.favoriteClass):console.error("Error adding favorite")}async removeTrackFromFavorites(){let e=this.getAttribute("trackid");2===(await Bridge.httpApi(`/favorites/music-track/${e}`,"DELETE")).statusRange?n(`track-block[trackid="${e}"]`).removeClass(this.favoriteClass):console.error("Error removing favorite")}play(){let e=[];e.push(n(this).attr("trackid"));let t=n(this).siblings("next","track-block");if(!t.els.length){let e=n(this).closest(".track-list-item");e.els.length&&(t=e.siblings("next",".track-list-item").find("track-block"))}t.els.length&&t.each((t=>{e.push(n(t).attr("trackid"))})),Player.play(e)}async _setInternalObjects(){let e=await Bridge.httpApi(`/music-track/${this.trackId}`);if(2!==e.statusRange)throw new Error(`Error getting track ${this.trackId} from API`);this.trackObj=e.response;let t=await Bridge.httpApi(`/music-release/${this.trackObj.track_release_id}`);if(2!==t.statusRange)throw new Error(`Error getting release ${this.trackObj.track_release_id} from API`);this.releaseObj=t.response;let a=await Bridge.httpApi(`/music-artist/${this.trackObj.track_artist_id}`);2!==a.statusRange&&console.error(`Error getting artist ${this.trackObj.track_release_id} from API`),this.artistObj=a.response}async setPlayCount(){let e=n(this).attr("trackid"),t=await new v({table:"music_history",itemsPerPage:-1,columns:{music_history_track_id:e}});this.props.playCount=t.totalResults}}),I.register("genre-tags",class extends I{async onSpawn(){this.watchAttr(["ids"],(e=>{this.render()}))}async onBuild(){if(this.Query=await new v(this.buildQueryObj()),this.Query.results.length)for(let e of this.Query.results)n(this).appendHtml(this.createChildGenreTag(e.id));else n(this).addClass("no-genres")}onRemoved(){}onNewGenre(e){let t=!1;"*"===n(this).attr("ids")&&(t=!0),t&&(n(this).removeClass("no-genres"),n(this).prependHtml(this.createChildGenreTag(e.id)))}buildQueryObj(){let e={table:"music_genres",itemsPerPage:-1,orderBy:{genre_name:"ASC"}};if(n(this).attr("ids")){let t=n(this).attr("ids");"*"===t||Array.isArray(t)&&(e.columns={id:t,equalityOperator:"IN"})}return e}createChildGenreTag(e){let t=void 0!==n(this).attr("canfavorite")?"canfavorite":"";return`<genre-tag genreid="${e}" ${void 0!==n(this).attr("large")?"large":""} ${t}></genre-tag>`}}),I.register("genre-tag",class extends I{async onSpawn(){}async onBuild(){let e=n(this).attr("genreid"),t=await new v({table:"music_genres",columns:{id:e}});if(!t.results.length)throw new Error("Could not find genre for <genre-tag>");this.genreRow=t.results[0],n(this).attr("genre-name",this.genreRow.genre_name),this.innerHTML=await h("/elements/genre-tag/genre-tag.html",this.genreRow),await this.isFavorite()&&n(this).addClass("is-favorite"),n(this).addClass("has-context-menu-items")}onLoad(){this.registerEventHandlers()}registerEventHandlers(){let e=this;this.querySelector(".toggle-favorite").addEventListener("click",(async t=>{1===t.which&&(await this.isFavorite()?(await this.removeGenreFromFavorites(),n(e).removeClass("is-favorite")):(await this.addGenreToFavorites(),n(e).addClass("is-favorite")))}))}getContextMenuItems(){let e=n(this).attr("genreid");return[{group:n(this).attr("genre-name"),items:{[y("genre-tag.context-menu.edit-genre")]:{cb:t=>{n("#metadata-editor-modal").els.length&&j("metadata-editor-modal"),B(this.closest("music-app"),`<metadata-editor genreid="${e}"></metadata-editor>`,{id:"metadata-editor-modal",mode:"floating"}),ContextMenu.closeAllContextMenus()}}}}]}async getFavorites(){return await Bridge.ipcAsk("get-option","favorite_genres")||[]}async isFavorite(){let e=await this.getFavorites();if(!e.length)return!1;let t=n(this).attr("genreid");return!!e.includes(t)||void 0}async addGenreToFavorites(){let e=n(this).attr("genreid"),t=await this.getFavorites();t.includes(e)||(t.push(e),await Bridge.ipcAsk("set-option",{option:"favorite_genres",value:t}))}async removeGenreFromFavorites(){let e=n(this).attr("genreid"),t=await this.getFavorites();t.includes(e)&&(t.splice(t.indexOf(e),1),await Bridge.ipcAsk("set-option",{option:"favorite_genres",value:t}))}}),I.register("playlist-list",class extends I{async onSpawn(){this.boundDeletedPlaylistListener=this.onDeletedPlaylist.bind(this),this.boundWindowResizeListener=this.onWindowResize.bind(this),this.resizeTimout=null,Bridge.ipcListen("deleted-playlist",this.boundDeletedPlaylistListener),this.Query=await new v(this.buildQueryObj()),this.pageIsLoading=!1,this.watchAttr(["order","orderby"],(async e=>{n(this).removeAttr("data-pages-loaded"),this.Query=await new v(this.buildQueryObj()),this.render()}))}async onBuild(){this.innerHTML=await h("/elements/playlist-list/playlist-list.html");let e=n(this).find(".playlists");if(n(this).removeAttr("data-pages-loaded"),e.html(""),this.Query.results.length){for(let t of this.Query.results)e.appendHtml(`<playlist-block playlistid="${t.id}"></playlist-block>`);if(n(this).attr("data-pages-loaded",1),n(".view-content").el().scrollTop=0,"*"===n(this).attr("ids")){let e=new MutationObserver((t=>{this.querySelector("playlist-block.loaded")&&(e.disconnect(),this.createLoadedIllusion())}));e.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}}else n(this).addClass("no-playlists")}onLoad(){this.registerEventListeners(),X(this.querySelector("form#create-playlist"))}onRemoved(){Bridge.removeListener("deleted-playlist",this.boundDeletedAlbumListener),window.removeEventListener("resize",this.boundWindowResizeListener)}registerEventListeners(){"*"===n(this).attr("ids")&&this.supportInfiniteScroll((()=>{this.onInfiniteScroll()}),".view-content"),window.addEventListener("resize",this.boundWindowResizeListener),n(this).find(".empty-message").on("click",(e=>{let t=n(this).find("form#create-playlist");t.hasClass("show")||t.find('button[name="show-fields"]').trigger("click"),t.find('input[name="new-playlist-name"]').el().focus()})),n(this).find('button[name="show-fields"]').on("click",(e=>{e.preventDefault();let t=n(this).find("form#create-playlist"),a=n(this).find("form#create-playlist .hidden-fields");a.hasClass("show")?(t.removeClass("show"),a.removeClass("show")):(t.addClass("show"),a.addClass("show"),a.find('input[name="new-playlist-name"]').el().focus())}));const e=n(this).find("form#create-playlist");e.on("submit",(async t=>{t.preventDefault();let a=e.find('input[name="new-playlist-name"]'),i=a.value();if(null==i||""===i.trim())return;let s=await Bridge.httpApi("/media-api","POST",{fn:"createPlaylist",args:[{playlist_name:i,plsylisttags:null,playlist_track_ids:null}]});2===s.statusRange?(n(this).removeClass("no-playlists"),n(this).find(".playlists").prependHtml(`<playlist-block playlistid="${s.response.id}"></playlist-block>`),a.value("")):console.error("Something went wrong when creating playlist.",s)}))}async onInfiniteScroll(){if(this.pageIsLoading)return;this.pageIsLoading=!0;let e=n(this).attr("data-pages-loaded")+1;if(e>this.Query.pages)return void(this.pageIsLoading=!1);await this.Query.goToPage(e);let t=n(this).find(".playlists");for(let e of this.Query.results)t.appendHtml(`<playlist-block playlistid="${e.id}"></playlist-block>`);n(this).attr("data-pages-loaded",e),this.pageIsLoading=!1}onWindowResize(e){clearTimeout(this.resizeTimout),this.resizeTimout=setTimeout((()=>{n("music-app").hasClass("no-music")||"*"===n(this).attr("ids")&&this.createLoadedIllusion()}),200)}async onDeletedPlaylist(e){n(this).closest(".playlists-outer").removeAttr("style"),(await new v({table:"music_playlists",itemsPerPage:1})).results.length||n(this).addClass("no-playlists")}async createLoadedIllusion(){let e=n(this).find(".playlists playlist-block.loaded");if(!e.els.length)return;let t=e.getShortest().el(),a=n(t).height()+parseInt(window.getComputedStyle(t).marginBottom),i=this.Query.totalResults;n(this).closest(".playlists-outer").css({"min-height":a*i})}buildQueryObj(){let e=n(this).attr("ids"),t=n(this).attr("orderby"),a=n(this).attr("order"),i=n(this).attr("data-pages-loaded")||Number(0),s={};return"*"===e?(s.table="music_playlists",s.page=i+1):Array.isArray(e)&&(s.table="music_playlists",s.itemsPerPage=-1,s.columns={id:e}),t&&(s.orderBy={[t]:a||"ASC"}),s}}),I.register("playlist-block",class extends I{async onSpawn(){let e=n(this).attr("playlistid");if(!e)throw new Error("<playlist-block> requires a playlistid attribute.");if(this.classList.add("has-context-menu-items"),this.playlistQuery=await new v({table:"music_playlists",columns:{id:e}}),!this.playlistQuery.results.length)throw new Error("<playlist-block> could not find a playlist with that ID in the database.");this.playlist=this.playlistQuery.results[0],this.shouldBuild=()=>JSON.stringify(n(this).attr("trackids"))!==JSON.stringify(this.playlist.playlist_track_ids)}async onBuild(){let e=await h("/elements/playlist-block/playlist-block.html"),t=Array.isArray(this.playlist.playlist_track_ids)?this.playlist.playlist_track_ids.length:0,a=y(1===t?"playlist-block.track-count.suffix-singular":"playlist-block.track-count.suffix");if(this.innerHTML=await h(e,{...this.playlist,numTracks:`${t} ${a}`,link:`/playlist/${n(this).attr("playlistid")}`}),t){if(n(this).find(".albums-in-playlist").appendHtml(await n().getFileContents("/images/loading.svg")),!t)return n(this).addClass("loaded"),void n(this).attr("trackids","[]");let e=await new v({table:"music_tracks",columns:{id:this.playlist.playlist_track_ids,equalityOperator:"IN"}});if(!e.results.length)throw new Error("<playlist-block> could not find tracks for this playlist in the database.");let a=Array.from(new Set(e.results.map((e=>e.track_release_id)))),i=await new v({table:"music_releases",columns:{id:a,equalityOperator:"IN"}});if(!i.results.length)throw new Error("<playlist-block> could not find album arts. How can a track exist without an album?");let s=n(this).find(".albums-in-playlist").el();for(let e of i.results){if(!e.album_artwork)continue;let t=n().__doubleSlashesOnWindowsOnly(Object.values(e.album_artwork)[0][75]);n(s).appendHtml(`<div class="artwork" title="${e.release_title} - ${e.albumartist}" style="background-image:url('${t}')"></div>`)}let r=n(this).find(".artwork");if(r.els.length){let e=0;r.each((t=>{setTimeout((()=>{n(t).addClass("show")}),e),e+=50}))}}n(this).find("svg.loading").animate("fadeOut").then((e=>{e.remove()})),n(this).addClass("loaded"),n(this).attr("trackids",this.playlist.trackids)}onLoad(){n(this).find(".artwork").addClass("show"),this.supportInteractingState()}async getContextMenuItems(){return[{group:this.playlist.playlist_name,items:{[y("playlist-block.context-menu.play")]:{cb:async(e,t)=>{let a=this.playlist.playlist_track_ids;a&&(Array.isArray&&!a.length||(Player.play(a),ContextMenu.closeAllContextMenus()))}},[y("playlist-block.context-menu.play-next")]:{cb:async(e,t)=>{let a=this.playlist.playlist_track_ids;a&&(Array.isArray&&!a.length||(Player.add(a,Player.currentQueueItemIndex+1),ContextMenu.closeAllContextMenus()))}},[y("playlist-block.context-menu.add-to-queue")]:{cb:async(e,t)=>{let a=this.playlist.playlist_track_ids;a&&(Array.isArray&&!a.length||(Player.add(a),ContextMenu.closeAllContextMenus()))}},[y("playlist-block.context-menu.edit-playlist")]:{cb:async(e,t)=>{let a=n(this).attr("playlistid");n("#metadata-editor-modal").els.length&&j("metadata-editor-modal"),B(this.closest("music-app"),`<metadata-editor playlistid="${a}"></metadata-editor>`,{id:"metadata-editor-modal",mode:"floating"}),ContextMenu.closeAllContextMenus()}},[y("playlist-block.context-menu.delete-playlist")]:{attrs:{"data-hover":"danger"},cb:async(e,t)=>{let a=n(this).attr("playlistid");if(!a)throw new Error("Delete callback cannot find playlist ID");if(confirm(y("danger-confirm"))){let e=await Bridge.httpApi("/media-api","POST",{fn:"deletePlaylist",args:[a]});if(2!==e.statusRange)return void console.error("Something went wrong when deleting playlist.",e);Router.deleteViewCache(),n(this).remove()}ContextMenu.closeAllContextMenus()}}}}]}setDotMenuItems(){dotMenu.addMenuItem("deletePlaylist",deletePlaylistMenuItem,(async e=>{}))}}),I.register("album-grid",class extends I{async onSpawn(){this.boundWindowResizeListener=this.onWindowResize.bind(this),this.resizeTimout=null,this.Query=await new v(this.buildQueryObj()),this.pageIsLoading=!1,this.registerEventListeners(),this.watchAttr(["order","orderby"],(async e=>{n(this).removeAttr("data-pages-loaded"),this.Query=await new v(this.buildQueryObj()),this.build()}))}async onBuild(){this.innerHTML=await h("/elements/album-grid/album-grid.html");let e=n(this).find(".grid");if(n(this).removeAttr("data-pages-loaded"),e.html(""),this._renderTitle(),this.Query.results.length){for(let t of this.Query.results)e.appendHtml(`<album-block albumid="${t.id}" lazy-render></album-block>`);if(n(this).attr("data-pages-loaded",1),n(".view-content").el().scrollTop=0,"*"===n(this).attr("ids")){let e=new MutationObserver((t=>{this.querySelector("album-block.loaded")&&(e.disconnect(),this.createLoadedIllusion())}));e.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}}}shouldBuild(){return this.Query.results.length}onRemoved(){window.removeEventListener("resize",this.boundWindowResizeListener)}registerEventListeners(){"*"===n(this).attr("ids")&&this.supportInfiniteScroll((()=>{this.onInfiniteScroll()}),".view-content"),window.addEventListener("resize",this.boundWindowResizeListener)}async onInfiniteScroll(){if(this.pageIsLoading)return;this.pageIsLoading=!0;let e=n(this).attr("data-pages-loaded")+1;if(e>this.Query.pages)return void(this.pageIsLoading=!1);await this.Query.goToPage(e);let t=n(this).find(".grid");for(let e of this.Query.results)t.appendHtml(`<album-block albumid="${e.id}" lazy-render></album-block>`);n(this).attr("data-pages-loaded",e),this.pageIsLoading=!1}onWindowResize(e){clearTimeout(this.resizeTimout),this.resizeTimout=setTimeout((()=>{n("music-app").hasClass("no-music")||"*"===n(this).attr("ids")&&this.createLoadedIllusion()}),200)}onNewAlbum(e){let t=!1;"*"===n(this).attr("ids")&&(t=!0),t&&n(this).find(".grid").prependHtml(`<album-block albumid="${e.id}" lazy-render></album-block>`)}_renderTitle(){n(this).find(".title").remove();let e=n(this).attr("titlei18nkey");if(e)return void n(this).prependHtml(`<h3 class="title">${y(e)}</h3>`);let t=n(this).attr("titlestring");t&&n(this).prependHtml(`<h3 class="title">${t}</h3>`)}createLoadedIllusion(){let e=n(this).find(".grid album-block.has-art.loaded").getShortest().el(),t=n(e).height(),a=parseInt(window.getComputedStyle(e).marginBottom),i=n(this).itemsPerRow("album-block"),s=this.Query.totalResults/i[0],r=t+a;n(".album-grid-outer").css({"min-height":r*s})}buildQueryObj(){let e=n(this).attr("ids"),t=n(this).attr("artistid"),a=n(this).attr("orderby"),i=n(this).attr("order"),s=n(this).attr("releasetype"),r=n(this).attr("data-pages-loaded")||Number(0),o={};return"*"===e?(o.table="music_releases",o.orderBy={release_plaintext_title:"ASC"},o.page=r+1):Array.isArray(e)?(o.table="music_releases",o.itemsPerPage=-1,o.columns={id:e,equalityOperator:"IN"}):"number"==typeof t&&(o.table="music_releases",o.itemsPerPage=-1,o.columns=[{release_primary_artist_id:t}]),s&&("other"===s?o.columns.push({release_type:["album","single","ep","compilation","soundtrack","live","remix"],equalityOperator:"NOT IN"}):o.columns.push({release_type:s})),a&&(o.orderBy={[a]:i||"ASC"}),o}}),I.register("album-block",class extends I{async onSpawn(){this.classList.add("has-context-menu-items")}async onBuild(){let e=await this.makeMergeTags();this.innerHTML=await h("/elements/album-block/album-block.html",e),e.art?this.classList.add("has-art","loaded"):this.querySelector(".art").classList.add("no-art")}onLoad(){this.supportInteractingState({rightClickEls:[this.querySelector(".art")]})}async getContextMenuItems(){return this.albumObj||(this.albumObj=await this.getAlbumObj()),[{group:this.albumObj.release_title,items:{[y("album-block.context-menu.play-album")]:{cb:async(e,t)=>{let a=await this.getAlbumTracks();Player.play(a),ContextMenu.closeAllContextMenus()}},[y("album-block.context-menu.play-next")]:{cb:async(e,t)=>{let a=await this.getAlbumTracks();"stopped"===Player.state?Player.add(a,0):Player.add(a,Player.currentQueueItemIndex),ContextMenu.closeAllContextMenus()}},[y("album-block.context-menu.add-to-queue")]:{cb:async(e,t)=>{let a=await this.getAlbumTracks();Player.add(a),ContextMenu.closeAllContextMenus()}},[y("album-block.context-menu.add-to-playlist")]:{class:"dropdown-item",cb:async(e,t)=>{let a=await this.getAlbumTracks();ContextMenu.renderSpecialItem("addToPlaylist",{el:t,idsToAdd:a})}},[y("album-block.context-menu.edit-album")]:{cb:async(e,t)=>{let a=n(this).attr("albumid");n("#metadata-editor-modal").els.length&&j("metadata-editor-modal"),B(this.closest("music-app"),`<metadata-editor albumid="${a}"></metadata-editor>`,{id:"metadata-editor-modal",mode:"floating"}),ContextMenu.closeAllContextMenus()}}}}]}async getAlbumTracks(e=this){let t=await new v({table:"music_tracks",columns:{track_release_id:n(e).attr("albumid")},orderBy:{track_num:"ASC"}});if(!t.results.length)throw new Error("Could not find tracks in database");let a={},i=[];for(let e of t.results){let t="object"==typeof e.track_disc&&"no"in e.track_disc&&null!==e.track_disc.no?e.track_disc.no:1;t in a||(a[t]=[]),a[t].push(e.id)}for(let[e,t]of Object.entries(a))t.forEach((e=>i.push(e)));return i}async getTrackList(){let e=n(this).attr("albumid"),t=await new v({table:"music_tracks",itemsPerPage:-1,columns:{track_release_id:e},orderBy:{track_num:"ASC"}});if(!t.results.length)throw new Error("This album somehow has no tracks");return t.results}makeMergeTags(){return new Promise((async(e,t)=>{this.albumObj||(this.albumObj=await this.getAlbumObj()),n(this).attr("layout");let a=n(this).attr("albumid"),i={...this.albumObj,art:"",link:`/music-release/${a}`,date:this.albumObj.release_year||"",artist:this.albumObj.meta.artist,artistLink:`/artist/${this.albumObj.release_primary_artist_id}`};if(this.albumObj.artwork){console.log(this.albumObj);let t=this.albumObj.artwork.thumbs[200].thumb_file,a=n().__doubleSlashesOnWindowsOnly(t),s=document.createElement("img");s.src=a,s.addEventListener("load",(()=>{s.remove(),i.art=`style="background-image:url('${a}')"`,e(i)}))}else e(i)}))}async getAlbumObj(){let e=n(this).attr("albumid"),t=await Bridge.httpApi(`/music-release/${e}`);if(2!==t.statusRange)throw new Error("<album-block> did not get API data");return t.response}}),I.register("artist-grid",class extends I{async onSpawn(){this.boundArtistListener=this.onNewArtist.bind(this),this.boundWindowResizeListener=this.onWindowResize.bind(this),this.resizeTimout=null,Bridge.ipcListen("new-artist",this.boundArtistListener),this.registerEventListeners(),this.watchAttr(["order","orderby"],(async e=>{n(this).removeAttr("data-pages-loaded");let t=await this.buildQueryObj();t&&(this.Query=await new v(t),this.build())}));let e=await this.buildQueryObj();e&&(this.Query=await new v(e),this.pageIsLoading=!1)}async onBuild(){if(!this.Query)return;this.innerHTML=await h("/elements/artist-grid/artist-grid.html");let e=n(this).find(".grid");if(n(this).removeAttr("data-pages-loaded"),e.html(""),this._renderTitle(),this.Query.results.length){for(let t of this.Query.results)e.appendHtml(`<artist-block artistid="${t.id}"></artist-block>`);n(this).attr("data-pages-loaded",1),n(".view-content").el().scrollTop=0,"*"===n(this).attr("ids")&&setTimeout((()=>{this.createLoadedIllusion()}),100)}}onRemoved(){n(this).hasClass("no-artists")||(Bridge.removeListener("new-artist",this.boundArtistListener),window.removeEventListener("resize",this.boundWindowResizeListener))}registerEventListeners(){"*"===n(this).attr("ids")&&this.supportInfiniteScroll((()=>{this.onInfiniteScroll()}),".view-content"),window.addEventListener("resize",this.boundWindowResizeListener)}async onInfiniteScroll(){if(this.pageIsLoading)return;this.pageIsLoading=!0;let e=n(this).attr("data-pages-loaded")+1;if(e>this.Query.pages)return void(this.pageIsLoading=!1);await this.Query.goToPage(e);let t=n(this).find(".grid");for(let e of this.Query.results)t.appendHtml(`<artist-block artistid="${e.id}"></artist-block>`);n(this).attr("data-pages-loaded",e),this.pageIsLoading=!1}onWindowResize(e){clearTimeout(this.resizeTimout),this.resizeTimout=setTimeout((()=>{n("music-app").hasClass("no-music")||"*"===n(this).attr("ids")&&this.createLoadedIllusion()}),200)}onNewArtist(e){let t=!1;"*"===n(this).attr("ids")&&(t=!0),t&&n(this).find(".grid").prependHtml(`<artist-block artistid="${e.id}"></artist-block>`)}_renderTitle(){n(this).find(".title").remove();let e=n(this).attr("titlei18nkey");if(e)return void n(this).prependHtml(`<h3 class="title">${y(e)}</h3>`);let t=n(this).attr("titlestring");t&&n(this).prependHtml(`<h3 class="title">${t}</h3>`)}createLoadedIllusion(){let e=n(this).find(".grid artist-block").getShortest().el(),t=n(e).height(),a=parseInt(window.getComputedStyle(e).marginBottom),i=n(this).itemsPerRow("artist-block"),s=this.Query.totalResults/i[0],r=t+a;n(".artist-grid-outer").css({"min-height":r*s})}async buildQueryObj(){let e=n(this).attr("ids"),t=n(this).attr("orderby"),a=n(this).attr("order"),i=n(this).attr("genres"),s=n(this).attr("data-pages-loaded")||Number(0),r={};if("*"===e)r.table="music_artists",r.orderBy={artist_plaintext_name:"ASC"},r.page=s+1;else if(Array.isArray(e))r.table="music_artists",r.itemsPerPage=-1,r.equalityOperator="IN",r.columns={id:e};else if(i&&i.length){let e=(await new v({table:"music_track_meta",itemPerPage:-1,columns:[{meta_key:"genre"},{meta_value:i,equalityOperator:"IN"}]})).results.map((e=>e.meta_object_id)),t=await new v({table:"music_tracks",itemPerPage:-1,columns:[{id:e,equalityOperator:"IN"}]}),a=new Set;for(let e of t.results)a.add(e.track_artist_id);if(n(this).attr("exclude")&&a.delete(n(this).attr("exclude")),a=Array.from(a),!a.length)return void n(this).addClass("no-artists");r.table="music_artists",r.itemsPerPage=-1,r.columns={id:a,equalityOperator:"IN"}}return t&&(r.orderBy={[t]:a||"ASC"}),r}}),I.register("artist-block",class extends I{async onSpawn(){this.boundNewAlbumListener=this.onNewAlbum.bind(this),this.classList.add("has-context-menu-items"),Bridge.ipcListen("new-album",this.boundNewAlbumListener)}async onBuild(){await this.setInternalArtistRow(),"bio"===n(this).attr("layout")?await this._renderAsBioLayout():await this._renderAsSimpleLayout()}onLoad(){"bio"!==n(this).attr("layout")&&this.supportInteractingState({rightClickEls:[this.querySelector(".art")]})}onRemoved(){Bridge.removeListener("new-album",this.boundNewAlbumListener)}async setInternalArtistRow(){let e=n(this).attr("artistid"),t=await Bridge.httpApi(`/music-artist/${e}`);if(2!==t.statusRange)throw new Error("<artist-block> did not get API data");this.artistObj=t.response}async getContextMenuItems(){return n(this).attr("artistId"),"artistRow"in this||await this.setInternalArtistRow(),[{group:this.artistObj.artist_name,items:{[y("artist-block.context-menu.shuffle-artist")]:{cb:async(e,t)=>{let a=await this.getShuffledArtistTracks();Player.play(a),ContextMenu.closeAllContextMenus()}}}}]}async _renderAsSimpleLayout(){let e=n(this).attr("artistid"),t=await n().getFileContents("/elements/artist-block/artist-block-simple.html");if(this.artistObj.artist_photo){let a=`<div class="photo-bg" style="background-image: url('${n().__doubleSlashesOnWindowsOnly(this.artistObj.artist_photo[300])}')"></div>`;this.innerHTML=await h(t,{...this.artistObj,bg:a,artClass:"",name:this.artistObj.artist_name,link:`/artist/${e}`})}else{let a=await this.getAlbumArtMarkup(),i=`<div class="albums-bg" data-num="${a.numArts}">${a.html}</div>`;this.innerHTML=await h(t,{...this.artistObj,bg:i,artClass:a.numArts?"":"no-art",name:this.artistObj.artist_name,link:`/artist/${e}`})}}async _renderAsBioLayout(){let e=n(this).attr("artistid"),t=await n().getFileContents("/elements/artist-block/artist-block-bio.html"),a=this.artistObj,i={photoBlock:'<div class="artist-photo no-artist-image"></div>',link:`/artist/${e}`,...a};a.artist_photo&&(i.photoBlock=`<div class="artist-photo" style="background-image:url('${a.artist_photo[150]}')"></div>`),this.innerHTML=await h(t,i)}async getShuffledArtistTracks(e=this){let t=await new v({table:"music_tracks",columns:{track_artist_id:n(e).attr("artistid")}});if(!t.results.length)throw new Error("Could not find tracks in database");let a=t.results.map((e=>e.id));return n().shuffle(a)}async onNewAlbum(e){if(e.album_artist_id===n(this).attr("artistid")){let e=await this.getAlbumArtMarkup();n(this).find(".albums-bg").html(e.html),n(this).find(".albums-bg").attr("data-num",e.numArts)}}async getAlbumArtMarkup(){let e={html:"",numArts:0};if(!this.artistObj.releases.length)return e;for(let t of this.artistObj.releases){let a=await Bridge.httpApi(`/music-release/${t.id}`);if(2!==a.statusRange)continue;if(4===e.numArts)break;const i=a.response;if(i.artwork){let t=n().__doubleSlashesOnWindowsOnly(i.artwork.thumbs[200].thumb_file);e.html+=`<div class="album-thumb" style='background-image:url("${t}");'></div>`,e.numArts++}}return e}}),I.register("track-slider",class extends I{async onSpawn(){}async onBuild(){this.innerHTML=await h("/elements/track-slider/track-slider.html");let e,t=n(this).attr("ids");if(t?e=t:this.ids&&(n(this).attr("ids",this.ids),e=this.ids),!e)throw new Error("Track slider requires track IDs");if(!e.length)return this.props.noContentMessage=y("no-content"),void n(this).addClass("no-content");n().chunk(e,3).forEach((e=>{n(this).find(".swiper-wrapper").appendHtml('<div class="swiper-slide"></div>'),e.forEach((e=>{n(this).find(".swiper-wrapper .swiper-slide:last-of-type").appendHtml(`\n          <track-block trackid="${e}" mode="expanded" playbutton="permanent"></track-block>\n        `)}))})),n(this).attr("num-items",e.length)}async onLoad(){let e;n(this).attr("config"),e={slidesPerView:1,slidesPerGroup:1,spaceBetween:20,roundLengths:!0,touchStartPreventDefault:!1},this.slider=new bt(this.querySelector(".swiper-container"),e),this.registerEventHandlers(),this.watchAttr(["ids"],(()=>{this.render()}))}async onRemoved(){}shouldBuild(){return!!this.ids}registerEventHandlers(){let e=n().throttler((()=>{this.slider.animating||this.slider.slidePrev()}),100),t=n().throttler((()=>{this.slider.animating||this.slider.slideNext()}),100);this.querySelector(".slider-prev").addEventListener("click",e),this.querySelector(".slider-next").addEventListener("click",t)}}),I.register("album-slider",class extends I{async onSpawn(){}async onBuild(){this.innerHTML=await h("/elements/album-slider/album-slider.html");let e,t=n(this).attr("ids");if(t?e=t:this.ids&&(n(this).attr("ids",this.ids),e=this.ids),!e)throw new Error("Album slider requires album IDs");if(!e.length)return this.props.noContentMessage=y("no-content"),void n(this).addClass("no-content");e.forEach((e=>{n(this).find(".swiper-wrapper").appendHtml(this.getSlideHtml(e))})),n(this).attr("num-items",e.length)}async onLoad(){let e;e="media-feed-half-then-full"===n(this).attr("config")?{slidesPerView:2,slidesPerGroup:2,spaceBetween:28,roundLengths:!0,touchStartPreventDefault:!1,breakpoints:{800:{slidesPerView:3,slidesPerGroup:2},950:{slidesPerView:4,slidesPerGroup:2},1100:{slidesPerView:5,slidesPerGroup:3},1200:{slidesPerView:2,slidesPerGroup:2},1280:{slidesPerView:3,slidesPerGroup:2},1620:{slidesPerView:4,slidesPerGroup:2},1920:{slidesPerView:5,slidesPerGroup:2},2100:{slidesPerView:6,slidesPerGroup:3}}}:{slidesPerView:2,slidesPerGroup:1,spaceBetween:20,roundLengths:!0,touchStartPreventDefault:!1,breakpoints:{600:{slidesPerView:2,slidesPerGroup:2},800:{slidesPerView:3,slidesPerGroup:2},1e3:{slidesPerView:4,slidesPerGroup:3},1200:{slidesPerView:5,slidesPerGroup:3},1400:{slidesPerView:6,slidesPerGroup:3},1600:{slidesPerView:7,slidesPerGroup:4},1800:{slidesPerView:8,slidesPerGroup:5},2e3:{slidesPerView:9,slidesPerGroup:6}}},this.slider=new bt(this.querySelector(".swiper-container"),e),this.registerEventHandlers(),this.watchAttr(["ids"],(()=>{this.render()}))}async onRemoved(){}registerEventHandlers(){let e=n().throttler((()=>{this.slider.animating||this.slider.slidePrev()}),100),t=n().throttler((()=>{this.slider.animating||this.slider.slideNext()}),100);this.querySelector(".slider-prev").addEventListener("click",e),this.querySelector(".slider-next").addEventListener("click",t)}getSlideHtml(e){return`\n    <div class="swiper-slide">\n      <album-block albumid="${e}"></album-block>\n    </div>`}prependSlide(e){this.slider.prependSlide(this.getSlideHtml(e))}removeSlides(e){this.slider.removeSlide(e)}}),I.register("release-metadata",class extends I{async onSpawn(){}async onBuild(){let e=await this.makeMergeTags();this.innerHTML=await h("/elements/release-metadata/release-metadata.html",e),e.art?this.classList.add("has-art","loaded"):this.querySelector(".art").classList.add("no-art")}onLoad(){}async getTrackList(){let e=n(this).attr("albumid"),t=await new v({table:"music_tracks",itemsPerPage:-1,join:{table:"file_index",on:{track_file_id:"id"}},columns:{track_release_id:e},orderBy:{track_num:"ASC"}});if(!t.results.length)throw new Error("This album somehow has no tracks");return t.results}makeMergeTags(){return new Promise((async(e,t)=>{this.albumObj||(this.albumObj=await this.getAlbumObj());let a={...this.albumObj,art:"",title:this.albumObj.release_title,date:this.albumObj.release_year||"",artist:this.albumObj.meta.artist,artistLink:`/artist/${this.albumObj.release_primary_artist_id}`};this.trackList=await this.getTrackList();let i=this.getFileTypes();if(a.fileTypes=i.join(" ").toUpperCase(),a.typeLabel=1===i.length?y("release-metadata.file-type"):y("release-metadata.file-types"),a.averageBitrate=this.getAverageBitrate(),a.duration=this.getDuration(),a.genres=this.getGenres(),this.albumObj.artwork){let t=this.albumObj.artwork.thumbs[400].thumb_file,i=n().__doubleSlashesOnWindowsOnly(t),s=document.createElement("img");s.src=i,s.addEventListener("load",(()=>{s.remove(),a.art=`style="background-image:url('${i}')"`,e(a)}))}else e(a)}))}getAverageBitrate(){if(!this.trackList)throw new Error("<release-metadata> is missing internal track list");let e=[];for(let t of this.trackList)t.track_bitrate&&e.push(Number(t.track_bitrate));if(!e.length)return null;let t=e.reduce(((e,t)=>e+t))/e.length;return t=Math.round((t/1e3).toString())+"<sub>kbps</sub>",t}getFileTypes(){if(!this.trackList)throw new Error("<release-metadata> is missing internal track list");let e=new Set;for(let t of this.trackList)t.file_extension&&e.add(t.file_extension);return e.size?Array.from(e):[]}getDuration(){if(!this.trackList)throw new Error("<release-metadata> is missing internal track list");let e=0;for(let t of this.trackList)e+=Math.round(t.track_duration);return n().convertSecondsToHHMMSS(e)}getGenres(){if(!this.trackList)throw new Error("<release-metadata> is missing internal track list");let e=new Set;for(let t of this.trackList)if(Array.isArray(t.track_genre_ids))for(let a of t.track_genre_ids)e.add(a);if(e=Array.from(e),!e.length)return"";let t="";for(let a of e)t+=`<genre-tag genreid="${a}"></genre-tag>`;return t}async getAlbumObj(){let e=n(this).attr("albumid"),t=await Bridge.httpApi(`/music-release/${e}`);if(2!==t.statusRange)throw new Error("<release-metadata> did not get API data");return t.response}}),I.register("media-feed",class extends I{async onSpawn(){if(this.type=n(this).attr("type"),!this.type)throw new Error("<media-feed> requires the 'type' attribute");this.infiniteScrollTemplatePool=["artist","album","genre"]}async onBuild(){this.innerHTML=await h("/elements/media-feed/media-feed.html"),n("music-app").hasClass("no-music")||(await this.checkIfEnoughMusic()||n(this).attr("message","not-enough-music"),await this.insertFeedTop())}async onLoad(){}async onRemoved(){}shouldBuild(){return!n(this).find(".media-feed-block").els.length}async onInfiniteScroll(){let e=n(this).find(".content-feed");e.hasClass("loading")||(e.addClass("loading"),"music"===this.type&&await this.insertRandomMusicBlock(),e.removeClass("loading"))}async checkIfEnoughMusic(e=10){return(await new v({table:"music_releases",itemsPerPage:e})).results.length>=e}async refreshFeedBlocks(){let e=n(this).find(".media-feed-block");e.els.length?e.each((e=>{"refresh"in e&&e.refresh()})):await this.insertFeedTop()}eraseFeed(){n(this).find(".content-feed").html("")}async insertFeedTop(){let e=n(this).getTemplate(".static-top");this.eraseFeed(),n(this).find(".content-feed").appendHtml(e)}async insertRandomMusicBlock(e=1){let t=n(this).find(".content-feed");if(t.hasClass("end"))return;if(!this.infiniteScrollTemplatePool.length)return void t.addClass("end");let a=n().randomFromArray(this.infiniteScrollTemplatePool),i=await this.getBlockTemplate(a);!1===i&&this.insertRandomMusicBlock(),t.appendHtml(i)}async getBlockTemplate(e){let t=n(this).getTemplate(`.${e}`);if("artist"===e){let e=await this.getUnusedId("artist","music_artists","artistid");return e?(n(t).find("media-feed-artist").attr("artistid",e),t):(console.log("Exhaused all <media-feed-artist> templates"),this.infiniteScrollTemplatePool.splice(this.infiniteScrollTemplatePool.indexOf("artist"),1),!1)}if("album"===e){let e=await this.getUnusedId("album","music_releases","albumid");return e?(n(t).find("media-feed-album").attr("albumid",e),t):(console.log("Exhaused all <media-feed-album> templates"),this.infiniteScrollTemplatePool.splice(this.infiniteScrollTemplatePool.indexOf("album"),1),!1)}if("genre"===e){let e=await this.getUnusedId("genre","music_genres","genreid");return e?(n(t).find("media-feed-genre").attr("genreid",e),t):(console.log("Exhaused all <media-feed-genre> templates"),this.infiniteScrollTemplatePool.splice(this.infiniteScrollTemplatePool.indexOf("genre"),1),!1)}}getExistingBlockData(){let e=n(this).find(".content-feed"),t=e.find(".media-feed-block");return{allBlocks:t.els,numBlocks:t.els.length,usedArtists:e.find(".media-feed-block[artistid]").els.map((e=>n(e).attr("artistid"))),usedAlbums:e.find(".media-feed-block[albumid]").els.map((e=>n(e).attr("albumid")))}}async getUnusedId(e,t,a){let i,s=n(this).find(`media-feed-${e}`).els.map((e=>n(e).attr(a)));return i=s.length?await new v({table:t,itemsPerPage:1,columns:{id:s},equalityOperator:"NOT IN",orderBy:"rand"}):await new v({table:t,itemsPerPage:1,orderBy:"rand"}),i.results.length?i.results[0].id:null}}),I.register("media-feed-top-albums",class extends I{async onSpawn(){}async onBuild(){this.innerHTML=await h("/elements/media-feed-top-albums/media-feed-top-albums.html"),this.props.title=this.buildTitle(),this.refresh()}async onLoad(){}async onRemoved(){}registerEventListeners(){}buildTitle(){let e={overnight:[y("media-feed-block.top-picks.title.overnight-1"),y("media-feed-block.top-picks.title.overnight-2"),y("media-feed-block.top-picks.title.overnight-3"),y("media-feed-block.top-picks.title.overnight-4"),y("media-feed-block.top-picks.title.overnight-5")],morning:[y("media-feed-block.top-picks.title.morning-1"),y("media-feed-block.top-picks.title.morning-2"),y("media-feed-block.top-picks.title.morning-3"),y("media-feed-block.top-picks.title.morning-4"),y("media-feed-block.top-picks.title.morning-5")],afternoon:[y("media-feed-block.top-picks.title.afternoon-1"),y("media-feed-block.top-picks.title.afternoon-2"),y("media-feed-block.top-picks.title.afternoon-3"),y("media-feed-block.top-picks.title.afternoon-4"),y("media-feed-block.top-picks.title.afternoon-5")],evening:[y("media-feed-block.top-picks.title.evening-1"),y("media-feed-block.top-picks.title.evening-2"),y("media-feed-block.top-picks.title.evening-3"),y("media-feed-block.top-picks.title.evening-4"),y("media-feed-block.top-picks.title.evening-5")]},t=[],a=(new Date).getHours();23===a||24===a||n().numberIsBetween(a,0,5)?t.push("overnight"):n().numberIsBetween(a,6,11)?t.push("morning"):n().numberIsBetween(a,12,16)?t.push("afternoon"):n().numberIsBetween(a,17,22)&&t.push("evening");let i=y("media-feed-block.top-picks.title.default");for(let[a,s]of Object.entries(e))n().getArrayIntersection(t,a.split(",")).length>0&&(i=n().randomFromArray(s));return i}async getBlockObjectTopAlbums(){return(await Bridge.httpApi("/media-api","POST",{fn:"getFeedBlock",args:["top-albums"]})).response}injectTopAlbums(e){let t=e.data.map((e=>e.id));t=t.sort((()=>Math.random()-.5)).slice(0,12);let a=I.elementFactory({name:"album-slider",attrs:{class:"small",config:"media-feed-half-then-full"},bindings:{ids:t}});n(this).find(".top-albums").html("").appendHtml(a),n(this).attr("data-signature",e.dataSignature)}async refresh(e=!1){let t=await this.getBlockObjectTopAlbums();(n(this).attr("data-signature")!==t.dataSignature||e)&&this.injectTopAlbums(t)}}),I.register("media-feed-top-tracks",class extends I{async onSpawn(){}async onBuild(){this.innerHTML=await h("/elements/media-feed-top-tracks/media-feed-top-tracks.html"),this.props.title="top tracks",this.refresh()}async onLoad(){}async onRemoved(){}registerEventListeners(){}async getBlockObjectTopTracks(){return(await Bridge.httpApi("/media-api","POST",{fn:"getFeedBlock",args:["top-tracks"]})).response}injectTopTracks(e){let t=e.data.map((e=>e.id)),a=I.elementFactory({name:"track-slider",attrs:{config:"media-feed-half-then-full"},bindings:{ids:t}});n(this).find(".top-tracks").html("").appendHtml(a),n(this).attr("data-signature",e.dataSignature)}async refresh(e=!1){let t=await this.getBlockObjectTopTracks();(n(this).attr("data-signature")!==t.dataSignature||e)&&this.injectTopTracks(t)}}),I.register("media-feed-shuffle-music",class extends I{async onSpawn(){this.lastShuffle=0,this.shuffleThrottle=5e3}async onBuild(){this.innerHTML=await h("/elements/media-feed-shuffle-music/media-feed-shuffle-music.html"),this.insertIcon(),this.insertTitle()}async onLoad(){this.registerEventListeners()}async onRemoved(){}registerEventListeners(){let e=this.querySelector("button");e.addEventListener("mouseenter",(()=>{e.classList.add("over")})),e.addEventListener("mouseleave",(()=>{e.classList.remove("over","press")})),e.addEventListener("mousedown",(t=>{1===t.which&&(e.classList.add("press"),e.classList.remove("over"))})),e.addEventListener("mouseup",(t=>{1===t.which&&e.classList.contains("press")&&(e.classList.remove("press"),this.insertIcon(),Date.now()-this.lastShuffle>this.shuffleThrottle&&this.shuffleAndPlay())})),e.addEventListener("keydown",(t=>{"Space"===t.code&&e.classList.add("press")})),e.addEventListener("keyup",(t=>{"Space"===t.code&&(e.classList.remove("press"),this.insertIcon(),Date.now()-this.lastShuffle>this.shuffleThrottle&&this.shuffleAndPlay())}))}insertTitle(){let e=n(this).attr("genreid"),t=n(this).attr("rand");"rand"===e?this.props.title=y("media-feed.shuffle-music-genre.title"):"album"===t?this.props.title=y("media-feed.random-album.title"):"artist"===t?this.props.title=y("media-feed.shuffle-artist.title"):"*"===t&&(this.props.title=y("media-feed.shuffle-music.title"))}insertIcon(){let e,t,a=n(this).attr("genreid"),i=n(this).attr("rand"),s=n(this).attr("current-icon");"rand"===a?e=["fa-guitar","fa-drum","fa-sliders-h","fa-headphones-alt"]:"album"===i?e=["fa-compact-disc","fa-record-vinyl"]:"artist"===i?e=["fa-user-friends","fa-users"]:"*"===i&&(e=["fa-dice","fa-dice-two","fa-dice-three","fa-dice-four","fa-dice-five","fa-dice-six"]),s&&e.splice(e.indexOf(s),1);let r=n().odds({rare:"1/30",common:"29/30"});"common"===r?t=n().randomFromArray(e):"rare"===r&&(t=n().randomFromArray(["fa-gamepad","fa-cat","fa-poop","fa-carrot","fa-hat-wizard"])),n(this).attr("current-icon",t);let o=n(this).find(".content"),l=n(this).find(".icon"),d=`icon fas ${t}`;l.els.length?l.attr("class",d):o.prependHtml(`<i class="${d}"></i>`)}async shuffleAndPlay(){let e=n(this).attr("genreid"),t=n(this).attr("rand");"rand"===e?await this._shuffleAndPlayMusicGenre():"album"===t?await this._playRandomAlbum():"artist"===t?await this._shuffleAndPlayArtistTracks():"*"===t&&await this._shuffleAndPlayAllMusic(),n(this).addClass("throttled"),setTimeout((()=>{n(this).removeClass("throttled")}),this.shuffleThrottle),this.lastShuffle=Date.now()}async _shuffleAndPlayAllMusic(e=200){let t=await new v({table:"music_tracks",itemsPerPage:e,orderBy:"rand"});if(!t.results.length)throw new Error("The shuffle button shouldn't be showing if there are no tracks.");Player.play(t.results.map((e=>e.id)))}async _playRandomAlbum(){let e=await new v({table:"music_releases",itemsPerPage:1,orderBy:"rand"});if(!e.results.length)throw new Error("The shuffle button shouldn't be showing if there are no albums.");let t=await new v({table:"music_tracks",itemsPerPage:-1,columns:{track_release_id:e.results[0].id},orderBy:"track_num"});Player.play(t.results.map((e=>e.id)))}async _shuffleAndPlayArtistTracks(){let e=await new v({table:"music_artists",itemsPerPage:1,orderBy:"rand"});if(!e.results.length)throw new Error("The shuffle button shouldn't be showing if there are no artists.");let t=await new v({table:"music_tracks",itemsPerPage:-1,columns:{track_artist_id:e.results[0].id},orderBy:"rand"});Player.play(t.results.map((e=>e.id)))}async _shuffleAndPlayMusicGenre(){let e=n(this).attr("genreid"),t=[];if(!e)throw new Error("Genre ID is required");if("rand"===e){let t=await new v({table:"music_genres",itemsPerPage:1,orderBy:"rand"});if(!t.results.length){let e=await new v({table:"music_tracks",itemsPerPage:200,orderBy:"rand"});return void Player.play(e.results.map((e=>e.id)))}e=t.results[0].id}t=(await new v({table:"music_track_meta",columns:{meta_key:"genre",meta_value:e},itemsPerPage:200,orderBy:"rand"})).results.map((e=>e.meta_object_id)),Player.play(t)}}),I.register("media-feed-recently-played-albums",class extends I{async onSpawn(){this.boundOnTrackChange=this.onTrackChange.bind(this),this.maxAlbumsInSlider=24,Player.on("trackChange",this.boundOnTrackChange)}async onBuild(){this.innerHTML=await h("/elements/media-feed-recently-played-albums/media-feed-recently-played-albums.html");let e=await this.getBlockObject();n(this).attr("data-signature",e.dataSignature),this.injectSlider(e)}async onLoad(){this.refresh()}async onRemoved(){Player.off("trackChange",this.boundOnTrackChange)}onTrackChange(){setTimeout((()=>{if(n(this).find("album-slider").hasClass("no-content"))return void this.refresh();let e=n(this).find("album-block").els.map((e=>n(e).attr("albumid"))),t=n(this).find(`album-block[albumid="${Player.trackObj.track_release_id}"]`),a=n(this).find("album-slider").el();if(t.els.length){let t=e.indexOf(Player.trackObj.track_release_id);0!==t&&(a.removeSlides(t),a.prependSlide(Player.trackObj.track_release_id))}else a.prependSlide(Player.trackObj.track_release_id),this.trimExtraSlides()}),0)}async getBlockObject(){return(await Bridge.httpApi("/media-api","POST",{fn:"getFeedBlock",args:["recently-played-albums"]})).response}injectSlider(e){let t=e.data.map((e=>e.id)),a=I.elementFactory({name:"album-slider",bindings:{ids:t,props:{noContentMessage:'<i class="fas fa-scroll"></i>'+y("media-feed-block.recently-played-music.no-content")}}});n(this).find(".album-slider").html("").appendHtml(a)}async refresh(e=!1){let t=await this.getBlockObject();(n(this).attr("data-signature")!==t.dataSignature||e)&&this.injectSlider(t)}async trimExtraSlides(){let e=n(this).find("album-slider").el(),t=n(this).find("album-block").els.length;if(t>this.maxAlbumsInSlider){let a=[];for(let e=this.maxAlbumsInSlider+1;e<=t;e++)a.push(e-1);e.removeSlides(a)}}}),I.register("media-feed-recently-added-albums",class extends I{async onSpawn(){}async onBuild(){this.innerHTML=await h("/elements/media-feed-recently-added-albums/media-feed-recently-added-albums.html");let e=await this.getBlockObject();e.data.length||n(this).closest(".feed-layout-container").hide(),n(this).attr("data-signature",e.dataSignature),this.injectSlider(e)}async onLoad(){}async onRemoved(){}async getBlockObject(){return(await Bridge.httpApi("/media-api","POST",{fn:"getFeedBlock",args:["recently-added-albums"]})).response}injectSlider(e){let t=e.data.map((e=>e.track_release_id)),a=I.elementFactory({name:"album-slider",bindings:{ids:t}});n(this).find(".album-slider").html("").appendHtml(a)}async refresh(e=!1){let t=await this.getBlockObject();(n(this).attr("data-signature")!==t.dataSignature||e)&&this.injectSlider(t)}}),I.register("media-feed-albums-with-favorites",class extends I{async onSpawn(){this.boundOnFavoriteChange=this.onFavoriteChange.bind(this),Bridge.wsListen("announcements:favorite-added",this.boundOnFavoriteChange),Bridge.wsListen("announcements:favorite-removed",this.boundOnFavoriteChange)}async onBuild(){this.innerHTML=await h("/elements/media-feed-albums-with-favorites/media-feed-albums-with-favorites.html")}async onLoad(){this.refresh()}async onRemoved(){Bridge.removeWsListener("announcements:favorite-added",this.boundOnOptionChange),Bridge.removeWsListener("announcements:favorite-removed",this.boundOnOptionChange)}onFavoriteChange(e){this.refresh()}async getBlockObject(){return(await Bridge.httpApi("/media-api","POST",{fn:"getFeedBlock",args:["albums-with-favorites"]})).response}injectSlider(e){let t=e.data,a=I.elementFactory({name:"album-slider",bindings:{ids:t,props:{noContentMessage:'<i class="fas fa-scroll"></i>'+y("media-feed-block.albums-with-favorites.no-content")}}});n(this).attr("data-signature",e.dataSignature),n(this).find(".album-slider").html("").appendHtml(a)}async refresh(e=!1){let t=await this.getBlockObject();(n(this).attr("data-signature")!==t.dataSignature||e)&&this.injectSlider(t)}}),I.register("media-feed-artist",class extends I{async onSpawn(){this.artistId=n(this).attr("artistid");let e=await Bridge.httpApi("/media-api","POST",{fn:"getArtist",args:[this.artistId]});this.artist=e.response}async onBuild(){let e=await this.getBlockObject();console.log(e),e.dataSignature||n(this).closest(".feed-layout-container").hide(),n(this).attr("data-signature",e.dataSignature);let t={...this.artist};if(this.artist.artist_photo){let e=n().__doubleSlashesOnWindowsOnly(this.artist.artist_photo.full);t.artistBg=`<div class="artist-bg" style="background-image: url('${e}');"></div>`}else t.artistBg='<div class="gradient-bg"></div>';this.innerHTML=await h("/elements/media-feed-artist/media-feed-artist.html",t),this.props.albumsTitle=e.data.albumsTitle}async onLoad(){}async onRemoved(){}async getBlockObject(){return(await Bridge.httpApi("/media-api","POST",{fn:"getFeedBlock",args:["artist",{artistId:this.artistId}]})).response}async refresh(e=!1){let t=await this.getBlockObject();(n(this).attr("data-signature")!==t.dataSignature||e)&&this.render()}});const wt={"music-release":async function(){let e=Router.currentViewParams.id||null;if(!e)throw new Error("Model could not determine context");let t=await new v({table:"music_releases",join:{table:"music_artists",on:{release_primary_artist_id:"id"}},columns:{"music_releases.id":e}});if(!t.results.length)throw new Error("Model could not find album in the database");let a=t.results[0],i=a;if(!t.results.length)throw new Error("Model could not find album in the database");return i.albumArtist="",i.artistAlbums=JSON.stringify(await async function(e){let t=await new v({table:"music_releases",itemsPerPage:-1,columns:{release_primary_artist_id:e},orderBy:{release_year:"DESC"}});if(!t.results.length)throw new Error("The albumsQuery should at least always find the currently showing album");return t.results.map((e=>e.id))}(a.release_primary_artist_id)),i},artist:async function(){let e=Router.currentViewParams.id||null;if(!e)throw new Error("Model could not determine context");let t=await new v({table:"music_artists",columns:{id:e}});if(!t.results.length)throw new Error("Model could not find artist in the database");let a=t.results[0];if(a.genres=JSON.stringify(await async function(e){let t=await new v({table:"music_tracks",itemsPerPage:-1,columns:{track_artist_id:e}});if(!t.results.length)return[];let a=await new v({table:"music_track_meta",itemsPerPage:-1,columns:[{meta_key:"genre",equalityOperator:"="},{meta_object_id:t.results.map((e=>e.id)),equalityOperator:"IN"}]});if(!a.results.length)return[];let i=new Set;for(let e of a.results)i.add(e.meta_value);return Array.from(i)}(e)),a.topTracks=JSON.stringify(await async function(e){let t=(await Bridge.httpApi("/media-api","POST",{fn:"getArtistMostPlayedTracks",args:[e]})).response.map((e=>e.id));if(t.length>=6)return t.slice(0,6);let a=[...t],i=await new v({table:"music_tracks",itemsPerPage:6-a.length,columns:[{id:a,equalityOperator:"NOT IN"},{track_artist_id:e,equalityOperator:"="}]});return i.results.length&&(a=[...a,...i.results.map((e=>e.id))]),a}(e)),a.artist_photo){let e=n().__doubleSlashesOnWindowsOnly(a.artist_photo.full);a.artistBg=`<div class="artist-bg" style="background-image: url('${e}');"></div>`}else a.artistBg="";return a},"music-genre":async function(){let e=Router.currentViewParams.id||null;if(!e)throw new Error("Model could not determine context");let t=await new v({table:"music_genres",columns:{id:e}});if(!t.results.length)throw new Error("Model could not find genre in the database");let a=t.results[0];a.artistGridTitle=y("view.genre.artist-grid-title").replace("{{genre}}",a.genre_name),a.albumGridTitle=y("view.genre.album-grid-title").replace("{{genre}}",a.genre_name);let i=await new v({table:"music_tracks",itemsPerPage:-1,join:{table:"music_track_meta",on:{id:"meta_object_id"}},columns:{meta_key:"genre",meta_value:a.id}});return i.results.length?(a.artistIds=JSON.stringify(function(e){let t=new Set;for(let a of e)t.add(a.track_artist_id);return Array.from(t)}(i.results)),a.albumIds=JSON.stringify(function(e){let t=new Set;for(let a of e)t.add(a.track_release_id);return Array.from(t)}(i.results)),a):a},playlist:async function(){let e=Router.currentViewParams.id||null;if(!e)throw new Error("Model could not determine context");let t=await new v({table:"music_playlists",columns:{id:e}});if(!t.results.length)throw new Error("Model could not find playlist in the database");return t.results[0]}};!async function(){let e;window.Bridge=new r,await window.Bridge.init("ipc"),e=window.Bridge.ipcConnectionEstablished?"electron":"vanilla",window.Player=new class{constructor(e){this.state="stopped",this.queue=[],this.currentQueueItemIndex=null,this.shuffle=!1,this.repeat=!1,this.muted=!1,this._defaultVolume=1,this._locked=!1,this._currentHowl=null,this.currentlyPlayingId=0,this.trackObj=null,this._callbacks={stateChange:[],trackChange:[],controlChange:[],queueChange:[]},this.options=e||{},this.consoleColor="#d61fd0"}play(e=[]){console.log("%cPlaying/resuming audio playback",`color:${this.consoleColor};`),"number"==typeof e&&(e=[e]),e.length?this._newPlayback(e):this.resume()}pause(){return console.log("%cPausing audio playback",`color:${this.consoleColor};`),null!==this._currentHowl&&(this._currentHowl.pause(),this._stateChange("paused"),!0)}playPause(){"paused"===this.state?this.play():"playing"===this.state?this.pause():"stopped"===this.state&&this.queue.length&&this.play()}resume(){return"paused"===this.state?(this._currentHowl.play(),this._stateChange("playing"),!0):"stopped"===this.state&&this.queue.length?(this.playItemInQueue(0),!0):(console.log("%cNo playback to resume or audio is already playing",`color:${this.consoleColor};`),!1)}async stop(){console.log("%cStopping audio playback",`color:${this.consoleColor};`),await this._saveTrackEndState(),this.queue=[],this.currentlyPlayingId=0,this.trackObj=null,this.currentQueueItemIndex=null,null!==this._currentHowl&&"error"!==this.state&&(this._currentHowl.stop(),this._currentHowl.unload()),this._currentHowl=null,this._stateChange("stopped")}async next(e=!1){if("stopped"!==this.state){if("loading"!==this.state)return await this._saveTrackEndState(e),"track"===this.repeat?(console.log("%cRepeating current track",`color:${this.consoleColor};`),void this.playItemInQueue(this.currentQueueItemIndex)):this.shuffle?(console.log("%cPlaying random track in queue",`color:${this.consoleColor};`),void this.playItemInQueue(n().randomNumberBetween(0,this.queue.length-1))):"queue"===this.repeat&&this.currentQueueItemIndex===this.queue.length-1?(console.log("%cRestarting queue at beginning",`color:${this.consoleColor};`),void this.playItemInQueue(0)):void(void 0!==this.queue[this.currentQueueItemIndex+1]?(console.log("%cPlaying next track",`color:${this.consoleColor};`),this.playItemInQueue(this.currentQueueItemIndex+1)):await this.stop())}else console.log("%cPlayer is not playing anything",`color:${this.consoleColor};`)}async previous(){if("stopped"!==this.state){if("loading"!==this.state)if(await this._saveTrackEndState(),this.getCurrentPlaybackTime()>=3)console.log("%cRestarting current playback",`color:${this.consoleColor};`),this._currentHowl.seek(0);else{if(this.shuffle)return console.log("%cPlaying random track in queue",`color:${this.consoleColor};`),void this.playItemInQueue(n().randomNumberBetween(0,this.queue.length-1));if(void 0===this.queue[this.currentQueueItemIndex-1])return console.log("%cRestarting current playback",`color:${this.consoleColor};`),void this._currentHowl.seek(0);console.log("%cPlaying previous track",`color:${this.consoleColor};`),this.playItemInQueue(this.currentQueueItemIndex-1)}}else console.log("%cPlayer is not playing anything",`color:${this.consoleColor};`)}async _updateTrackObj(e){this.trackObj=null;let t=await Bridge.httpApi(`/music-track/${e}`);return 2!==t.statusRange?(console.error("Player could not find track"),!1):(this.trackObj=t.response,!0)}async playItemInQueue(e,t){if(!this._locked)return this._locked=!0,this.currentQueueItemIndex=e,this.currentlyPlayingId=this.queue[e],this._stateChange("loading"),this._currentHowl instanceof _&&(this._currentHowl.stop(),this._currentHowl.unload()),await this._updateTrackObj(this.currentlyPlayingId)?(this._currentHowl=await this._newHowl(t),!1===this._currentHowl?(this._trackPlaybackFailed(),!1):(this._trackChange(this.currentlyPlayingId),this._currentHowl.play(),this._stateChange("playing"),this.createSystemNotification(this.currentlyPlayingId),this._addToServerPlaybackHistory(),this._locked=!1,!0)):(console.warn("API call to update trackObj failed"),this._locked=!1,!1);console.log("Woah, slow down there")}async _newHowl(e){let t,a=e||this.options.mode;switch(a){case"reference":if(!await this.fileExists(this.trackObj.file.file_path))return!1;t=this.formatFilePath(this.trackObj.file.file_path);break;case"stream":t=`${Bridge.httpApiUrl()}/music-track/${this.trackObj.id}/stream`;break;default:return!1}return!!t&&!!this.trackObj&&(console.log(`%cStarting new audio playback in mode "${a}" with resource ${t}`,`color:${this.consoleColor};`),new _({src:t,html5:!0,format:[this.trackObj.file.file_extension],volume:this._defaultVolume,mute:this.muted,loop:!1,onloaderror:async()=>{console.log("loaderror"),this._trackPlaybackFailed()},onplayerror:async()=>{console.log("playerror"),this._trackPlaybackFailed()},onend:async()=>{await this.next(!0)}}))}_trackPlaybackFailed(){console.warn(`Playback error for: ${this.trackObj.file.file_path}`),this.state="error",confirm(y("notification.cannot-load-music-file.message").replace("{{song}}",this.trackObj.file.file_path))?(this._locked=!1,this.next()):this.stop()}mute(){console.log("%cPlayback muted",`color:${this.consoleColor};`),this.muted=!0,null!==this._currentHowl&&this._currentHowl.mute(!0)}unmute(){console.log("%cPlayback unmuted",`color:${this.consoleColor};`),this.muted=!1,null!==this._currentHowl&&this._currentHowl.mute(!1)}getCurrentPlaybackTime(){return"stopped"===this.state?null:this._currentHowl instanceof _&&"loaded"===this._currentHowl.state()?this._currentHowl.seek():Number(0)}seek(e){console.log(`%cSeeking to ${e} seconds`,`color:${this.consoleColor};`),this._currentHowl.seek(e),this._stateChange(this.state)}setShuffle(e){if("boolean"!=typeof e)throw new Error("Shuffle mode can only be set to true or false");console.log(`%cPlayback shuffle set to ${e}`,`color:${this.consoleColor};`),this.shuffle=e,this._controlChange()}setRepeat(e){if("track"!==e&&"queue"!==e&&!1!==e)throw new Error('Repeat can only be set to "track", "queue" or false');console.log(`%cPlayback repeat set to ${e}`,`color:${this.consoleColor};`),this.repeat=e,this._controlChange()}createSystemNotification(e){let t,a=this.trackObj.track_title,i=this.trackObj.meta.artist;this.trackObj.artwork&&(t=this.trackObj.artwork.thumbs[75].thumb_file),async function(e,t,a){if(!await new Promise(((e,t)=>{"granted"===window.Notification.permission&&e(!0),"denied"!==window.Notification.permission&&window.Notification.requestPermission().then((t=>{e("granted"===t)}))})))return;let i=window.localStorage.getItem("notification_on_song_change");JSON.parse(i)&&new window.Notification(e,{body:t,icon:a,lang:Router.currentLang,silent:!0})}(a,i,t)}add(e,t=null){if("number"==typeof e&&(e=[e]),null===t)for(let t of e)this.queue.push(t);else this.queue.splice(t,0,...e);this._queueChange()}remove(e){this.queue.splice(e,1),this._queueChange()}clearQueue(e="all"){switch(console.log(`%cClearing queue (mode: ${e})`,`color:${this.consoleColor};`),e){case"upcoming":this._clearQueueUpcoming();break;case"previous":this._clearQueuePrevious();break;case"all":this._clearQueuePrevious(),this._clearQueueUpcoming()}this._trackChange(this.currentlyPlayingId)}_clearQueueUpcoming(){this.currentQueueItemIndex!==this.queue.length-1&&this.queue.splice(this.currentQueueItemIndex+1)}_clearQueuePrevious(){0!==this.currentQueueItemIndex&&(this.queue.splice(0,this.currentQueueItemIndex),this.currentQueueItemIndex=0)}silentlyUpdateQueue(e){let t=e.indexOf(this.currentlyPlayingId);if(-1===t)throw new Error("Player cannot update the queue with a new queue that does not have the currently playing track ID somewhere in it");this.queue=e,this.currentQueueItemIndex=t}async _newPlayback(e){if(!e.length)throw new Error("Cannot begin playback of empty queue");"stopped"!==this.state&&await this.stop(),this.queue=e,this.playItemInQueue(0)}formatFilePath(e){let t=e.split(Bridge.sep),a=t.pop();return t.join(Bridge.sep)+Bridge.sep+encodeURIComponent(a)}fileExists(e){return new Promise(((t,a)=>{e=this.formatFilePath(e);let i=new XMLHttpRequest;i.addEventListener("load",(()=>{t(!0)})),i.addEventListener("error",(()=>{t(!1)})),i.open("HEAD",e),i.send()}))}async _addToServerPlaybackHistory(){2!==(await Bridge.httpApi("/media-api","POST",{fn:"addToMusicHistory",args:[{trackId:this.currentlyPlayingId,weather:null,secondsListened:0,percentListened:0,device:this.options.device||"(Unknown)"}]})).statusRange&&console.error("Error adding entry to playback history with API")}async _saveTrackEndState(e){if("error"===this.state||"loading"===this.state)return!0;let t,a,i=await new v({table:"music_history",itemsPerPage:1,columns:{music_history_track_id:this.currentlyPlayingId},orderBy:{music_history_timestamp:"DESC"}});return i.results.length?(e?(t=this.trackObj.track_duration,a=100):(t=this.getCurrentPlaybackTime(),a=Math.ceil(t/this._currentHowl._duration*100)),2===(await Bridge.httpApi("/db-api","POST",{fn:"update",args:["music_history",i.results[0].id,{music_history_seconds_listened:t,music_history_percent_listened:a}]})).statusRange||(console.warn("Could not update track state at end of track"),!1)):(console.warn("Player could not find music history entry"),!1)}_stateChange(e){if(this.state=e,this._callbacks.stateChange.length)for(let t of this._callbacks.stateChange)t(e)}_trackChange(e){if(this._callbacks.trackChange.length)for(let t of this._callbacks.trackChange)t(e)}_controlChange(){if(this._callbacks.controlChange.length)for(let e of this._callbacks.controlChange)e()}_queueChange(){if(this._callbacks.queueChange.length)for(let e of this._callbacks.queueChange)e()}on(e,t){this._callbacks[e].push(t)}off(e,t){this._callbacks[e].forEach(((a,i)=>{a===t&&this._callbacks[e].splice(i,1)}))}cleanup(){for(let e in this._callbacks)this._callbacks[e]=[]}}({device:"cardinalmusic:desktop:full",mode:"stream"}),window.Router=new g({root:"#view",mode:"electron",langs:["en","fr"],defaultLang:"en",cacheViews:!0,currentLang:"en",routes:await f("/routes.json"),models:wt}),"electron"===e&&(window.i18n=await window.Bridge.ipcAsk("get-i18n")),document.getElementById("root").innerHTML=`<music-app id="app" env="${e}"></music-app>`,r.appDebug&&console.log("<music-app> injected")}()})()})();